<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>中间件：Nginx - wolai 笔记</title><link rel="shortcut icon"></link></head><body class="full-width"><header><div class="image has" style="background-position-y: 50%; background-image: url(&quot;media/java-2410.jpg&quot;)"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="中间件：Nginx" class="main-title"></div></div></header><article><h1 id="sSPmMLf33ozxAyCjPGR9Zs" class="wolai-block"><span class="wolai-serial-number">1</span><span class="inline-wrap">什么是<span class="jill"></span>Nginx？</span></h1><div id="tNWd5teinbDzhf7GZ4gGAJ" class="wolai-block"><figure class="wolai-center" style="width: 272.72726681606844px; flex-direction: column"><img src="media/y15nd9w553.png" style="width: 100%"/></figure></div><div id="mFMgmt7EtBNx53eHQiEmaD" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>是一款高性能的<span class="jill"></span>HTTP<span class="jill"></span>服务器和反向代理服务器，具有轻量级、高并发处理能力的特点。以下是对<span class="jill"></span>Nginx<span class="jill"></span>的具体介绍：</span></div></div><ol class="wolai-block"><li id="pdLb7fsac7gU8yQ2KfKhMn"><div class="marker"></div><span class="inline-wrap"><b>基本概念</b></span><ul class="wolai-block"><li id="c5ukbjTYi6thb5APfcUkDc"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>定义</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>是一款由俄罗斯程序员<span class="jill"></span>Igor Sysoev<span class="jill"></span>开发的开源软件。它主要被用作<span class="jill"></span>HTTP<span class="jill"></span>服务器和反向代理服务器，同时也支持电子邮件（IMAP/POP3）代理服务。Nginx<span class="jill"></span>以其高并发连接处理能力和低资源消耗而闻名，能够在<span class="jill"></span>Linux<span class="jill"></span>系统上高效运行，并且也有<span class="jill"></span>Windows<span class="jill"></span>系统的移植版。</span></li><li id="tcxSw1c26f19i2SbTWAMr1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>特点</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>采用<span class="jill"></span>C<span class="jill"></span>语言编写，具备高性能和高稳定性。其源代码以类<span class="jill"></span>BSD<span class="jill"></span>许可证的形式发布，允许广泛的使用和修改。同时，Nginx<span class="jill"></span>还拥有丰富的模块库，能够提供包括<span class="jill"></span>HTTP<span class="jill"></span>负载均衡、缓存、访问控制等多种功能。</span></li></ul></li><li id="8fxWbqdUAwCvAsNMXg77FQ"><div class="marker"></div><span class="inline-wrap"><b>工作原理</b></span><ul class="wolai-block"><li id="kamaVxL4hbjT1vniHHB2Bc"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>反向代理机制</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>作为反向代理服务器，可以接收客户端请求并将其转发给后端服务器，再将从后端服务器获取的响应返回给客户端。这一机制使得<span class="jill"></span>Nginx<span class="jill"></span>能够隐藏后端服务器的存在，对外表现为一个单一的访问点。</span></li><li id="uj6Aj7vdywKghiZhvTQH4q"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡策略</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>支持多种负载均衡算法，如轮询和权重分配等，可以根据实际需求将客户端请求分发到不同的后端服务器上，从而提高系统的整体性能和可用性。</span></li></ul></li><li id="qSfaGHbP5v2C1j4pVQXeUE"><div class="marker"></div><span class="inline-wrap"><b>应用场景</b></span><ul class="wolai-block"><li id="eYJPhjLMxRbNG1xGS8QVbE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>静态内容托管</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>在处理静态文件方面表现出色，能够快速响应并返回文件内容。因此，它常被用于托管静态网站或作为动态网站的静态资源服务器。</span></li><li id="nt82skWeANtFsfpzb6Mwni"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>反向代理与负载均衡</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>可以作为反向代理服务器，将客户端请求分发到多个后端服务器上，实现负载均衡。这有助于提高系统的可扩展性和可靠性。</span></li><li id="gbieHpf3cD3vYjY2jxorVK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>API<span class="jill"></span>网关</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>还可以作为<span class="jill"></span>API<span class="jill"></span>网关，统一管理和调度后端微服务接口，提供认证、限流、监控等功能。</span></li></ul></li><li id="fknBQF61yvkHHnsATeCs1J"><div class="marker"></div><span class="inline-wrap"><b>配置与管理</b></span><ul class="wolai-block"><li id="sLkirshsPzBo16wJhQGChS"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>配置文件</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>的配置文件通常位于安装目录下的<span class="jill"></span>conf<span class="jill"></span>文件夹中，主配置文件名为<span class="jill"></span>nginx.conf。通过修改该文件，可以自定义<span class="jill"></span>Nginx<span class="jill"></span>的行为和功能。</span></li><li id="crfwbHwaZyrxBiLYSDCiGk"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>命令行工具</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>提供了丰富的命令行工具，用于启动、停止、重启<span class="jill"></span>Nginx<span class="jill"></span>服务以及重新加载配置文件等操作。</span></li></ul></li></ol><div id="8g2aw9wdKT2sD7hLUdUhGa" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，Nginx<span class="jill"></span>是一个功能强大且灵活的<span class="jill"></span>Web<span class="jill"></span>服务器和反向代理服务器。无论是在处理静态内容、实现反向代理和负载均衡还是作为<span class="jill"></span>API<span class="jill"></span>网关等方面，Nginx<span class="jill"></span>都展现出了卓越的性能和稳定性。对于需要构建高效、可靠和可扩展的<span class="jill"></span>Web<span class="jill"></span>应用和服务的组织来说，Nginx<span class="jill"></span>是一个值得考虑的选择。</span></div></div><div id="b7FBhPCZU4sVZyt7RLXhnX" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="k3dedpm7hBnHRtgFpa8rd4" class="wolai-block wolai-text"><div><span class="inline-wrap">IT<span class="jill"></span>界的<span class="jill"></span>AK47：</span></div></div><div id="cLSSJ2XQGqRYjju4E2GFrh" class="wolai-block"><figure class="wolai-center" style="width: 399.9999913302337px; flex-direction: column"><img src="media/zjaf2es1tk.jpg" style="width: 100%"/></figure></div><div id="epe3BeZgdvgD13bBE9qPLv" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="3M9E6CfkDdjR2rs7L8aqMf" class="wolai-block"><span class="wolai-serial-number">2</span><span class="inline-wrap">Nginx<span class="jill"></span>的主要功能有哪些？</span></h1><div id="7u8KVtNLeVFNV3xvEEvCpd" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>的主要功能包括</span><span class="inline-wrap"><b>负载均衡、反向代理、动静分离以及配置<span class="jill"></span>HTTPS<span class="jill"></span>等</b></span><span class="inline-wrap">。以下是对其主要功能的详细阐述：</span></div></div><ol class="wolai-block"><li id="hEJzirmpE1mR9EL6sv9GmM"><div class="marker"></div><span class="inline-wrap"><b>负载均衡</b></span><ul class="wolai-block"><li id="vdaNm4H6daAkzCURGMH4fq"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>概念和重要性</b></span><span class="inline-wrap">：负载均衡是一种计算机网络基础技术，主要用于优化资源使用，最大化吞吐率，最小化响应时间，同时避免过载。通过引入一个负载均衡器和至少一个额外的<span class="jill"></span>web<span class="jill"></span>服务器，可以显著提高网站的稳定性和可用性。</span></li><li id="i7pqt5BeQ8NyPcP62KeRfH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>实现方式</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>支持多种负载均衡算法，如轮询、IP<span class="jill"></span>哈希、最少连接数等，可以根据实际需求将客户端请求分发到不同的后端服务器上，以达到优化资源利用和提高系统性能的目的。</span></li></ul></li><li id="aaHa6U2R1Y93ABx5uHUqmg"><div class="marker"></div><span class="inline-wrap"><b>反向代理</b></span><ul class="wolai-block"><li id="dSd7wQY6ir7VU8kRfJ2b3H"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>定义和作用</b></span><span class="inline-wrap">：反向代理是指以代理服务器来接受互联网上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给互联网上请求连接的客户端。这种方式使得真实服务器不能直接被外部网络访问，从而增加了安全性。</span></li><li id="9jgoe93gXd3neYw1pGbvQp"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>应用场景</b></span><span class="inline-wrap">：反向代理广泛应用于解决浏览器跨域访问问题。当协议、域名、端口号有一项或多项不同时，便违反了同源策略，需要跨域。前端跨域常用的方法之一就是使用<span class="jill"></span>Nginx<span class="jill"></span>作为反向代理服务器。</span></li></ul></li><li id="aXmZv7p5DcCYwjccsMF8hK"><div class="marker"></div><span class="inline-wrap"><b>动静分离</b></span><ul class="wolai-block"><li id="9kBCv7SG3JAKVdqUNehWGo"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>概念</b></span><span class="inline-wrap">：动静分离是指将静态资源（如图片、视频、CSS、JavaScript<span class="jill"></span>等）与动态内容（如<span class="jill"></span>PHP、Java、Python<span class="jill"></span>等生成的内容）分开存储和传输，以提高网站的加载速度和用户体验。</span></li><li id="p2NmFyhyE8NUdtRsfJCobZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>实现方式</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>可以通过配置静态文件路径和缓存策略来实现动静分离。例如，可以将静态文件缓存到内存中，从而减轻后端服务器的负载。</span></li></ul></li><li id="5dQKM5sDevpzibozhCS8vf"><div class="marker"></div><span class="inline-wrap"><b>配置<span class="jill"></span>HTTPS</b></span><ul class="wolai-block"><li id="nxgPKZDwim72Zt5PTcQxwA"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性提升</b></span><span class="inline-wrap">：HTTPS<span class="jill"></span>是<span class="jill"></span>HTTP<span class="jill"></span>的安全版本，通过<span class="jill"></span>SSL/TLS<span class="jill"></span>协议为数据通信提供加密保护，确保数据传输的安全性。Nginx<span class="jill"></span>可以作为<span class="jill"></span>SSL/TLS<span class="jill"></span>终端代理，对外提供<span class="jill"></span>HTTPS<span class="jill"></span>服务，负责<span class="jill"></span>SSL/TLS<span class="jill"></span>握手、证书验证等操作，并将加密的请求转发到后端服务器。</span></li><li id="2ELC2Bn7f36fVw6CHtyi2U"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>配置步骤</b></span><span class="inline-wrap">：配置<span class="jill"></span>HTTPS<span class="jill"></span>通常需要在<span class="jill"></span>Nginx<span class="jill"></span>的配置文件中指定<span class="jill"></span>SSL<span class="jill"></span>证书和私钥的路径，并启用<span class="jill"></span>SSL<span class="jill"></span>模块。具体配置方法可以参考<span class="jill"></span>Nginx<span class="jill"></span>官方文档或相关教程。</span></li></ul></li></ol><div id="kjoq26iNNqb4NSJzBfN5Po" class="wolai-block wolai-text"><div><span class="inline-wrap">综上所述，Nginx<span class="jill"></span>是一个功能强大且灵活的<span class="jill"></span>Web<span class="jill"></span>服务器和反向代理服务器，具有负载均衡、反向代理、动静分离以及配置<span class="jill"></span>HTTPS<span class="jill"></span>等多种主要功能。这些功能使得<span class="jill"></span>Nginx<span class="jill"></span>在构建高性能、可靠和可扩展的<span class="jill"></span>Web<span class="jill"></span>应用和服务方面具有显著优势。</span></div></div><div id="iiRZdENgNoC3Za2zUwsaCQ" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="gq3MHnULimodUXS9zGrfTo" class="wolai-block"><span class="wolai-serial-number">3</span><span class="inline-wrap">Nginx<span class="jill"></span>与<span class="jill"></span>Apache<span class="jill"></span>相比有哪些优势？</span></h1><div id="unPpit7rPfipd2XzbveqmA" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>与<span class="jill"></span>Apache<span class="jill"></span>相比，在</span><span class="inline-wrap"><b>性能、资源占用以及配置管理</b></span><span class="inline-wrap">等方面存在区别。以下是具体分析：</span></div></div><ol class="wolai-block"><li id="5U9C69vSB3sWc6pw2PJyXK"><div class="marker"></div><span class="inline-wrap"><b>性能</b></span><ul class="wolai-block"><li id="GFrp24TozzQknMjj9Jrun"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Nginx</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>在处理高并发请求时表现出色，能够支持高达<span class="jill"></span>50,000<span class="jill"></span>个并发连接数。它采用异步非阻塞的事件驱动架构，可以高效地处理大量并发连接，特别适合高流量的网站和应用程序。</span></li><li id="t3y2AZdr8YfLoupyWeBHkD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Apache</b></span><span class="inline-wrap">：Apache<span class="jill"></span>使用多线程模型，每个连接通常使用一个线程。在高并发环境下，Apache<span class="jill"></span>可能会出现性能瓶颈，因为每个进程或线程都会消耗较多的系统资。</span></li></ul></li><li id="wuRLjVQuSSaK99u4w9TuWf"><div class="marker"></div><span class="inline-wrap"><b>资源占用</b></span><ul class="wolai-block"><li id="9YW3pjtrtHK7tUSeDtRXNJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Nginx</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>通常比<span class="jill"></span>Apache<span class="jill"></span>占用更少的内存和<span class="jill"></span>CPU<span class="jill"></span>资源，这意味着在相同硬件条件下，Nginx<span class="jill"></span>可以支持更多的同时连接。其轻量级特性使得它在资源有限的环境中（如虚拟私有服务器或容器化部署）表现更佳。</span></li><li id="7vkUDWekpcD2wUT4vVHkDy"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Apache</b></span><span class="inline-wrap">：Apache<span class="jill"></span>在处理相同数量的并发请求时，会消耗更多的资源，特别是在内存使用方面。</span></li></ul></li><li id="35X9mNiavY9Xcso2v6gbUX"><div class="marker"></div><span class="inline-wrap"><b>配置管理</b></span><ul class="wolai-block"><li id="89nxRvc9Z8fbA6HK9BtjNP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Nginx</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>的配置相对简单和直观，配置文件使用一个语法简洁的配置语言，许多高级功能，如负载均衡，可以通过简单的配置实现。它还支持热部署，可以在不间断服务的情况下进行软件版本的升级与回退。</span></li><li id="rEASXcs9obsusEqLiZPRYh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Apache</b></span><span class="inline-wrap">：Apache<span class="jill"></span>的配置文件较为复杂，需要较长的学习曲线。修改配置后，只能手工重启服务或者使用第三方插件实现热部署，期间服务会出现短暂的不可用。</span></li></ul></li><li id="cRqaadj3ZJGihRHAdyGfTt"><div class="marker"></div><span class="inline-wrap"><b>适用场景</b></span><ul class="wolai-block"><li id="4cSn5VLYYtnWQFjvNskHLK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Nginx</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>适合处理静态内容、反向代理和负载均衡等任务。它的异步事件处理机制使其在高并发场景下表现更为出色。</span></li><li id="gfiHH3WnUJAwQPcEQS4cik"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>Apache</b></span><span class="inline-wrap">：Apache<span class="jill"></span>更适合处理动态内容和复杂的<span class="jill"></span>URL<span class="jill"></span>重写等任务。由于其模块化设计，用户可以轻松地通过配置文件启用或关闭各种模块，提供极高的灵活性。</span></li></ul></li></ol><div id="oi6AQ3G9rk3x9AonybCKA3" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，Nginx<span class="jill"></span>在处理高并发请求和静态内容方面具有显著优势，而<span class="jill"></span>Apache<span class="jill"></span>则在处理动态内容和复杂<span class="jill"></span>URL<span class="jill"></span>重写方面表现更好。选择哪个<span class="jill"></span>Web<span class="jill"></span>服务器应根据具体的项目需求和技术团队的经验来做出决策。</span></div></div><div id="v2DQJ28XrdEZwc6PLHGqT5" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="nPPYxUeCC2oRTFPY1gZ8c3" class="wolai-block"><span class="wolai-serial-number">4</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置一个虚拟主机？</span></h1><div id="eFNCStd6mDzm6LMK86aErZ" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置虚拟主机，可以通过</span><span class="inline-wrap"><b>创建配置文件、设置基本信息以及文档根目录等</b></span><span class="inline-wrap">步骤实现。以下是关于如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置一个虚拟主机的具体分析：</span></div></div><ol class="wolai-block"><li id="7n1YRWeG7Ec6d7tnWqEZD5"><div class="marker"></div><span class="inline-wrap"><b>创建配置文件</b></span><span class="inline-wrap">：在</span><span class="inline-wrap"><code>nginx/conf.d</code></span><span class="inline-wrap">目录下（默认路径，可以根据实际情况调整），新建一个</span><span class="inline-wrap"><code>.conf</code></span><span class="inline-wrap">文件，例如</span><span class="inline-wrap"><code>example.com.conf</code></span><span class="inline-wrap">。</span></li><li id="gv5kTJym93fazAcfg2WDMa"><div class="marker"></div><span class="inline-wrap"><b>设置基本信息</b></span><span class="inline-wrap">：在配置文件中，添加以下基础信息，定义监听的端口和虚拟主机的名称：</span><code-block id="dTSarXekyHWu9wCmBjpxAN" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span> <span class="token comment"># 或者443（如果启用HTTPS）</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="uPABJ9NzXdCcYcTg359vHC"><div class="marker"></div><span class="inline-wrap"><b>文档根目录</b></span><span class="inline-wrap">：指定站点的主目录，例如：</span><code-block id="bVLGamqi5NQiu1e93wBW4u" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">root</span> /var/www/example.com</span><span class="token punctuation">;</span> <span class="token comment"># 这里替换为你实际的网站文件夹路径</span></pre></div></code-block></li><li id="6tJ4JwbjkGKVH39WgqDd7c"><div class="marker"></div><span class="inline-wrap"><b>访问控制和<span class="jill"></span>SSL<span class="jill"></span>配置（如有必要）</b></span><span class="inline-wrap">：如果需要<span class="jill"></span>HTTPS，可以加入<span class="jill"></span>SSL<span class="jill"></span>证书和密钥：</span><code-block id="tQPAVmUDNxzJF2XTCdwX9A" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">ssl_certificate</span> /path/to/your.crt</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">ssl_certificate_key</span> /path/to/your.key</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="9ReDzhTfzEpaeKsAQgNyFc"><div class="marker"></div><span class="inline-wrap"><b>错误页面和日志设置</b></span><span class="inline-wrap">：设置错误页面和访问日志的位置：</span><code-block id="p7gbSBoNMcPwrrr8zBZz85" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /404.html</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">access_log</span> /var/log/nginx/example.access.log main</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="cC9F77B8PC2B3czkDmzwah"><div class="marker"></div><span class="inline-wrap"><b>启用虚拟主机</b></span><span class="inline-wrap">：最后，在</span><span class="inline-wrap"><code>nginx.conf</code></span><span class="inline-wrap">的</span><span class="inline-wrap"><code>http</code></span><span class="inline-wrap">块中包含你新创建的虚拟主机配置，如未包含则添加：</span><code-block id="avDY7gexBNxw6AuWMWTH1Q" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre>include /etc/nginx/conf.d/*.conf</pre></div></code-block></li></ol><div id="jj67TiHwUcY24Gg7ZBNkmR" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置一个虚拟主机。配置完成后，不要忘记重启<span class="jill"></span>Nginx<span class="jill"></span>服务以使更改生效。根据具体需求，还可以进一步优化配置，如设置负载均衡、反向代理等高级功能。</span></div></div><div id="8tSMWwmpp9poJExU2PYy5M" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="tPzZzoUVDTMtfMnLcXTBvC" class="wolai-block"><span class="wolai-serial-number">5</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>upstream<span class="jill"></span>模块及其用途。</span></h1><div id="fMh5eDP87jryeoJkWeiDK2" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Nginx<span class="jill"></span>中的<span class="jill"></span>upstream<span class="jill"></span>模块用于定义后端服务器组，并管理与这些服务器的通信方式</b></span><span class="inline-wrap">。以下是关于<span class="jill"></span>upstream<span class="jill"></span>模块的具体介绍：</span></div></div><ol class="wolai-block"><li id="p22X5FxkKUwjijyXbXdBK5"><div class="marker"></div><span class="inline-wrap"><b>基本概念</b></span><ul class="wolai-block"><li id="r4H9A4S44phPM11S1QJd6M"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>定义</b></span><span class="inline-wrap">：upstream<span class="jill"></span>模块允许用户在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中定义一组或多组后端服务器。这些服务器可以是不同的物理服务器或同一台服务器的不同应用端口。</span></li><li id="vDgvNVzSSs1o95kPMigTUh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>用途</b></span><span class="inline-wrap">：通过<span class="jill"></span>upstream<span class="jill"></span>模块，可以将客户端请求分发到不同的后端服务器上，从而实现负载均衡和高可用性。</span></li></ul></li><li id="oTRgHb7AxG7KdVevEV2cJm"><div class="marker"></div><span class="inline-wrap"><b>配置方法</b></span><ul class="wolai-block"><li id="oXAFkykMcfP1Qyk9DNUjhh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>语法结构</b></span><span class="inline-wrap">：在<span class="jill"></span>nginx.conf<span class="jill"></span>的<span class="jill"></span>http<span class="jill"></span>块内定义<span class="jill"></span>upstream<span class="jill"></span>块，使用<span class="jill"></span>server<span class="jill"></span>关键字指定后端服务器的<span class="jill"></span>IP<span class="jill"></span>地址、端口号以及相关参数。例如：</span><code-block id="72f23gsEggLmhf3o7p3WZc" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> backend1.example.com weight=5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> unix:/tmp/backend3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="ebmkW4gjH31SjZdXVyUe2C"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>参数说明</b></span><span class="inline-wrap">：常用的参数包括<span class="jill"></span>weight（权重）、max_fails（最大失败次数）、fail_timeout（失败超时时间）等。这些参数帮助<span class="jill"></span>Nginx<span class="jill"></span>更智能地分配请求，提高系统的稳定性和效率。</span></li></ul></li><li id="dJUKjuWwVpjkqK6CkYV2se"><div class="marker"></div><span class="inline-wrap"><b>调度算法</b></span><ul class="wolai-block"><li id="9j2cCsHcQ4AjDG5Tg8K7ZE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>静态调度算法</b></span><span class="inline-wrap">：如轮询（rr）、加权轮询（wrr）、ip<span class="jill"></span>哈希（ip_hash）等。这些算法根据预定义的规则分配请求，不考虑后端服务器的实时状态。</span></li><li id="cqxfs84rKmMJFcH4Phf9e2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>动态调度算法</b></span><span class="inline-wrap">：如<span class="jill"></span>least_conn（最少连接数）和<span class="jill"></span>fair（响应时间）等。这些算法会根据后端服务器的当前负载情况动态调整请求分配，更加智能和高效。</span></li></ul></li></ol><div id="cVhbYxtfwoi9eFTSJDuCr" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，upstream<span class="jill"></span>模块是<span class="jill"></span>Nginx<span class="jill"></span>实现高性能、高可用性和可扩展性的关键组件之一。通过合理配置<span class="jill"></span>upstream<span class="jill"></span>模块，可以显著提升<span class="jill"></span>Web<span class="jill"></span>应用的性能和稳定性。</span></div></div><div id="2gHJm7uCUh6sFRSdS5DY5R" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="cBvuaMKNHeWzFaR6A8VDjs" class="wolai-block"><span class="wolai-serial-number">6</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中实现负载均衡？</span></h1><div id="d3zesauWCt6qhqUviXbvcT" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中实现负载均衡，可以通过</span><span class="inline-wrap"><b>配置<span class="jill"></span>upstream<span class="jill"></span>模块和代理设置</b></span><span class="inline-wrap">来实现。以下是具体步骤：</span></div></div><ol class="wolai-block"><li id="poyLnBXiQfS4w4zugYpNwC"><div class="marker"></div><span class="inline-wrap"><b>定义后端服务器组</b></span><span class="inline-wrap">：在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中（通常是</span><span class="inline-wrap"><code>nginx.conf</code></span><span class="inline-wrap">），使用</span><span class="inline-wrap"><code>upstream</code></span><span class="inline-wrap">指令定义一个后端服务器组。例如，创建一个名为</span><span class="inline-wrap"><code>backend</code></span><span class="inline-wrap">的服务器组，并添加多个后端服务器：</span><code-block id="7juK8K62zXVqvjSnLpe1Za" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.101</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.102</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.103</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="kJLjuYhXUfbSGKCuo8KM2S"><div class="marker"></div><span class="inline-wrap"><b>配置负载均衡算法</b></span><span class="inline-wrap">：在</span><span class="inline-wrap"><code>upstream</code></span><span class="inline-wrap">块中，可以指定不同的负载均衡算法，如轮询（默认）、加权轮询、最少连接数等。例如，使用加权轮询算法：</span><code-block id="kuWTiu4eeyaEZQXGNM9Wv9" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.101 weight=3</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.102 weight=1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.103 weight=2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="oGCLKw2c19vLf8jxpG4oLU"><div class="marker"></div><span class="inline-wrap"><b>设置代理转发</b></span><span class="inline-wrap">：在</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块中，使用</span><span class="inline-wrap"><code>proxy_pass</code></span><span class="inline-wrap">指令将请求转发到定义的后端服务器组。例如：</span><code-block id="jEaMjwK4eyJSrGZHaE2F2z" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="2nKdFByo3AgES7PAcjdK9R"><div class="marker"></div><span class="inline-wrap"><b>高级配置</b></span><span class="inline-wrap">：根据需要，可以进一步优化负载均衡的配置，如设置健康检查、调整超时时间、启用缓存等。例如，启用健康检查：</span><code-block id="mJdJg1PsFVkERazd9d5vyV" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.101 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.102 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.1.103 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="9MD3codWFcnDkv5SmTrcva"><div class="marker"></div><span class="inline-wrap"><b>重启<span class="jill"></span>Nginx<span class="jill"></span>服务</b></span><span class="inline-wrap">：完成配置后，保存文件并重启<span class="jill"></span>Nginx<span class="jill"></span>服务以使更改生效：</span><code-block id="appvqVp2M4mzzWPDytuZE8" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li></ol><div id="wc1voqL3zCNcoeaRDqPaui" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，可以在<span class="jill"></span>Nginx<span class="jill"></span>中实现高效的负载均衡，从而提高<span class="jill"></span>Web<span class="jill"></span>应用的性能和可靠性。</span></div></div><div id="dDPoWALU7fT69x64d75iiX" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="cbXCK6zJv7Q6tKNxDGZiFQ" class="wolai-block"><span class="wolai-serial-number">7</span><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中如何配置<span class="jill"></span>SSL/TLS？</span></h1><div id="ppoNPDE9SzyxNgGrHiDLwm" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>SSL/TLS，可以通过</span><span class="inline-wrap"><b>获取<span class="jill"></span>SSL<span class="jill"></span>证书、修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件以及重启服务</b></span><span class="inline-wrap">来实现。以下是具体步骤：</span></div></div><ol class="wolai-block"><li id="guvSDcEXSizRRFcsMnykxi"><div class="marker"></div><span class="inline-wrap"><b>获取<span class="jill"></span>SSL<span class="jill"></span>证书</b></span><span class="inline-wrap">：首先，需要从可信的证书颁发机构（CA）获取<span class="jill"></span>SSL<span class="jill"></span>证书。这通常包括一个证书文件（</span><span class="inline-wrap"><code>.crt</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>.pem</code></span><span class="inline-wrap">格式）和一个私钥文件（</span><span class="inline-wrap"><code>.key</code></span><span class="inline-wrap">格式）。如果使用的是<span class="jill"></span>Let&#39;s Encrypt<span class="jill"></span>等免费证书，可以使用<span class="jill"></span>Certbot<span class="jill"></span>等工具自动获取和续订证书。</span></li><li id="kF2WneF73igyxF72RvpLxL"><div class="marker"></div><span class="inline-wrap"><b>修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：在<span class="jill"></span>Nginx<span class="jill"></span>的配置文件中（通常是</span><span class="inline-wrap"><code>nginx.conf</code></span><span class="inline-wrap">或位于</span><span class="inline-wrap"><code>/etc/nginx/sites-available/</code></span><span class="inline-wrap">目录下的某个文件），为需要启用<span class="jill"></span>HTTPS<span class="jill"></span>的服务器块添加<span class="jill"></span>SSL<span class="jill"></span>配置。例如：</span><code-block id="fFyBcwUoeWGNKUzkGV297D" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /path/to/your_domain_name.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /path/to/your_private.key</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_session_cache</span> shared:SSL:1m</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_session_timeout</span>  <span class="token number">10m</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_ciphers</span> HIGH:!aNULL:!MD5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="6CLnzYUuDWzJLQfLiciJjZ"><div class="marker"></div><span class="inline-wrap"><b>配置<span class="jill"></span>HTTP<span class="jill"></span>到<span class="jill"></span>HTTPS<span class="jill"></span>的重定向</b></span><span class="inline-wrap">：为了确保所有<span class="jill"></span>HTTP<span class="jill"></span>请求都被重定向到<span class="jill"></span>HTTPS，可以在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中添加一个新的服务器块来处理<span class="jill"></span>HTTP<span class="jill"></span>请求：</span><code-block id="sbDx2xwSU9M9JmVmq9PebX" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="geYdDAtcEBpjieahnWCU84"><div class="marker"></div><span class="inline-wrap"><b>测试配置并重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在应用更改之前，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置文件的语法是否正确：</span><code-block id="sxxhjt1Wm1NfZY6psBj8zq" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block><div id="9BHwtFHqnGDJ3fDmaLXXqb" class="wolai-block wolai-text"><div><span class="inline-wrap">如果测试通过，没有错误信息，则可以安全地重启<span class="jill"></span>Nginx<span class="jill"></span>以使更改生效：</span></div></div><code-block id="jB93UkJ6EWRMJRxAv1u5NF" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li><li id="WuaED8rDERapX8s3MrCuH"><div class="marker"></div><span class="inline-wrap"><b>自动更新证书</b></span><span class="inline-wrap">：如果使用<span class="jill"></span>Let&#39;s Encrypt<span class="jill"></span>等服务，可以设置定时任务（cron job）来自动更新证书。Certbot<span class="jill"></span>提供了自动更新证书的命令，可以添加到<span class="jill"></span>crontab<span class="jill"></span>中定期执行。</span></li></ol><div id="j7H4gvT5gRQhGEr1W1TFEy" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置<span class="jill"></span>SSL/TLS，增强网站的安全性。</span></div></div><div id="3fefvm98wTXB75Herq9b5x" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="9wX2F9uwrceTcdWvmgzaVS" class="wolai-block"><span class="wolai-serial-number">8</span><span class="inline-wrap">什么是<span class="jill"></span>Nginx<span class="jill"></span>的反向代理？</span></h1><div id="syjUXq2BMMoJa6AvKiK6KZ" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Nginx<span class="jill"></span>的反向代理是指将客户端请求转发到后端服务器，并将后端服务器的响应返回给客户端的过程</b></span><span class="inline-wrap">。以下是关于<span class="jill"></span>Nginx<span class="jill"></span>反向代理的具体介绍：</span></div></div><ol class="wolai-block"><li id="uZY4HvanqRvoyaSTcmC2m"><div class="marker"></div><span class="inline-wrap"><b>基本概念</b></span><ul class="wolai-block"><li id="fLGpwmT8y6NDy6EsDDRhVP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>定义</b></span><span class="inline-wrap">：反向代理是代理服务器的一种，它位于客户端和原始服务器之间，对客户端透明，即客户端认为它直接与原始服务器通信。</span></li><li id="gR53JBdZLbWmFvnmNZFMWj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>作用</b></span><span class="inline-wrap">：反向代理主要用于负载均衡、缓存静态内容、提高安全性等目的。它可以将请求分发到多个后端服务器上，从而提高应用的可用性和扩展性。</span></li></ul></li><li id="eBxFuBEJyhmQV5cTe2Eeq2"><div class="marker"></div><span class="inline-wrap"><b>配置方法</b></span><ul class="wolai-block"><li id="q8UCud57WKEYWQwRcFgLfr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>基本配置</b></span><span class="inline-wrap">：在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中（通常是</span><span class="inline-wrap"><code>nginx.conf</code></span><span class="inline-wrap">），使用</span><span class="inline-wrap"><code>proxy_pass</code></span><span class="inline-wrap">指令设置反向代理。例如，将所有以</span><span class="inline-wrap"><code>/app</code></span><span class="inline-wrap">开头的请求转发到后端服务器组</span><span class="inline-wrap"><code>backend</code></span><span class="inline-wrap">：</span><code-block id="eBFSDaDT6fGBGhKGfd1xsG" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /app</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="gpjprCa5JoSQDQxSXp9yp7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>高级配置</b></span><span class="inline-wrap">：可以进一步配置反向代理的行为，如设置超时时间、修改请求头、启用<span class="jill"></span>WebSocket<span class="jill"></span>支持等。例如，设置代理连接超时时间为<span class="jill"></span>60<span class="jill"></span>秒：</span><code-block id="vBYKN941xrcJqyECGzGjfo" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /app</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li></ul></li><li id="jZshsrZ7KSbxGM155eDgNT"><div class="marker"></div><span class="inline-wrap"><b>应用场景</b></span><ul class="wolai-block"><li id="waW8kE3PUEZoEkKP8VsKi1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡</b></span><span class="inline-wrap">：通过反向代理，可以将客户端请求均匀分配到多个后端服务器上，避免单点故障，提高系统的可用性和性能。</span></li><li id="3qxHhnWmR5kigMDYiGNFf8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>内容缓存</b></span><span class="inline-wrap">：反向代理可以缓存后端服务器的响应，减少对原始服务器的请求压力，加快响应速度。</span></li><li id="tSoWb6tta8PSefQjytR5ar"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全增强</b></span><span class="inline-wrap">：反向代理可以隐藏后端服务器的真实<span class="jill"></span>IP<span class="jill"></span>地址，增加一层安全防护，防止直接攻击后端服务器。</span></li></ul></li></ol><div id="uFBrX3a7orexZmupYJBi7e" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，Nginx<span class="jill"></span>的反向代理功能是构建高性能、可扩展和安全的<span class="jill"></span>Web<span class="jill"></span>应用的关键组件之一。通过合理配置反向代理，可以显著提升系统的整体性能和可靠性。</span></div></div><div id="i2ZR9ZczyrMjecQsmhZKQD" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="5iYr88HwBp2r5mzA1fEXR1" class="wolai-block"><span class="wolai-serial-number">9</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中设置访问控制（例如：IP<span class="jill"></span>白名单和黑名单）？</span></h1><div id="g5wd6nvXrcM5ULpzFcgnmp" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中设置访问控制，可以通过</span><span class="inline-wrap"><b>配置访问规则来实现<span class="jill"></span>IP<span class="jill"></span>白名单和黑名单</b></span><span class="inline-wrap">。以下是具体步骤：</span></div></div><ol class="wolai-block"><li id="uDLW8UKAb6Co4Yd8Siep3s"><div class="marker"></div><span class="inline-wrap"><b>IP<span class="jill"></span>白名单</b></span><span class="inline-wrap">：允许特定<span class="jill"></span>IP<span class="jill"></span>地址或<span class="jill"></span>IP<span class="jill"></span>段访问服务器。</span><ul class="wolai-block"><li id="fYvvwzqKUyN4YpeEBHde6p"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中（通常是</span><span class="inline-wrap"><code>nginx.conf</code></span><span class="inline-wrap">），使用</span><span class="inline-wrap"><code>allow</code></span><span class="inline-wrap">指令指定允许的<span class="jill"></span>IP<span class="jill"></span>地址。例如，只允许<span class="jill"></span>IP<span class="jill"></span>地址</span><span class="inline-wrap"><code>192.168.1.100</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>192.168.1.101</code></span><span class="inline-wrap">访问：</span><code-block id="beX6Sck27BPWQ1s3MbasvA" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">allow</span> 192.168.1.100</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">allow</span> 192.168.1.101</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="jvPD6ZABWjN1nB9XMaHbZg"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果需要允许一个<span class="jill"></span>IP<span class="jill"></span>段，可以使用<span class="jill"></span>CIDR<span class="jill"></span>表示法。例如，允许整个</span><span class="inline-wrap"><code>192.168.1.0/24</code></span><span class="inline-wrap">网段访问：</span><code-block id="tWmkgHqchqNcstb2sCb2nF" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">allow</span> 192.168.1.0/24</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li></ul></li><li id="wpCHQWMGM5tazzK8LbPA4o"><div class="marker"></div><span class="inline-wrap"><b>IP<span class="jill"></span>黑名单</b></span><span class="inline-wrap">：拒绝特定<span class="jill"></span>IP<span class="jill"></span>地址或<span class="jill"></span>IP<span class="jill"></span>段访问服务器。</span><ul class="wolai-block"><li id="r34oE1cieve5jh2Ka7B9Cx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中，使用</span><span class="inline-wrap"><code>deny</code></span><span class="inline-wrap">指令指定拒绝的<span class="jill"></span>IP<span class="jill"></span>地址。例如，拒绝<span class="jill"></span>IP<span class="jill"></span>地址</span><span class="inline-wrap"><code>192.168.1.200</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>192.168.1.201</code></span><span class="inline-wrap">访问：</span><code-block id="hiST2YzQ6y5WexjJQbZcDD" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">deny</span> 192.168.1.200</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">deny</span> 192.168.1.201</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="7BNUVvt4AeTRTrGN4aPF2e"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">同样地，可以使用<span class="jill"></span>CIDR<span class="jill"></span>表示法来拒绝一个<span class="jill"></span>IP<span class="jill"></span>段。例如，拒绝整个</span><span class="inline-wrap"><code>192.168.2.0/24</code></span><span class="inline-wrap">网段访问：</span><code-block id="fEFnJBXPkSfqK8Hyz2LxCL" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> 192.168.2.0/24</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li></ul></li><li id="q6fSkP6sDzq6aBSsUBr66s"><div class="marker"></div><span class="inline-wrap"><b>组合使用白名单和黑名单</b></span><span class="inline-wrap">：可以同时使用</span><span class="inline-wrap"><code>allow</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>deny</code></span><span class="inline-wrap">指令来创建更复杂的访问控制规则。例如，允许特定<span class="jill"></span>IP<span class="jill"></span>段访问，但拒绝其中的某些<span class="jill"></span>IP：</span><code-block id="hFrVkT6SmbWQLCkJQh5Y16" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">allow</span> 192.168.1.0/24</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">deny</span> 192.168.1.102</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">deny</span> 192.168.1.103</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="r74tMnAanvwNBmcSctDiXQ"><div class="marker"></div><span class="inline-wrap"><b>测试配置并重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在应用更改之前，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置文件的语法是否正确：</span><code-block id="d2WhpCHWZwiRGA5HsbAH3m" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block><div id="fNi78NnSAQJQbBQ61wrzrq" class="wolai-block wolai-text"><div><span class="inline-wrap">如果测试通过，没有错误信息，则可以安全地重启<span class="jill"></span>Nginx<span class="jill"></span>以使更改生效：</span></div></div><code-block id="qGz8mTXKhSJSC37bRv4Kwv" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li></ol><div id="tsQXQaEH2UV99Uk1wkmz7d" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，可以在<span class="jill"></span>Nginx<span class="jill"></span>中灵活地设置访问控制，包括<span class="jill"></span>IP<span class="jill"></span>白名单和黑名单，从而增强服务器的安全性。</span></div></div><div id="e6Y2JwWdbeiSdhDVwQSJVu" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="8BewtFY2MmUvq33PCsGD82" class="wolai-block"><span class="wolai-serial-number">10</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中进行静态资源压缩和缓存？</span></h1><div id="u15ULWoRiyfzsjkk6x2Af9" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中进行静态资源压缩和缓存，可以通过</span><span class="inline-wrap"><b>配置<span class="jill"></span>gzip<span class="jill"></span>模块和设置缓存头</b></span><span class="inline-wrap">来实现。以下是具体步骤：</span></div></div><ol class="wolai-block"><li id="5LP9AeqT72c4PnvbZoZapB"><div class="marker"></div><span class="inline-wrap"><b>启用<span class="jill"></span>gzip<span class="jill"></span>压缩</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="urnqvpwjSnPJ9GyE17XZuK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中（通常是</span><span class="inline-wrap"><code>nginx.conf</code></span><span class="inline-wrap">），使用</span><span class="inline-wrap"><code>gzip</code></span><span class="inline-wrap">指令来启用<span class="jill"></span>gzip<span class="jill"></span>压缩。可以在</span><span class="inline-wrap"><code>http</code></span><span class="inline-wrap">块或</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块中进行配置。例如，启用<span class="jill"></span>gzip<span class="jill"></span>压缩并设置压缩级别为<span class="jill"></span>5：</span><code-block id="wWPtNy4UKqMkc6SscVkTzL" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/plain application/xml text/css application/javascript</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">256</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">5</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="auCZuuzHg47nvNaHC3F4KJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>gzip_types</code></span><span class="inline-wrap">指令指定要压缩的<span class="jill"></span>MIME<span class="jill"></span>类型。可以根据需要添加或删除类型。</span></li><li id="6vzJqqa38iKNEuozXp95N6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>gzip_vary on</code></span><span class="inline-wrap">指令会在响应头中添加</span><span class="inline-wrap"><code>Vary: Accept-Encoding</code></span><span class="inline-wrap">，以便代理服务器正确处理压缩内容。</span></li><li id="reqrqjUdKf3dQwNPh92bBu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>gzip_min_length</code></span><span class="inline-wrap">指令设置触发压缩的最小响应体长度。</span></li><li id="rnGVXTdNVL63yXnMSoae4H"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>gzip_comp_level</code></span><span class="inline-wrap">指令设置压缩级别，范围是<span class="jill"></span>1<span class="jill"></span>到<span class="jill"></span>9，数字越大压缩率越高，但<span class="jill"></span>CPU<span class="jill"></span>占用也更高。</span></li><li id="5cH4cgPP6uf55uCZp9sLhM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>gzip_proxied</code></span><span class="inline-wrap">指令指定哪些请求应该被压缩，</span><span class="inline-wrap"><code>any</code></span><span class="inline-wrap">表示所有请求都压缩。</span></li><li id="xqSkcaaFxzCqYPF1xarvpJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>gzip_buffers</code></span><span class="inline-wrap">指令设置用于存储压缩数据的缓冲区数量和大小。</span></li></ul></li><li id="5j3miTvSSMmFm24h2VKHTz"><div class="marker"></div><span class="inline-wrap"><b>设置缓存头</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="hbTcyymKHpT7DeGVVjTuyn"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中，使用</span><span class="inline-wrap"><code>expires</code></span><span class="inline-wrap">指令设置静态资源的缓存时间。例如，设置图片、CSS<span class="jill"></span>和<span class="jill"></span>JavaScript<span class="jill"></span>文件的缓存时间为<span class="jill"></span>30<span class="jill"></span>天：</span><code-block id="eWgiAovUdDsN9YyKppMMfZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> ~* \.(jpg|jpeg|png|gif|ico|css|js)$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, no-transform"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="i2gbCqLwpLGJFywukqmgbF"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>expires</code></span><span class="inline-wrap">指令设置资源的过期时间，可以使用不同的时间单位，如秒（s）、分钟（m）、小时（h）、天（d）。</span></li><li id="qyHYncfrFQhytk5Kb22Gsw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>add_header</code></span><span class="inline-wrap">指令添加<span class="jill"></span>HTTP<span class="jill"></span>头信息，</span><span class="inline-wrap"><code>Cache-Control</code></span><span class="inline-wrap">头可以控制缓存行为，如</span><span class="inline-wrap"><code>public</code></span><span class="inline-wrap">表示响应可以被任何缓存存储，</span><span class="inline-wrap"><code>no-transform</code></span><span class="inline-wrap">表示中间代理不能改变媒体类型的编码。</span></li></ul></li><li id="qhAr57DwM4bAgzP3p4sieL"><div class="marker"></div><span class="inline-wrap"><b>测试配置并重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="8NewEZyRWLDpMdLjx7CWvF"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在应用更改之前，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置文件的语法是否正确：</span><code-block id="uqwZ8qxTGcKfU6BvK7bWLM" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block></li><li id="7bHVHa49hqDV3AkGM2ewXN"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果测试通过，没有错误信息，则可以安全地重启<span class="jill"></span>Nginx<span class="jill"></span>以使更改生效：</span><code-block id="aTb6ibbtBZndKzxYhwcnqY" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li></ul></li></ol><div id="2oVB4u5CmESBPKTEcMRC7q" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，可以在<span class="jill"></span>Nginx<span class="jill"></span>中有效地进行静态资源压缩和缓存，从而提高网站的性能和用户体验。</span></div></div><div id="4nPaKSta3SrU4LVof3amJ1" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="da5gdGAESGUiVeTfVjNNdK" class="wolai-block"><span class="wolai-serial-number">11</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的事件驱动模型。</span></h1><div id="hfm3qCGdBJ5wtNXCfyiBv4" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Nginx<span class="jill"></span>中的事件驱动模型</b></span><span class="inline-wrap">是一种高效的网络处理机制，它通过异步非阻塞的方式来处理大量并发连接。以下是对<span class="jill"></span>Nginx<span class="jill"></span>事件驱动模型的详细解释：</span></div></div><ol class="wolai-block"><li id="o4JgL5oe97ZjhxpuNXXXZj"><div class="marker"></div><span class="inline-wrap"><b>基本概念</b></span><ul class="wolai-block"><li id="5ox336gHaJypQzWqiyM4Tk"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>事件驱动</b></span><span class="inline-wrap">：事件驱动模型的核心思想是程序在等待事件发生时不会阻塞，而是继续执行其他任务。当某个事件发生时，系统会通知应用程序进行处理。这种机制使得程序能够高效地处理大量并发连接。</span></li><li id="inWs5G2c48yMrYfc7sDevG"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>异步非阻塞</b></span><span class="inline-wrap">：在事件驱动模型中，I/O<span class="jill"></span>操作（如读写数据）通常是异步和非阻塞的。这意味着应用程序可以在等待<span class="jill"></span>I/O<span class="jill"></span>操作完成的同时继续执行其他任务，而不会被阻塞住。</span></li></ul></li><li id="p9NzJwYA9gSUw56cZQrJwy"><div class="marker"></div><span class="inline-wrap"><b>Nginx<span class="jill"></span>的事件驱动架构</b></span><ul class="wolai-block"><li id="jJ9Q9so3gyoWE3Fdiz2pnw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>事件循环</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>使用一个主事件循环来监听和分发事件。事件循环不断地检查各种事件（如连接、读取、写入等），并根据事件的类型调用相应的回调函数进行处理。</span></li><li id="wr49xdxcowWfYiYbTk9iGh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>多路复用</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>采用多路复用技术（如</span><span class="inline-wrap"><code>epoll</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>kqueue</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>select</code></span><span class="inline-wrap">等）来同时监控多个文件描述符。这些技术允许<span class="jill"></span>Nginx<span class="jill"></span>在一个线程内高效地管理大量的并发连接。</span></li><li id="n26dKoFGNKWWFuz1WjNFAa"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>工作进程</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>可以配置多个工作进程，每个工作进程都包含一个独立的事件循环。这种设计使得<span class="jill"></span>Nginx<span class="jill"></span>能够充分利用多核<span class="jill"></span>CPU<span class="jill"></span>的优势，提高并发处理能力。</span></li></ul></li><li id="8CkgefZrNSdwBCdvwxESCZ"><div class="marker"></div><span class="inline-wrap"><b>工作流程</b></span><ul class="wolai-block"><li id="9SXUFLCJuvQ7GkmMKQasqv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>初始化</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>启动时，会初始化事件模块，并创建多个工作进程。每个工作进程都会创建一个事件循环，并开始监听配置文件中定义的端口和地址。</span></li><li id="4tFFdcoSyiZ2iTAdTWK4cK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>事件注册</b></span><span class="inline-wrap">：当有新的连接请求到达时，操作系统会将该事件通知给<span class="jill"></span>Nginx<span class="jill"></span>的事件循环。Nginx<span class="jill"></span>会根据事件类型（如新连接、数据可读、数据可写等）将事件添加到事件队列中。</span></li><li id="w9w4m9NrHUBNhVZwCsY5X6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>事件处理</b></span><span class="inline-wrap">：事件循环不断从事件队列中取出事件，并调用相应的回调函数进行处理。例如，当有新的连接请求时，会调用接受连接的回调函数；当有数据可读时，会调用读取数据的回调函数。</span></li><li id="p37XvJ7MKzdvmrsC5QFdEz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>任务调度</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>的事件驱动模型还支持任务调度功能，可以将一些耗时的任务（如磁盘<span class="jill"></span>I/O<span class="jill"></span>操作）交给专门的线程池处理，以避免阻塞事件循环。</span></li></ul></li><li id="4y85vVcfBL9U7giR4AnitV"><div class="marker"></div><span class="inline-wrap"><b>优势</b></span><ul class="wolai-block"><li id="hT2CtGg2sbj8RDtkWfX7rw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>高并发处理能力</b></span><span class="inline-wrap">：由于采用了异步非阻塞的<span class="jill"></span>I/O<span class="jill"></span>操作和多路复用技术，Nginx<span class="jill"></span>能够高效地处理大量并发连接，适用于高并发场景。</span></li><li id="tcFF8P9QtVoQs49V6FzrtM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>资源利用率高</b></span><span class="inline-wrap">：通过事件驱动模型，Nginx<span class="jill"></span>能够在单线程内处理多个连接，避免了传统多线程模型中的线程切换开销，提高了资源利用率。</span></li><li id="wd5adjgNW42cUQUTAdsLm9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>扩展性好</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>的事件驱动架构使其具有良好的扩展性，可以通过增加工作进程数量来提升并发处理能力。</span></li></ul></li></ol><div id="4cm3S6SXi5UiJF2JSYXsg" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，Nginx<span class="jill"></span>的事件驱动模型通过异步非阻塞的<span class="jill"></span>I/O<span class="jill"></span>操作和多路复用技术，实现了高效的并发处理能力，适用于高并发的网络应用场景。</span></div></div><div id="b1fQ8DLzGuj5WeiG5xxasn" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="xozo9rAkdMJbhSgC1W4ZsW" class="wolai-block"><span class="wolai-serial-number">12</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>Gzip<span class="jill"></span>压缩？</span></h1><div id="iGZEgFTh3rScxJA5efAjin" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>Gzip<span class="jill"></span>压缩，可以通过编辑<span class="jill"></span>Nginx<span class="jill"></span>配置文件来实现。以下是详细的步骤：</span></div></div><ol class="wolai-block"><li id="4rPU4VMxYQHtdRLJDrk4qQ"><div class="marker"></div><span class="inline-wrap"><b>打开<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="k4U8fXoq7C2PCSYYVyCpiU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nginx<span class="jill"></span>的主配置文件通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/usr/local/nginx/conf/nginx.conf</code></span><span class="inline-wrap">。你可以使用文本编辑器（如</span><span class="inline-wrap"><code>vim</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>nano</code></span><span class="inline-wrap">）打开该文件。例如：</span><code-block id="gVprrbqnvCDb5RAF1LZD1A" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">vim</span> /etc/nginx/nginx.conf</pre></div></code-block></li></ul></li><li id="7bfmBk8V3nJQLSMVhwnGFJ"><div class="marker"></div><span class="inline-wrap"><b>启用<span class="jill"></span>gzip<span class="jill"></span>模块</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="8UFfhgpuCDDd3YFBzZyWbn"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在</span><span class="inline-wrap"><code>http</code></span><span class="inline-wrap">块中添加或修改以下指令来启用<span class="jill"></span>gzip<span class="jill"></span>压缩：</span><code-block id="cgCaj1ryBjfoJMLXiJdgiW" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 启用gzip压缩</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 设置要压缩的MIME类型</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/plain application/xml text/css application/javascript</span><span class="token punctuation">;</span>

    <span class="token comment"># 设置触发压缩的最小响应体长度</span>
    <span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">256</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 设置压缩级别，范围是1到9，数字越大压缩率越高，但CPU占用也更高</span>
    <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">5</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 为所有请求启用gzip压缩</span>
    <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>

    <span class="token comment"># 设置用于存储压缩数据的缓冲区数量和大小</span>
    <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li></ul></li><li id="tF1ianyqL9qggGu2PEuCYK"><div class="marker"></div><span class="inline-wrap"><b>配置具体的服务器块</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="88mmyE4e6GCbzBH2p7Pg4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果你只想对特定的服务器或位置启用<span class="jill"></span>gzip<span class="jill"></span>压缩，可以在相应的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块或</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块中进行配置。例如，只对静态资源启用<span class="jill"></span>gzip<span class="jill"></span>压缩：</span><code-block id="rywckvYSwQ68oPt5fkHHw6" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> ~* \.(jpg|jpeg|png|gif|ico|css|js)$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">gzip_types</span> text/plain application/xml text/css application/javascript</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">256</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">5</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li></ul></li><li id="jrnC8sEpYKWxtah3JABvjX"><div class="marker"></div><span class="inline-wrap"><b>测试配置并重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="6jt5nbhGTuTUYffKnCzKJJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在应用更改之前，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置文件的语法是否正确：</span><code-block id="5GAwy8ThS7DmaQNwz1Enuy" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block></li><li id="eC8CE2VZgPwg1tNydPeAqA"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果测试通过，没有错误信息，则可以安全地重启<span class="jill"></span>Nginx<span class="jill"></span>以使更改生效：</span><code-block id="8vbn3g1d8pehBYahfWBCRE" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li></ul></li><li id="jbwxLeWSD3X7jH9ieFicXn"><div class="marker"></div><span class="inline-wrap"><b>验证<span class="jill"></span>gzip<span class="jill"></span>压缩是否生效</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="kyySG7FeXxwF2DmZjfemX3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">你可以使用浏览器的开发者工具或命令行工具（如</span><span class="inline-wrap"><code>curl</code></span><span class="inline-wrap">）来验证<span class="jill"></span>gzip<span class="jill"></span>压缩是否生效。例如，使用</span><span class="inline-wrap"><code>curl</code></span><span class="inline-wrap">命令查看响应头信息：</span><code-block id="beRx45Cyb2Hy8Yv8bpxoBT" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">curl</span> <span class="token parameter variable">-I</span> <span class="token parameter variable">-H</span> <span class="token string">"Accept-Encoding: gzip"</span> http://example.com/path/to/resource</pre></div></code-block></li><li id="kZGrKRUfQbYBYLk3xoSmp2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果<span class="jill"></span>gzip<span class="jill"></span>压缩生效，响应头中应该包含</span><span class="inline-wrap"><code>Content-Encoding: gzip</code></span><span class="inline-wrap">。</span></li></ul></li></ol><div id="7xGkBdyVf853T5Qa23qBw4" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>Gzip<span class="jill"></span>压缩，从而提高网站的性能和用户体验。</span></div></div><div id="7aCvWWxg2MEvY917Fn5ke5" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="nR9ZKifWRUhpd6qo3cLyjv" class="wolai-block"><span class="wolai-serial-number">13</span><span class="inline-wrap">Nginx<span class="jill"></span>如何处理高并发请求？</span></h1><div id="xfNpYgCqiJTGX7w1sykE32" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>处理高并发请求的能力主要得益于其高效的事件驱动架构和多进程/多线程模型。以下是<span class="jill"></span>Nginx<span class="jill"></span>如何处理高并发请求的详细解释：</span></div></div><h3 id="2KFKZEkqCRpQiYzw8rtMM8" class="wolai-block"><span class="wolai-serial-number">13.1</span><span class="inline-wrap">1. </span><span class="inline-wrap"><b>事件驱动架构</b></span><ul class="wolai-block"><li id="i2ngK7gbsTzakLQLTMyRVC"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>异步非阻塞<span class="jill"></span>I/O</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>采用异步非阻塞的<span class="jill"></span>I/O<span class="jill"></span>操作，这意味着它可以在等待<span class="jill"></span>I/O<span class="jill"></span>操作完成的同时继续处理其他任务。这种机制避免了传统同步阻塞<span class="jill"></span>I/O<span class="jill"></span>带来的性能瓶颈。</span></li><li id="eZyKaCmyKD91E9HwbVQ7q9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>事件循环</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>使用一个主事件循环来监听和分发事件。事件循环不断地检查各种事件（如连接、读取、写入等），并根据事件的类型调用相应的回调函数进行处理。</span></li><li id="qKZCW5up5aZbFEvzB4s6x1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>多路复用</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>采用多路复用技术（如</span><span class="inline-wrap"><code>epoll</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>kqueue</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>select</code></span><span class="inline-wrap">等）来同时监控多个文件描述符。这些技术允许<span class="jill"></span>Nginx<span class="jill"></span>在一个线程内高效地管理大量的并发连接。</span></li></ul></h3><h3 id="8Df61JYkt447stuZgbyVz" class="wolai-block"><span class="wolai-serial-number">13.2</span><span class="inline-wrap">2. </span><span class="inline-wrap"><b>多进程/多线程模型</b></span><ul class="wolai-block"><li id="nA2T2QPbNJPK1TqjUHtvdd"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>工作进程</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>可以配置多个工作进程，每个工作进程都包含一个独立的事件循环。这种设计使得<span class="jill"></span>Nginx<span class="jill"></span>能够充分利用多核<span class="jill"></span>CPU<span class="jill"></span>的优势，提高并发处理能力。</span></li><li id="jrELfWUM3GWEJ8i6D39GBo"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>可以将请求分配到不同的工作进程中，从而实现负载均衡。这有助于避免单个进程过载，提高整体系统的吞吐量。</span></li></ul></h3><h3 id="cRAtZZZoEs8aa4kzswt9A" class="wolai-block"><span class="wolai-serial-number">13.3</span><span class="inline-wrap">3. </span><span class="inline-wrap"><b>缓存机制</b></span><ul class="wolai-block"><li id="cewSw1w4F2ktG2hYZWKkRY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>静态资源缓存</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>可以对静态资源进行缓存，减少对后端服务器的请求压力。通过设置适当的缓存头信息，Nginx<span class="jill"></span>可以在客户端缓存静态资源，从而减少重复请求。</span></li><li id="uDA5JjP323RrbYcgzUCs6g"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>反向代理缓存</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>作为反向代理时，可以缓存后端服务器的响应数据，提高响应速度并减轻后端服务器的压力。</span></li></ul></h3><h3 id="wsQpyPbshbuAS553NCCqNH" class="wolai-block"><span class="wolai-serial-number">13.4</span><span class="inline-wrap">4. </span><span class="inline-wrap"><b>连接池</b></span><ul class="wolai-block"><li id="pBNehxV4knFjZZ8mGJLMJa"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>长连接</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>支持<span class="jill"></span>HTTP<span class="jill"></span>长连接（Keep-Alive），可以减少<span class="jill"></span>TCP<span class="jill"></span>连接的建立和关闭开销，提高请求处理效率。</span></li><li id="tzfyhaCiHU26wgUMfg5Kcn"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>连接池</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>可以维护一个连接池，复用已有的连接，减少频繁创建和销毁连接的开销。</span></li></ul></h3><h3 id="qfdFawYTxv67KmjfeGQTRA" class="wolai-block"><span class="wolai-serial-number">13.5</span><span class="inline-wrap">5. </span><span class="inline-wrap"><b>优化配置</b></span><ul class="wolai-block"><li id="aZbMREngfrUHVpcm4Rsj2q"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>worker_processes</b></span><span class="inline-wrap">：配置<span class="jill"></span>Nginx<span class="jill"></span>的工作进程数量，通常设置为与<span class="jill"></span>CPU<span class="jill"></span>核心数相同或略高。例如：</span><code-block id="hgK77aNwBqXxb1yVqSA6rS" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="b7DaeaAuCiZQp9oBoDJ5MY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>worker_connections</b></span><span class="inline-wrap">：配置每个工作进程的最大连接数。例如：</span><code-block id="pk9UJ6qqhnumCeRuTjiTPB" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="pup85QJg76iFKNigsJKHqZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>worker_rlimit_nofile</b></span><span class="inline-wrap">：增加文件描述符的限制，以支持更多的并发连接。例如：</span><code-block id="5qjzkQVWwm4ZGn4Ya477af" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">worker_rlimit_nofile</span> <span class="token number">65536</span></span><span class="token punctuation">;</span></pre></div></code-block></li></ul></h3><h3 id="kx2wQx9zs7VByhRKdcNcCT" class="wolai-block"><span class="wolai-serial-number">13.6</span><span class="inline-wrap">6. </span><span class="inline-wrap"><b>示例配置</b></span><div id="gzXYTBwox5myrkDeaPMSsX" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是一个示例<span class="jill"></span>Nginx<span class="jill"></span>配置文件，展示了如何配置<span class="jill"></span>Nginx<span class="jill"></span>以处理高并发请求：</span></div></div><code-block id="uuNKHC6EV9X3NWNBkFs6sX" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">user</span> www-data</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span> /run/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">include</span> /etc/nginx/modules-enabled/*.conf</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">multi_accept</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">types_hash_max_size</span> <span class="token number">2048</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token comment"># Gzip压缩配置</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">"msie6"</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">location</span> ~* \.(jpg|jpeg|png|gif|ico|css|js)$</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, no-transform"</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></h3><div id="xm6rNbeUYAFjnsD2XBToq6" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，Nginx<span class="jill"></span>通过事件驱动架构、多进程/多线程模型、缓存机制、连接池以及优化配置等多种手段，实现了高效的高并发请求处理能力。</span></div></div><div id="mzngojatvAhTw2bVd22pMY" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="2rEVqyjgZTZi9Wj1iHGruS" class="wolai-block"><span class="wolai-serial-number">14</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>配置文件的结构。</span></h1><div id="7JEqQ9VNtDqnMRdi4bPVsJ" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>配置文件的结构是其强大功能和灵活性的基础。Nginx<span class="jill"></span>的配置文件通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">，但也可以通过命令行参数指定其他位置。配置文件由多个指令组成，这些指令按照一定的层次结构组织。以下是<span class="jill"></span>Nginx<span class="jill"></span>配置文件的主要结构和常见指令的解释：</span></div></div><h3 id="iugrug8uW6vvJDgtjkyP13" class="wolai-block"><span class="wolai-serial-number">14.1</span><span class="inline-wrap"><b>全局块</b></span><ul class="wolai-block"><li id="2Ax2PmfkmdwwqyKmXU1azs"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">全局块包含影响整个<span class="jill"></span>Nginx<span class="jill"></span>服务器的配置指令。这些指令通常在</span><span class="inline-wrap"><code>http</code></span><span class="inline-wrap">块之外。</span></li></ul><code-block id="wgce1gmAhffN9MQJcGoHr1" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">user</span> www-data</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span> /run/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">include</span> /etc/nginx/modules-enabled/*.conf</span><span class="token punctuation">;</span></pre></div></code-block></h3><h3 id="ka47PnVoCKzdK7FBjfueVQ" class="wolai-block"><span class="wolai-serial-number">14.2</span><span class="inline-wrap"><b>events<span class="jill"></span>块</b></span><ul class="wolai-block"><li id="8KxvxY1cexzJA7yr7SWcWx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>events</code></span><span class="inline-wrap">块用于配置与事件处理相关的设置，如工作进程的数量、连接数等。</span></li></ul><code-block id="aGuiUXws7kztcEs2ypAiPi" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">multi_accept</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></h3><h3 id="4zm6QESsHAfwbVqutMSWnx" class="wolai-block"><span class="wolai-serial-number">14.3</span><span class="inline-wrap"><b>http<span class="jill"></span>块</b></span><ul class="wolai-block"><li id="bt9Wofmj6oWXbUDcT85cNP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>http</code></span><span class="inline-wrap">块包含所有与<span class="jill"></span>HTTP<span class="jill"></span>协议相关的配置，包括服务器块（</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">）、位置块（</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">）等。</span></li></ul><code-block id="uJGrJCXY1WsPWY375G9U6j" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">types_hash_max_size</span> <span class="token number">2048</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token comment"># Gzip压缩配置</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">"msie6"</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">location</span> ~* \.(jpg|jpeg|png|gif|ico|css|js)$</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, no-transform"</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></h3><h3 id="jQ7b5wHzoRovcjXG8okPcA" class="wolai-block"><span class="wolai-serial-number">14.4</span><span class="inline-wrap"><b>server<span class="jill"></span>块</b></span><ul class="wolai-block"><li id="gaq2hpHZMbbeB5kkHMF9su"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块定义了一个虚拟主机，可以包含多个</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块和其他相关配置。</span></li></ul><code-block id="6hk3JWcSjg9j1sqvNnBmoJ" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~* \.(jpg|jpeg|png|gif|ico|css|js)$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, no-transform"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></h3><h3 id="tdfoaB3u5DPGSUgmG7djYj" class="wolai-block"><span class="wolai-serial-number">14.5</span><span class="inline-wrap"><b>location<span class="jill"></span>块</b></span><ul class="wolai-block"><li id="e43gFPMGYDhWzVr9Qjobui"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块用于匹配特定的<span class="jill"></span>URL<span class="jill"></span>路径，并定义该路径下的处理方式。常见的匹配方式有前缀匹配、正则表达式匹配和精确匹配。</span></li></ul><code-block id="tasVj47X6xjKyTmFd3KRz3" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> ~* \.(jpg|jpeg|png|gif|ico|css|js)$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, no-transform"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></h3><h3 id="v4u9RnPNPMKKr9aqjPUoJk" class="wolai-block"><span class="wolai-serial-number">14.6</span><span class="inline-wrap"><b>常用指令</b></span><ul class="wolai-block"><li id="dCtCysoNF89SPkorTGwsmQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>user</b></span><span class="inline-wrap">：指定<span class="jill"></span>Nginx<span class="jill"></span>运行的用户和组。</span><code-block id="tqkBwjddvenNYprAa3fXmf" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">user</span> www-data</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="6LPQ7BRrJURfFsbqdLrMmG"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>worker_processes</b></span><span class="inline-wrap">：指定工作进程的数量。通常设置为<span class="jill"></span>CPU<span class="jill"></span>核心数或</span><span class="inline-wrap"><code>auto</code></span><span class="inline-wrap">。</span><code-block id="vkocbJMvkNQq4rjfyztTN" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="vxau2P9jVj2FZEv7JoGvbT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>pid</b></span><span class="inline-wrap">：指定存储<span class="jill"></span>Nginx<span class="jill"></span>主进程<span class="jill"></span>PID<span class="jill"></span>的文件路径。</span><code-block id="8Gko8UmjAdoECYx6L7F6oZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">pid</span> /run/nginx.pid</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="nbNs5YX39ih8tNgaXC6T5g"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>include</b></span><span class="inline-wrap">：包含其他配置文件。常用于模块化配置。</span><code-block id="ji5Js5wiAj8ZgiRHZE6eDj" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">include</span> /etc/nginx/modules-enabled/*.conf</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="h68yR5pvFEC3oFbTTXJ2DZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>sendfile</b></span><span class="inline-wrap">：启用高效的文件传输模式。</span><code-block id="eEjkvATgP9gkoXLvZs6riy" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="gxNGayDUbrLrbSwxsjMCyj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>tcp_nopush</b></span><span class="inline-wrap">和</span><span class="inline-wrap"><b>tcp_nodelay</b></span><span class="inline-wrap">：优化<span class="jill"></span>TCP<span class="jill"></span>连接性能。</span><code-block id="mFiDuUTw2navHSzHHo4kFw" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="eHovN9WQ65ThdHmC6iGsnR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>keepalive_timeout</b></span><span class="inline-wrap">：设置长连接超时时间。</span><code-block id="jN2BAWyJsKFVxBfNBwvyqg" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="iqRqnYhTeEUzN6kE6wMJSz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>types_hash_max_size</b></span><span class="inline-wrap">：设置<span class="jill"></span>MIME<span class="jill"></span>类型哈希表的最大大小。</span><code-block id="rrSs5Nmw6Nd6ZQWUv5Kt9T" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">types_hash_max_size</span> <span class="token number">2048</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="7jczyRrMycLGm1xLc8rD4q"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>include</b></span><span class="inline-wrap">：包含其他配置文件，如<span class="jill"></span>MIME<span class="jill"></span>类型文件。</span><code-block id="pCwpvmNhW4TQXgEUfz41z" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">include</span> /etc/nginx/mime.types</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="rdNhJLnPvKuXdfAwPF57Mi"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>default_type</b></span><span class="inline-wrap">：设置默认的<span class="jill"></span>MIME<span class="jill"></span>类型。</span><code-block id="mbaFaVeTwXmYbmfeDfBifx" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="a24N2281mHsdTBwfverWug"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>gzip</b></span><span class="inline-wrap">：启用<span class="jill"></span>Gzip<span class="jill"></span>压缩。</span><code-block id="7ZfVmvUP1TK5HdHq6k8Py" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="moonJGfeN3cXXwiJRaTEpV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>gzip_disable</b></span><span class="inline-wrap">：禁用对特定浏览器的<span class="jill"></span>Gzip<span class="jill"></span>压缩。</span><code-block id="wLWaLqAnXLeKxp3FFkJB1L" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">"msie6"</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="e7j6s8ygJSN3FwD7vSisMU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>gzip_vary</b></span><span class="inline-wrap">：添加</span><span class="inline-wrap"><code>Vary: Accept-Encoding</code></span><span class="inline-wrap">头。</span><code-block id="dhAkoM3gYWwYRjdnipKLvf" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="s9idEJFRvg9ye17GKxBZSZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>gzip_proxied</b></span><span class="inline-wrap">：设置哪些请求会被代理并压缩。</span><code-block id="tyVXhr91e8xLbedDbmZvXB" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="3ypNSZ4e8CThdt9mqTo7Xh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>gzip_comp_level</b></span><span class="inline-wrap">：设置<span class="jill"></span>Gzip<span class="jill"></span>压缩级别。</span><code-block id="px8aRcRbjzGJ6sdGp76g1P" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="oPcZXpgv4eKjeHePDr7ypK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>gzip_buffers</b></span><span class="inline-wrap">：设置<span class="jill"></span>Gzip<span class="jill"></span>压缩使用的缓冲区数量和大小。</span><code-block id="fuUdd5WHrWNV3ZVuux8PJd" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="hVRPZK8P4VoniWiZjivxrx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>gzip_http_version</b></span><span class="inline-wrap">：设置支持<span class="jill"></span>Gzip<span class="jill"></span>压缩的<span class="jill"></span>HTTP<span class="jill"></span>版本。</span><code-block id="5noPxb7UMynEVA8sTb6UNy" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="ezSc5f5XejLVR7wVJjxix2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>gzip_types</b></span><span class="inline-wrap">：设置需要压缩的<span class="jill"></span>MIME<span class="jill"></span>类型。</span><code-block id="fW1qE7mXsXMJs56y5gEbpA" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="oY8c7CS88bkZwgLNeUcgfT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>listen</b></span><span class="inline-wrap">：指定监听的端口和地址。</span><code-block id="riW6sxVhEC1oFJpbgrhS96" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="3QStvo7fBuJirhD99k6GJC"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>server_name</b></span><span class="inline-wrap">：指定虚拟主机的域名。</span><code-block id="rKcwzkMko5jYE3ZuJiekGi" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="dkkXycG7DwbhzkuPPSd7es"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>root</b></span><span class="inline-wrap">：指定根目录。</span><code-block id="67seFiwCePgQCcQuTzQeq8" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="6dCtrmUmJSaoDyhZtpYcMz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>index</b></span><span class="inline-wrap">：指定默认的索引文件。</span><code-block id="7sCX2pD3kh5zJr8wFSzt2v" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="o7E3AwNoSHG9LkJ5nMfSrV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>expires</b></span><span class="inline-wrap">：设置静态资源的过期时间。</span><code-block id="83KZbgZP4UB8vJf11mPwMp" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="nFJ6o7zK6W9qfWhtPpqCRs"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>add_header</b></span><span class="inline-wrap">：添加<span class="jill"></span>HTTP<span class="jill"></span>响应头。</span><code-block id="oCZ7MDbkguFquzZy4yPzNm" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, no-transform"</span></span><span class="token punctuation">;</span></pre></div></code-block></li></ul></h3><h3 id="77B8pwpCwXc6sJsXgYP7im" class="wolai-block"><span class="wolai-serial-number">14.7</span><span class="inline-wrap"><b>示例配置文件</b></span></h3><div id="dRaUjKTVZni18x34Bf69wQ" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是一个简化的<span class="jill"></span>Nginx<span class="jill"></span>配置文件示例，展示了上述各个部分的基本用法：</span></div></div><code-block id="5nvq4udEKNjz9z8SETUDjt" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">user</span> www-data</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span> /run/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">include</span> /etc/nginx/modules-enabled/*.conf</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">types_hash_max_size</span> <span class="token number">2048</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">"msie6"</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ =404</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token directive"><span class="token keyword">location</span> ~* \.(jpg|jpeg|png|gif|ico|css|js)$</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, no-transform"</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="d57bW388RmyBuSorCXQ6RZ" class="wolai-block wolai-text"><div><span class="inline-wrap">这个配置文件定义了一个基本的<span class="jill"></span>Nginx<span class="jill"></span>服务器，能够处理静态资源请求并进行<span class="jill"></span>Gzip<span class="jill"></span>压缩。通过理解和应用这些配置指令，你可以根据实际需求灵活调整<span class="jill"></span>Nginx<span class="jill"></span>的行为。</span></div></div><div id="wHEJt9Y5PGWE7nM59w5uN4" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="ugJpqzgMceyQaN7vta9sdY" class="wolai-block"><span class="wolai-serial-number">15</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中重写<span class="jill"></span>URL？</span></h1><div id="c6S8qw1JQ7XvzK1sAuEYGe" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中重写<span class="jill"></span>URL<span class="jill"></span>通常使用</span><span class="inline-wrap"><code>rewrite</code></span><span class="inline-wrap">指令。这个指令允许你根据正则表达式匹配<span class="jill"></span>URL，并对其进行重写或重定向。以下是一些常见的用法和示例：</span></div></div><h3 id="9XVUKkZVBiTVY9VLS1tqNX" class="wolai-block"><span class="wolai-serial-number">15.1</span><span class="inline-wrap">基本语法</span></h3><code-block id="ihH896tMXoK4SsKyWTQgF5" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">rewrite</span> regex replacement [flag]</span><span class="token punctuation">;</span></pre></div></code-block><ul class="wolai-block"><li id="tjaazqMx75peZHcp3yhwLH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>regex</code></span><span class="inline-wrap">: 用于匹配的正则表达式。</span></li><li id="w2tCsae3TYkFU3kY62rFXv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>replacement</code></span><span class="inline-wrap">: 替换的内容。</span></li><li id="jQjmuPZHGguWBPfQ7z35GH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>flag</code></span><span class="inline-wrap">: 可选标志，如</span><span class="inline-wrap"><code>last</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>break</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>redirect</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>permanent</code></span><span class="inline-wrap">等。</span></li></ul><h3 id="jeDuFQKsgdhzWXuGo9Xm2K" class="wolai-block"><span class="wolai-serial-number">15.2</span><span class="inline-wrap">常见标志</span></h3><ul class="wolai-block"><li id="uvocFqWMWEkUhcYUWwoCxi"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>last</code></span><span class="inline-wrap">: 停止重写，继续处理请求（常用于重定向）。</span></li><li id="pJ41udTxvsfyeuN3GPT54x"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>break</code></span><span class="inline-wrap">: 停止重写，不再处理后续的重写规则。</span></li><li id="aSvYPDNWGDG7Tj57xK5gpZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>redirect</code></span><span class="inline-wrap">: 返回<span class="jill"></span>302<span class="jill"></span>临时重定向。</span></li><li id="37rAsfvT5mtf8vciDDY8fZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>permanent</code></span><span class="inline-wrap">: 返回<span class="jill"></span>301<span class="jill"></span>永久重定向。</span></li></ul><h3 id="dXRHQzrBgHcJBqgYPQ4QzU" class="wolai-block"><span class="wolai-serial-number">15.3</span><span class="inline-wrap">示例</span></h3><h4 id="kqA7hptGLDzimQXhJ3DB3X" class="wolai-block"><span class="wolai-serial-number">15.3.1</span><span class="inline-wrap">1. 简单的<span class="jill"></span>URL<span class="jill"></span>重写</span></h4><div id="ku74ZN4U5UYoGHicsFamTZ" class="wolai-block wolai-text"><div><span class="inline-wrap">假设你想将所有以</span><span class="inline-wrap"><code>/old-path</code></span><span class="inline-wrap">开头的<span class="jill"></span>URL<span class="jill"></span>重写到</span><span class="inline-wrap"><code>/new-path</code></span><span class="inline-wrap">：</span></div></div><code-block id="cabpcfW6EVuuESYPY3RLf4" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/old-path(/.*)$ /new-path<span class="token variable">$1</span> last</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="gM4efgBui5i2FwXMC23z7m" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个例子中，所有匹配</span><span class="inline-wrap"><code>/old-path</code></span><span class="inline-wrap">的请求都会被重定向到</span><span class="inline-wrap"><code>/new-path</code></span><span class="inline-wrap">，并且保留原始路径中的其余部分。</span></div></div><h4 id="jf5An5aXkdbLPEBMCc8ND7" class="wolai-block"><span class="wolai-serial-number">15.3.2</span><span class="inline-wrap">2. 重定向到另一个域名</span></h4><div id="uuf3m5FxmbkV71BnnFxTm2" class="wolai-block wolai-text"><div><span class="inline-wrap">如果你想将请求重定向到另一个域名，例如将</span><span class="inline-wrap"><code>example.com</code></span><span class="inline-wrap">重定向到</span><span class="inline-wrap"><code>www.example.com</code></span><span class="inline-wrap">：</span></div></div><code-block id="gAy4FTVbwKTsYoErvGY4cA" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^(.*)$ http://www.example.com<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="dZea69JPTuS587yPKwgfKz" class="wolai-block wolai-text"><div><span class="inline-wrap">这个配置会将所有对</span><span class="inline-wrap"><code>example.com</code></span><span class="inline-wrap">的请求永久重定向到</span><span class="inline-wrap"><code>www.example.com</code></span><span class="inline-wrap">。</span></div></div><h4 id="d7RMDy72R9GiJL4rfBycrk" class="wolai-block"><span class="wolai-serial-number">15.3.3</span><span class="inline-wrap">3. 内部重写（不改变<span class="jill"></span>URL）</span></h4><div id="xmuwLyY4tmYZLnYC5siiHY" class="wolai-block wolai-text"><div><span class="inline-wrap">如果你希望内部重写<span class="jill"></span>URL<span class="jill"></span>而不改变客户端看到的<span class="jill"></span>URL，可以使用</span><span class="inline-wrap"><code>break</code></span><span class="inline-wrap">标志：</span></div></div><code-block id="6RzebBjE9G4X8jWdopCtzp" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/old-path(/.*)$ /new-path<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="sRnuXKHwXme1GAgyi84Ntg" class="wolai-block wolai-text"><div><span class="inline-wrap">这个配置会将匹配的请求内部重写到</span><span class="inline-wrap"><code>/new-path</code></span><span class="inline-wrap">，但客户端浏览器仍然显示原来的<span class="jill"></span>URL。</span></div></div><h4 id="d2u3JHrmbvh5QdorCYf5Gw" class="wolai-block"><span class="wolai-serial-number">15.3.4</span><span class="inline-wrap">4. 条件重写</span></h4><div id="bRJmJpQo28YnfXYDaBKgAs" class="wolai-block wolai-text"><div><span class="inline-wrap">你可以结合</span><span class="inline-wrap"><code>if</code></span><span class="inline-wrap">语句进行更复杂的条件重写：</span></div></div><code-block id="oLsD4h7FqKMVTmGhx9SP3h" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~* <span class="token string">"^/old-path"</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">rewrite</span> ^/old-path(/.*)$ /new-path<span class="token variable">$1</span> last</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="cXdybHVBRUiiEQWNkKoTzt" class="wolai-block wolai-text"><div><span class="inline-wrap">这个例子中，只有当请求<span class="jill"></span>URI<span class="jill"></span>匹配</span><span class="inline-wrap"><code>/old-path</code></span><span class="inline-wrap">时，才会进行重写。</span></div></div><h4 id="6BNxqj3yVk84fnqbfpQh7K" class="wolai-block"><span class="wolai-serial-number">15.3.5</span><span class="inline-wrap">5. 捕获查询参数</span></h4><div id="6JFALq3m5w1fDrdZd3Qs85" class="wolai-block wolai-text"><div><span class="inline-wrap">如果你需要捕获查询参数并将其包含在重写后的<span class="jill"></span>URL<span class="jill"></span>中，可以使用如下配置：</span></div></div><code-block id="hnaJzYqSiPQAoAQ4pCHb1v" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/item/([0-9]+) /product?id=<span class="token variable">$1</span> last</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="b3HsDWMy63SUaGn1S7wdC4" class="wolai-block wolai-text"><div><span class="inline-wrap">这个配置会将类似</span><span class="inline-wrap"><code>/item/123</code></span><span class="inline-wrap">的<span class="jill"></span>URL<span class="jill"></span>重写成</span><span class="inline-wrap"><code>/product?id=123</code></span><span class="inline-wrap">。</span></div></div><h3 id="4um7Yg53EUBqpow6rSoGLX" class="wolai-block"><span class="wolai-serial-number">15.4</span><span class="inline-wrap">完整示例配置文件</span></h3><div id="mtAxDEGxWsxd1UoxCz4Wma" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是一个包含多个重写规则的完整<span class="jill"></span>Nginx<span class="jill"></span>配置文件示例：</span></div></div><code-block id="u5DMxAbkd1PWYRA1P46Cfy" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">user</span> www-data</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span> /run/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">include</span> /etc/nginx/modules-enabled/*.conf</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">types_hash_max_size</span> <span class="token number">2048</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">"msie6"</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token comment"># 重定向不带www的请求到带www的域名</span>
            <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$host</span> ~* ^example\.com$)</span> <span class="token punctuation">{</span>
                <span class="token directive"><span class="token keyword">rewrite</span> ^(.*)$ http://www.<span class="token variable">$host</span><span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment"># 重写旧路径到新路径</span>
            <span class="token directive"><span class="token keyword">rewrite</span> ^/old-path(/.*)$ /new-path<span class="token variable">$1</span> last</span><span class="token punctuation">;</span>
            <span class="token comment"># 内部重写，不改变URL</span>
            <span class="token directive"><span class="token keyword">rewrite</span> ^/internal-path(/.*)$ /internal-rewrite<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="fU7y7sz4SWaFUqHnNzfiP8" class="wolai-block wolai-text"><div><span class="inline-wrap">这个配置文件展示了如何结合多种重写规则来实现不同的<span class="jill"></span>URL<span class="jill"></span>处理需求。通过合理使用这些指令，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中实现灵活的<span class="jill"></span>URL<span class="jill"></span>重写和重定向。</span></div></div><div id="tC19uFMreYDwZRNFDkqJsL" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="2FaigK6b8tAnSTttnk4HsU" class="wolai-block"><span class="wolai-serial-number">16</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置错误页面？</span></h1><div id="wsnay8q1ZyvWuZxpP7cX4H" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置错误页面（如<span class="jill"></span>404、500<span class="jill"></span>等）是一个常见的需求，可以通过</span><span class="inline-wrap"><code>error_page</code></span><span class="inline-wrap">指令来实现。这个指令允许你指定特定状态码对应的自定义错误页面。以下是详细的步骤和示例：</span></div></div><h3 id="eiNmFtvkyDPCfAE88KNLkS" class="wolai-block"><span class="wolai-serial-number">16.1</span><span class="inline-wrap">基本语法</span></h3><code-block id="h2nfeSy4qL5pC1bRzStrdz" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">error_page</span> code [code ...] =uri | @named_location</span><span class="token punctuation">;</span></pre></div></code-block><ul class="wolai-block"><li id="8ebyQpPnrYVgXcrTM2nXBH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>code</code></span><span class="inline-wrap">: HTTP<span class="jill"></span>状态码，例如<span class="jill"></span>404、500<span class="jill"></span>等。</span></li><li id="5LSfZ7buQSCkv6NEuxDts7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>uri</code></span><span class="inline-wrap">: 错误页面的路径，可以是相对路径或绝对路径。</span></li><li id="2gsPZQkf3JnupxqdDbAhFo"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>@named_location</code></span><span class="inline-wrap">: 命名位置块，用于更复杂的错误处理逻辑。</span></li></ul><h3 id="6P9q8FZEWhPCxuJVDSdQc8" class="wolai-block"><span class="wolai-serial-number">16.2</span><span class="inline-wrap">示例配置</span></h3><h4 id="dAv2CMpvSde5T1CPwgEiBZ" class="wolai-block"><span class="wolai-serial-number">16.2.1</span><span class="inline-wrap">简单的错误页面</span></h4><div id="efYPehGVuwTbPp67ndM51k" class="wolai-block wolai-text"><div><span class="inline-wrap">假设你想为<span class="jill"></span>404<span class="jill"></span>错误配置一个自定义页面，可以这样设置：</span></div></div><code-block id="bY9x1m7nmwAVx5Q7pbxWpH" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /custom_404.html</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> = /custom_404.html</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="67QuHJiqPE8s2VJ7Kr4FQ2" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个例子中，当发生<span class="jill"></span>404<span class="jill"></span>错误时，Nginx<span class="jill"></span>会返回</span><span class="inline-wrap"><code>/custom_404.html</code></span><span class="inline-wrap">页面。注意，我们使用</span><span class="inline-wrap"><code>internal</code></span><span class="inline-wrap">指令来防止直接访问这个错误页面。</span></div></div><h4 id="sCxsqCjvzjpv2E4PG11TbA" class="wolai-block"><span class="wolai-serial-number">16.2.2</span><span class="inline-wrap">多个错误页面</span></h4><div id="bD28XyzUUSbrnBoAVFs8aK" class="wolai-block wolai-text"><div><span class="inline-wrap">你可以为不同的错误代码指定不同的错误页面：</span></div></div><code-block id="o8ztnrycXcTWg8FG5tSggL" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /custom_404.html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /custom_50x.html</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> = /custom_404.html</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> = /custom_50x.html</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="nZNSz8mJRWXDUuxcZrutJB" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，404<span class="jill"></span>错误会显示</span><span class="inline-wrap"><code>/custom_404.html</code></span><span class="inline-wrap">页面，而<span class="jill"></span>500、502、503<span class="jill"></span>和<span class="jill"></span>504<span class="jill"></span>错误会显示</span><span class="inline-wrap"><code>/custom_50x.html</code></span><span class="inline-wrap">页面。</span></div></div><h4 id="9Mcejw7mpTJvqjMgjv42Wp" class="wolai-block"><span class="wolai-serial-number">16.2.3</span><span class="inline-wrap">使用命名位置块处理复杂逻辑</span></h4><div id="mJVWNStBb1dU6SvwdpJHoJ" class="wolai-block wolai-text"><div><span class="inline-wrap">如果你需要更复杂的错误处理逻辑，可以使用命名位置块：</span></div></div><code-block id="9RyQWUgVJTY73JfTV7N3dE" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> = @custom_404</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> = @custom_50x</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> @custom_404</span> <span class="token punctuation">{</span>
        <span class="token comment"># 这里可以添加更多复杂的逻辑，比如日志记录、重定向等</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span> <span class="token string">"Custom 404 Page"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> @custom_50x</span> <span class="token punctuation">{</span>
        <span class="token comment"># 这里可以添加更多复杂的逻辑，比如日志记录、重定向等</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">500</span> <span class="token string">"Custom 50x Page"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="8zdqrrqVo7pC2x6Xp3E2Tb" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，404<span class="jill"></span>错误会跳转到</span><span class="inline-wrap"><code>@custom_404</code></span><span class="inline-wrap">位置块，而<span class="jill"></span>500、502、503<span class="jill"></span>和<span class="jill"></span>504<span class="jill"></span>错误会跳转到</span><span class="inline-wrap"><code>@custom_50x</code></span><span class="inline-wrap">位置块。你可以在这些位置块中实现更复杂的逻辑。</span></div></div><h4 id="vzMhNVcg5LsqHaJPQLykpG" class="wolai-block"><span class="wolai-serial-number">16.2.4</span><span class="inline-wrap">全局错误页面配置</span></h4><div id="JNQ5kN2nqCqmrbqPoQL4q" class="wolai-block wolai-text"><div><span class="inline-wrap">你也可以在<span class="jill"></span>http<span class="jill"></span>块中定义全局的错误页面，这样所有服务器块都会继承这些配置：</span></div></div><code-block id="9GEryWSoLmLzvneGre6nRy" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /global_404.html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /global_50x.html</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> another-example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/another_html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="wQzBVsJjjSMoEJkPnaDkJB" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，所有服务器块都会使用相同的错误页面配置。</span></div></div><h3 id="oEZi6VnvzxkpiAq2BxcZXs" class="wolai-block"><span class="wolai-serial-number">16.3</span><span class="inline-wrap">完整示例配置文件</span></h3><div id="3MRZKLrkVtuw1PvoxSSzfr" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是一个包含多种错误页面配置的完整<span class="jill"></span>Nginx<span class="jill"></span>配置文件示例：</span></div></div><code-block id="gwghCTwoK4bvxQF1xC3PmY" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">user</span> www-data</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span> /run/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">include</span> /etc/nginx/modules-enabled/*.conf</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">65</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">types_hash_max_size</span> <span class="token number">2048</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">"msie6"</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /global_404.html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /global_50x.html</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        
        <span class="token directive"><span class="token keyword">location</span> = /global_404.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token directive"><span class="token keyword">location</span> = /global_50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> another-example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/another_html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        
        <span class="token directive"><span class="token keyword">location</span> = /global_404.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token directive"><span class="token keyword">location</span> = /global_50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="jm5xxpMPmQXqN1GksnYXMv" class="wolai-block wolai-text"><div><span class="inline-wrap">通过合理使用</span><span class="inline-wrap"><code>error_page</code></span><span class="inline-wrap">指令，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中灵活地配置和管理各种错误页面，从而提升用户体验和系统的稳定性。</span></div></div><div id="siBqiPf4iHaJgqC4BGd5qu" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="8npvb98sdK5koM5fg2YBqx" class="wolai-block"><span class="wolai-serial-number">17</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>worker<span class="jill"></span>进程和<span class="jill"></span>master<span class="jill"></span>进程。</span></h1><div id="2LazDD3Mhs5uDQdiwX1hU8" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>的架构中，有两个核心进程：</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程和</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程。这两个进程共同协作，以高效地处理客户端请求。以下是对这两个进程的详细解释：</span></div></div><h3 id="tGKumTRHsDV4AbFou48La6" class="wolai-block"><span class="wolai-serial-number">17.1</span><span class="inline-wrap">Master 进程</span></h3><h4 id="jwoNJm5VkcvwFtySQKb9K3" class="wolai-block"><span class="wolai-serial-number">17.1.1</span><span class="inline-wrap">功能</span></h4><ul class="wolai-block"><li id="fz8hTKo4t3YKocTXTMKart"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>管理</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程负责启动和管理</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程。它负责读取配置文件、初始化日志文件、创建</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程等。</span></li><li id="iip2uvDBzFE2cP12U5fk45"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>信号处理</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程会监听操作系统的信号（如</span><span class="inline-wrap"><code>HUP</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>TERM</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>USR2</code></span><span class="inline-wrap">等），并根据这些信号执行相应的操作，例如重新加载配置、优雅关闭等。</span></li><li id="n7FgvsB7wxTBtjwBzycYzr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>健康检查</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程会定期检查</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程的健康状态，如果发现某个</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程异常退出，它会重新启动一个新的</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程来替代它。</span></li></ul><h4 id="eLYagxawLeZfARPX3VQVg8" class="wolai-block"><span class="wolai-serial-number">17.1.2</span><span class="inline-wrap">特点</span></h4><ul class="wolai-block"><li id="h4UmYotNiEQBM8zhryszYH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>单实例</b></span><span class="inline-wrap">：在一个<span class="jill"></span>Nginx<span class="jill"></span>实例中，只有一个</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程。</span></li><li id="9dy9XyXh1XjVjCXHDeydto"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>轻量级</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程本身不直接处理客户端请求，因此它的资源消耗非常小。</span></li></ul><h3 id="hyX6UBu3j3DSnL3Chidq2g" class="wolai-block"><span class="wolai-serial-number">17.2</span><span class="inline-wrap">Worker 进程</span></h3><h4 id="hNjTzXzHrgPDc2PHkZuW2L" class="wolai-block"><span class="wolai-serial-number">17.2.1</span><span class="inline-wrap">功能</span></h4><ul class="wolai-block"><li id="btX6ci5dWj6GZkmDkWckN7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>处理请求</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程是实际处理客户端请求的进程。每个</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程都是独立的，可以并行处理多个连接和请求。</span></li><li id="smvUt58Tw7xhAvedW9Xv7o"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>事件驱动</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程使用事件驱动模型（如<span class="jill"></span>epoll<span class="jill"></span>或<span class="jill"></span>kqueue）来高效地处理大量并发连接。</span></li><li id="cTGMyeiPKgcQQNmFRtf8rj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡</b></span><span class="inline-wrap">：在多核<span class="jill"></span>CPU<span class="jill"></span>环境下，Nginx<span class="jill"></span>可以通过启动多个</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程来实现负载均衡，充分利用多核<span class="jill"></span>CPU<span class="jill"></span>的性能。</span></li></ul><h4 id="dpmzN2SsMuEF6FReSDwUvW" class="wolai-block"><span class="wolai-serial-number">17.2.2</span><span class="inline-wrap">特点</span></h4><ul class="wolai-block"><li id="CZqjwMtyGgMbGv5PRPzGw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>多实例</b></span><span class="inline-wrap">：可以根据配置文件中的设置启动多个</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程。</span></li><li id="pjNiWjxgw5ce2Gx3xMJ84p"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>高并发</b></span><span class="inline-wrap">：由于每个</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程都可以独立处理请求，因此<span class="jill"></span>Nginx<span class="jill"></span>能够高效地处理大量并发连接。</span></li></ul><h3 id="dK3ud3EcGBij6hbEUTe2v5" class="wolai-block"><span class="wolai-serial-number">17.3</span><span class="inline-wrap">配置文件示例</span></h3><div id="e2HbFvjA7tvbqSNbMETnV1" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是一个典型的<span class="jill"></span>Nginx<span class="jill"></span>配置文件示例，展示了如何配置</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程的数量：</span></div></div><code-block id="mu9Qmy18Nq7EMhP5D1DdN2" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>  <span class="token comment"># 自动检测并设置为与CPU核心数相同的数量</span>
<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>  <span class="token comment"># 每个worker进程的最大连接数</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="gsoT1BPgYGbkRRQ3idPCt4" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中：</span></div></div><ul class="wolai-block"><li id="i8W92VYunWbanXrr37y1ND"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>worker_processes auto;</code></span><span class="inline-wrap">：Nginx<span class="jill"></span>会自动检测系统的<span class="jill"></span>CPU<span class="jill"></span>核心数，并启动相应数量的</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程。你也可以手动指定一个具体的数字，例如</span><span class="inline-wrap"><code>worker_processes 4;</code></span><span class="inline-wrap">。</span></li><li id="3ZBJABqFGpQPfm7z2h8Knh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>worker_connections 1024;</code></span><span class="inline-wrap">：每个</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程可以同时处理的最大连接数。</span></li></ul><h3 id="4HRSNwYeqZix8brpdDpYuu" class="wolai-block"><span class="wolai-serial-number">17.4</span><span class="inline-wrap">工作流程</span></h3><ol class="wolai-block"><li id="oPrTyY8SYgczq1LuVYNC4G"><div class="marker"></div><span class="inline-wrap"><b>启动</b></span><span class="inline-wrap">：当<span class="jill"></span>Nginx<span class="jill"></span>启动时，首先由</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程读取配置文件并初始化环境。</span></li><li id="kv63hSqxbqrmDcaAPKMyrP"><div class="marker"></div><span class="inline-wrap"><b>创建<span class="jill"></span>worker<span class="jill"></span>进程</b></span><span class="inline-wrap">：根据配置文件中的设置，</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程会创建指定数量的</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程。</span></li><li id="qN5nhUuUPmiHVYGpqG8Q6d"><div class="marker"></div><span class="inline-wrap"><b>监听端口</b></span><span class="inline-wrap">：所有</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程都会监听指定的端口，等待客户端请求的到来。</span></li><li id="xsrAQgM664Fgk5NzPRfLQn"><div class="marker"></div><span class="inline-wrap"><b>处理请求</b></span><span class="inline-wrap">：当有客户端请求到达时，</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程会接收请求并进行处理，包括解析请求、访问后端服务器、返回响应等。</span></li><li id="ra43LXhJptNdCecDKFYmmS"><div class="marker"></div><span class="inline-wrap"><b>信号处理</b></span><span class="inline-wrap">：如果需要重新加载配置或优雅关闭<span class="jill"></span>Nginx，</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程会发送相应的信号给</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程，让它们执行相应的操作。</span></li><li id="2bVN2CTUQ9YLQviDrn45LK"><div class="marker"></div><span class="inline-wrap"><b>健康检查</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程会定期检查</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程的状态，确保它们正常运行。如果某个</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程异常退出，</span><span class="inline-wrap"><code>master</code></span><span class="inline-wrap">进程会立即启动一个新的</span><span class="inline-wrap"><code>worker</code></span><span class="inline-wrap">进程来替代它。</span></li></ol><div id="orY5fqQcK1iFhNBVCRfLmn" class="wolai-block wolai-text"><div><span class="inline-wrap">通过这种设计，Nginx<span class="jill"></span>能够在高并发环境下高效地处理大量请求，同时保持较高的稳定性和可靠性。</span></div></div><div id="jRBExsTpLUpuUXTWp2aT6q" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="u16GajkSj6CR2AgxZSY9ce" class="wolai-block"><span class="wolai-serial-number">18</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置健康检查？</span></h1><div id="bW4aNaH51yhiLPfHtFjdWo" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中，健康检查通常是指对后端服务器（如应用服务器、数据库服务器等）进行定期的健康状态检查，以确保它们正常运行。如果某个后端服务器出现故障，Nginx<span class="jill"></span>可以自动将请求转发到其他健康的服务器上。这种机制可以通过</span><span class="inline-wrap"><code>upstream</code></span><span class="inline-wrap">模块和相关指令来实现。</span></div></div><div id="cw5KT5GK9KEwn7SMw84UPm" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置健康检查的详细步骤：</span></div></div><h3 id="j3CMPcYeP8dvKi53sMN2YQ" class="wolai-block"><span class="wolai-serial-number">18.1</span><span class="inline-wrap">定义上游服务器组</span></h3><div id="mLFcxM6kBjsSvcUWpqoAqe" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，你需要定义一个上游服务器组，并在其中列出所有后端服务器。你可以使用</span><span class="inline-wrap"><code>upstream</code></span><span class="inline-wrap">块来定义这个组。</span></div></div><code-block id="hYZic4JyyX4kPTM3QUVsei" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">server</span> backend1.example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> backend2.example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> backend3.example.com</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="r2gg4j39R41ccuJTb7inpP" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个示例中，我们定义了一个名为</span><span class="inline-wrap"><code>backend</code></span><span class="inline-wrap">的上游服务器组，其中包含三个后端服务器。</span></div></div><h3 id="pG2vgtUNdFjVVcqfEpTCSn" class="wolai-block"><span class="wolai-serial-number">18.2</span><span class="inline-wrap">配置健康检查参数</span></h3><div id="62aKMJg92LjTpFe9R3BZZU" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>提供了一些参数来配置健康检查的行为，包括：</span></div></div><ul class="wolai-block"><li id="9A6Hw6VkeX9Xq4cPuz1LYd"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>max_fails</code></span><span class="inline-wrap">：在认为服务器不可用之前允许失败的最大次数。</span></li><li id="mHPTb1UfyLZ15peSVUgQuD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>fail_timeout</code></span><span class="inline-wrap">：在多长时间内认为服务器是不可用的。</span></li><li id="pgEVWdkFqhaebXq5JuHAjY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>interval</code></span><span class="inline-wrap">：健康检查的时间间隔。</span></li></ul><div id="i8SC7h6uiWisb5rUUSnFek" class="wolai-block wolai-text"><div><span class="inline-wrap">你可以在</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">指令中添加这些参数。例如：</span></div></div><code-block id="96mZocp8Lze34sbi7FeGap" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">server</span> backend1.example.com max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> backend2.example.com max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> backend3.example.com max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="v8E6Q8rMuqB1SGZt7jUkZ7" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中：</span></div></div><ul class="wolai-block"><li id="gz5DBBAtrjDc7uq6dCv2r1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>max_fails=3</code></span><span class="inline-wrap">：如果某个后端服务器连续三次健康检查失败，则认为该服务器不可用。</span></li><li id="kKykT9yeT4jB5iokU2iKnT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>fail_timeout=30s</code></span><span class="inline-wrap">：如果某个后端服务器被标记为不可用，它将在<span class="jill"></span>30<span class="jill"></span>秒内不再接收新的请求。</span></li></ul><h3 id="qiQjREMBos8TQeT2J3rrBy" class="wolai-block"><span class="wolai-serial-number">18.3</span><span class="inline-wrap">使用第三方模块（可选）</span></h3><div id="jVopYS8MUrBKZq6azcFn2m" class="wolai-block wolai-text"><div><span class="inline-wrap">如果你需要更复杂的健康检查功能，可以考虑使用第三方模块，如</span><span class="inline-wrap"><code>nginx_upstream_check_module</code></span><span class="inline-wrap">。这个模块提供了更多的健康检查选项，如<span class="jill"></span>HTTP<span class="jill"></span>检查、TCP<span class="jill"></span>检查等。</span></div></div><h4 id="rSGgc9pvw7AHuqQqfkAbSE" class="wolai-block"><span class="wolai-serial-number">18.3.1</span><span class="inline-wrap">安装第三方模块</span></h4><div id="JocTgLXPBB5d7fBvyaTAL" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，你需要下载并编译<span class="jill"></span>Nginx，同时包含</span><span class="inline-wrap"><code>nginx_upstream_check_module</code></span><span class="inline-wrap">模块。以下是一个基本的安装步骤：</span></div></div><code-block id="uvFTfAo8qUUQpg4VudoWQc" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token comment"># 下载Nginx源码</span>
<span class="token function">wget</span> http://nginx.org/download/nginx-1.20.1.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> nginx-1.20.1.tar.gz
<span class="token builtin class-name">cd</span> nginx-1.20.1

<span class="token comment"># 下载nginx_upstream_check_module模块源码</span>
<span class="token function">git</span> clone https://github.com/yaoweibin/nginx_upstream_check_module.git

<span class="token comment"># 编译Nginx并包含模块</span>
./configure --add-module<span class="token operator">=</span>./nginx_upstream_check_module
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></pre></div></code-block><h4 id="v1HLKQ95Tw8LUQZSykxE6S" class="wolai-block"><span class="wolai-serial-number">18.3.2</span><span class="inline-wrap">配置第三方模块</span></h4><div id="wsmRVhdfG6PgzCg8puP4nG" class="wolai-block wolai-text"><div><span class="inline-wrap">安装完成后，你可以在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中使用</span><span class="inline-wrap"><code>check</code></span><span class="inline-wrap">指令来配置健康检查。例如：</span></div></div><code-block id="kbxshSn6T5uVJQhgBV69HC" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">server</span> backend1.example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> backend2.example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> backend3.example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">check</span> interval=5000 rise=2 fall=5 timeout=2000 type=http</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="2UUyPTeMrxLoaJXj8AoaWC" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中：</span></div></div><ul class="wolai-block"><li id="3UiMcBWXpYvoQxKPN8gfui"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>interval=5000</code></span><span class="inline-wrap">：每<span class="jill"></span>5<span class="jill"></span>秒进行一次健康检查。</span></li><li id="kfSHnvSwJmjQLhVGXmEa5z"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>rise=2</code></span><span class="inline-wrap">：如果连续两次检查成功，则认为服务器恢复正常。</span></li><li id="cPZ2Y3kNjqNKRA7RJMm7L4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>fall=5</code></span><span class="inline-wrap">：如果连续五次检查失败，则认为服务器不可用。</span></li><li id="dKzRmFbg3koS2JZTJDhxXE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>timeout=2000</code></span><span class="inline-wrap">：每次健康检查的超时时间为<span class="jill"></span>2<span class="jill"></span>秒。</span></li><li id="nuXhu3RgmMjM684sw6tR9C"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>type=http</code></span><span class="inline-wrap">：使用<span class="jill"></span>HTTP<span class="jill"></span>协议进行健康检查。</span></li></ul><div id="38qKxzHHp9GMP9pcMVTsiE" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上配置，Nginx<span class="jill"></span>能够有效地监控后端服务器的健康状态，并在检测到服务器故障时自动将流量转移到其他健康的服务器上，从而提高系统的稳定性和可靠性。</span></div></div><div id="aMhshuXaawUSsmMZPePZ86" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="uWaDgsxkCAL4QmHcVyt9vw" class="wolai-block"><span class="wolai-serial-number">19</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中限制客户端请求速率？</span></h1><div id="hyBzwhLyAE829sUeaw5xzD" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中，限制客户端请求速率可以通过使用</span><span class="inline-wrap"><code>limit_req</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>limit_conn</code></span><span class="inline-wrap">模块来实现。这些模块允许你控制每个<span class="jill"></span>IP<span class="jill"></span>地址的请求速率和连接数，从而防止滥用和<span class="jill"></span>DDoS<span class="jill"></span>攻击。</span></div></div><h3 id="xrQEWfaHks4uLbHAcRQy22" class="wolai-block"><span class="wolai-serial-number">19.1</span><span class="inline-wrap">使用 </span><span class="inline-wrap"><code>limit_req</code></span><span class="inline-wrap"> 模块</span></h3><div id="5iMD2x3nv6vsh717j3bc3H" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>limit_req</code></span><span class="inline-wrap">模块用于限制每个<span class="jill"></span>IP<span class="jill"></span>地址的请求速率。你需要定义一个共享内存区域来存储请求计数器，并在服务器或位置块中使用</span><span class="inline-wrap"><code>limit_req_zone</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>limit_req</code></span><span class="inline-wrap">指令。</span></div></div><h4 id="s9uSbpJjSiXtMRg8hjN779" class="wolai-block"><span class="wolai-serial-number">19.1.1</span><span class="inline-wrap">配置示例</span></h4><code-block id="nuAdXNyP8kg3vLSq3THfjg" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 定义一个名为 'one' 的共享内存区域，大小为 10MB，用于存储请求计数器</span>
    <span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=one:10m rate=1r/s</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token comment"># 应用请求速率限制</span>
            <span class="token directive"><span class="token keyword">limit_req</span> zone=one burst=5 nodelay</span><span class="token punctuation">;</span>

            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="4L88KgPSv9o4Q9DyVcqG6K" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中：</span></div></div><ul class="wolai-block"><li id="tzPxsJXHRNvr5WVjpxK7jj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;</code></span><span class="inline-wrap">：定义了一个名为</span><span class="inline-wrap"><code>one</code></span><span class="inline-wrap">的共享内存区域，大小为<span class="jill"></span>10MB，用于存储请求计数器。</span><span class="inline-wrap"><code>rate=1r/s</code></span><span class="inline-wrap">表示每秒允许<span class="jill"></span>1<span class="jill"></span>个请求。</span></li><li id="jubBzFbW12i4miimj15eV8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>limit_req zone=one burst=5 nodelay;</code></span><span class="inline-wrap">：对请求速率进行限制。</span><span class="inline-wrap"><code>burst=5</code></span><span class="inline-wrap">表示允许突发最多<span class="jill"></span>5<span class="jill"></span>个请求，</span><span class="inline-wrap"><code>nodelay</code></span><span class="inline-wrap">表示不延迟处理突发请求。</span></li></ul><h3 id="eZvQeignL2GCBfHAyWmo5J" class="wolai-block"><span class="wolai-serial-number">19.2</span><span class="inline-wrap">使用 </span><span class="inline-wrap"><code>limit_conn</code></span><span class="inline-wrap"> 模块</span></h3><div id="jn5HLCrFdpT8fy6S7j575" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>limit_conn</code></span><span class="inline-wrap">模块用于限制每个<span class="jill"></span>IP<span class="jill"></span>地址的并发连接数。你需要定义一个共享内存区域来存储连接计数器，并在服务器或位置块中使用</span><span class="inline-wrap"><code>limit_conn_zone</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>limit_conn</code></span><span class="inline-wrap">指令。</span></div></div><h4 id="rVZ7sqsN9CXsN8CsA6FBWL" class="wolai-block"><span class="wolai-serial-number">19.2.1</span><span class="inline-wrap">配置示例</span></h4><code-block id="demc6uNjgBXoiHU5LaUoJJ" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 定义一个名为 'addr' 的共享内存区域，大小为 10MB，用于存储连接计数器</span>
    <span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone=addr:10m</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token comment"># 应用连接数限制</span>
            <span class="token directive"><span class="token keyword">limit_conn</span> addr <span class="token number">10</span></span><span class="token punctuation">;</span>

            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="4dv4EcCLJaqsFh94foGxKH" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中：</span></div></div><ul class="wolai-block"><li id="sAcgemP3S4VTrdQHP6Jovq"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>limit_conn_zone $binary_remote_addr zone=addr:10m;</code></span><span class="inline-wrap">：定义了一个名为</span><span class="inline-wrap"><code>addr</code></span><span class="inline-wrap">的共享内存区域，大小为<span class="jill"></span>10MB，用于存储连接计数器。</span></li><li id="4ZPbrTvX8wWCuE56ngn2Wn"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>limit_conn addr 10;</code></span><span class="inline-wrap">：对每个<span class="jill"></span>IP<span class="jill"></span>地址的并发连接数进行限制，最多允许<span class="jill"></span>10<span class="jill"></span>个并发连接。</span></li></ul><h3 id="tLLK95EsV4DJRgsq5cznt8" class="wolai-block"><span class="wolai-serial-number">19.3</span><span class="inline-wrap">综合使用 </span><span class="inline-wrap"><code>limit_req</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>limit_conn</code></span></h3><div id="oZW9bcpuRfugcotwnLqhiN" class="wolai-block wolai-text"><div><span class="inline-wrap">你可以同时使用这两个模块来更全面地限制客户端请求速率和并发连接数。例如：</span></div></div><code-block id="gTK5DzKmRsLTHFtZHnKpWw" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 定义请求速率限制的共享内存区域</span>
    <span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=one:10m rate=1r/s</span><span class="token punctuation">;</span>
    <span class="token comment"># 定义连接数限制的共享内存区域</span>
    <span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone=addr:10m</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token comment"># 应用请求速率限制</span>
            <span class="token directive"><span class="token keyword">limit_req</span> zone=one burst=5 nodelay</span><span class="token punctuation">;</span>
            <span class="token comment"># 应用连接数限制</span>
            <span class="token directive"><span class="token keyword">limit_conn</span> addr <span class="token number">10</span></span><span class="token punctuation">;</span>

            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="hHmwM4cR3Lwyy3C6vHG5Vx" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，每个<span class="jill"></span>IP<span class="jill"></span>地址的请求速率被限制为每秒<span class="jill"></span>1<span class="jill"></span>个请求，并且每个<span class="jill"></span>IP<span class="jill"></span>地址的并发连接数被限制为最多<span class="jill"></span>10<span class="jill"></span>个。</span></div></div><div id="7vgBBCpJN8qcvwWtu9hKys" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上配置，Nginx<span class="jill"></span>能够有效地限制客户端请求速率和并发连接数，从而保护后端服务器免受滥用和<span class="jill"></span>DDoS<span class="jill"></span>攻击的影响。</span></div></div><div id="4cJR8UAUaJC9bM5PPGLi5e" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="qcRayqH2NGqabqPLcdmLjW" class="wolai-block"><span class="wolai-serial-number">20</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中处理慢请求？</span></h1><div id="8QNe8kqXYJ8mhGpJNqCuoA" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中处理慢请求可以通过配置超时参数来实现。这些参数可以控制客户端连接、读取和发送数据的超时时间，从而防止慢请求占用服务器资源。以下是一些常用的超时参数及其配置方法：</span></div></div><h3 id="3GB2yEBPTJR6BSAja79Cyf" class="wolai-block"><span class="wolai-serial-number">20.1</span><span class="inline-wrap"><code>client_body_timeout</code></span></h3><div id="myXy3Xs4CTQb9intRsW2EK" class="wolai-block wolai-text"><div><span class="inline-wrap">这个指令用于设置客户端发送请求体的超时时间。如果客户端在指定时间内没有发送完整的请求体，Nginx<span class="jill"></span>将关闭连接。</span></div></div><code-block id="2DNdgv5nHGEF7GkwJw97q2" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">client_body_timeout</span> <span class="token number">10s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="o8QimPgoEvmAxj8oXfTGti" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，如果客户端在<span class="jill"></span>10<span class="jill"></span>秒内没有发送完整的请求体，Nginx<span class="jill"></span>将关闭连接。</span></div></div><h3 id="eq4VtjB5rq3JWRQrDk1Ta7" class="wolai-block"><span class="wolai-serial-number">20.2</span><span class="inline-wrap"><code>client_header_timeout</code></span></h3><div id="81jWGQwpVsaDvWHmMi6s7v" class="wolai-block wolai-text"><div><span class="inline-wrap">这个指令用于设置客户端发送请求头的超时时间。如果客户端在指定时间内没有发送完整的请求头，Nginx<span class="jill"></span>将关闭连接。</span></div></div><code-block id="gNjyBjv7Z67hyGobR5xCYj" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">client_header_timeout</span> <span class="token number">10s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="9YDKMfBkBu1Ki1bYs16hRm" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，如果客户端在<span class="jill"></span>10<span class="jill"></span>秒内没有发送完整的请求头，Nginx<span class="jill"></span>将关闭连接。</span></div></div><h3 id="bo4DNueXNUSKt4xZFKHP1G" class="wolai-block"><span class="wolai-serial-number">20.3</span><span class="inline-wrap"><code>keepalive_timeout</code></span></h3><div id="uKeGcEMtj4n3JkuidMd9cY" class="wolai-block wolai-text"><div><span class="inline-wrap">这个指令用于设置长连接的超时时间。如果客户端在指定时间内没有发送新的请求，Nginx<span class="jill"></span>将关闭连接。</span></div></div><code-block id="8DCehfTpLitcSek3V1bBMq" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">75s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="eRAWHa3CQyebtDWjaMgG9T" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，如果客户端在<span class="jill"></span>75<span class="jill"></span>秒内没有发送新的请求，Nginx<span class="jill"></span>将关闭连接。</span></div></div><h3 id="pvtiRofRMeiDHDf4sPBVmV" class="wolai-block"><span class="wolai-serial-number">20.4</span><span class="inline-wrap"><code>send_timeout</code></span></h3><div id="oGGSRWqpLuVpfJLgKcmPBB" class="wolai-block wolai-text"><div><span class="inline-wrap">这个指令用于设置响应数据发送给客户端的超时时间。如果<span class="jill"></span>Nginx<span class="jill"></span>在指定时间内没有成功发送响应数据，连接将被关闭。</span></div></div><code-block id="iGqrztWHSt4kGpjrKynsKY" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">send_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="j8gs5U6YCjzM2HiwuavcqJ" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，如果<span class="jill"></span>Nginx<span class="jill"></span>在<span class="jill"></span>60<span class="jill"></span>秒内没有成功发送响应数据，连接将被关闭。</span></div></div><h3 id="3QE8ZPxuDfe1KaZ6Q1hsZg" class="wolai-block"><span class="wolai-serial-number">20.5</span><span class="inline-wrap"><code>proxy_read_timeout</code></span></h3><div id="m9NB7nxuyexN3AL5cowGd3" class="wolai-block wolai-text"><div><span class="inline-wrap">这个指令用于设置从后端服务器读取响应数据的超时时间。如果<span class="jill"></span>Nginx<span class="jill"></span>在指定时间内没有从后端服务器读取到响应数据，连接将被关闭。</span></div></div><code-block id="fP5GeZR7uDwrSypaGJVoE5" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="712A8jqoKJBXfw9VgLWfbe" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，如果<span class="jill"></span>Nginx<span class="jill"></span>在<span class="jill"></span>60<span class="jill"></span>秒内没有从后端服务器读取到响应数据，连接将被关闭。</span></div></div><h3 id="cj1dPp2VcfTXbmGW8DbNGp" class="wolai-block"><span class="wolai-serial-number">20.6</span><span class="inline-wrap"><code>proxy_connect_timeout</code></span></h3><div id="ZmnzhhAtKDvSSFCJPHuPu" class="wolai-block wolai-text"><div><span class="inline-wrap">这个指令用于设置连接到后端服务器的超时时间。如果<span class="jill"></span>Nginx<span class="jill"></span>在指定时间内无法连接到后端服务器，连接将被关闭。</span></div></div><code-block id="kLj3kCV7V7dahe2gq3C8Qz" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="hzx7S47SX4KZ6chg9ACTEG" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，如果<span class="jill"></span>Nginx<span class="jill"></span>在<span class="jill"></span>30<span class="jill"></span>秒内无法连接到后端服务器，连接将被关闭。</span></div></div><h3 id="qfr691Cr1HV75kCiB3evLm" class="wolai-block"><span class="wolai-serial-number">20.7</span><span class="inline-wrap"><code>proxy_send_timeout</code></span></h3><div id="m9en2DXBr65SiEPGesjqRF" class="wolai-block wolai-text"><div><span class="inline-wrap">这个指令用于设置向后端服务器发送请求数据的超时时间。如果<span class="jill"></span>Nginx<span class="jill"></span>在指定时间内没有成功发送请求数据，连接将被关闭。</span></div></div><code-block id="d2JgFwyj74rgZmUxfXFPsm" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="afyKfzbNKqSz2gCEnbVAJX" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，如果<span class="jill"></span>Nginx<span class="jill"></span>在<span class="jill"></span>30<span class="jill"></span>秒内没有成功发送请求数据，连接将被关闭。</span></div></div><h3 id="sCynu9E6r7xRJ9BF5MrSWQ" class="wolai-block"><span class="wolai-serial-number">20.8</span><span class="inline-wrap">综合示例</span></h3><div id="iUvpoN3NduaczTVcYpfMbJ" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是一个综合示例，展示了如何在一个<span class="jill"></span>Nginx<span class="jill"></span>配置文件中同时设置多个超时参数：</span></div></div><code-block id="ww2o2HHaqaPyd8bC7obaFd" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 设置客户端发送请求体的超时时间为10秒</span>
    <span class="token directive"><span class="token keyword">client_body_timeout</span> <span class="token number">10s</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 设置客户端发送请求头的超时时间为10秒</span>
    <span class="token directive"><span class="token keyword">client_header_timeout</span> <span class="token number">10s</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 设置长连接的超时时间为75秒</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">75s</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 设置响应数据发送给客户端的超时时间为60秒</span>
    <span class="token directive"><span class="token keyword">send_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 设置从后端服务器读取响应数据的超时时间为60秒</span>
    <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">60s</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 设置连接到后端服务器的超时时间为30秒</span>
    <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 设置向后端服务器发送请求数据的超时时间为30秒</span>
    <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="an9H7vfkQM37cAbBV94ear" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上配置，你可以有效地控制<span class="jill"></span>Nginx<span class="jill"></span>处理慢请求的行为，从而提高服务器的性能和稳定性。</span></div></div><div id="roP1C3tP6ghhJPFD31xtie" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="wFKs71QX2ToZhuyApn4RkN" class="wolai-block"><span class="wolai-serial-number">21</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>epoll<span class="jill"></span>机制。</span></h1><div id="f14FW9AE9sLF4jmmtjPQPt" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>中的<span class="jill"></span>epoll<span class="jill"></span>机制是一种高效的<span class="jill"></span>I/O<span class="jill"></span>事件通知机制，主要用于处理大量并发连接。它是由<span class="jill"></span>Linux<span class="jill"></span>内核提供的一种多路复用<span class="jill"></span>I/O<span class="jill"></span>接口，能够高效地监控多个文件描述符（如套接字）的状态变化，并在这些文件描述符就绪时通知应用程序。</span></div></div><h3 id="t6xaBaXpqx7MhPCwkKcmLJ" class="wolai-block"><span class="wolai-serial-number">21.1</span><span class="inline-wrap">epoll 机制的工作原理</span></h3><ol class="wolai-block"><li id="gMxpw3v2yqWTXDTFw1tnZt"><div class="marker"></div><span class="inline-wrap"><b>创建 epoll 实例</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="dEjwwR9e1r4NdgS6NUC5uv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用 </span><span class="inline-wrap"><code>epoll_create</code></span><span class="inline-wrap"> 或 </span><span class="inline-wrap"><code>epoll_create1</code></span><span class="inline-wrap"> 系统调用创建一个 epoll 实例，返回一个 epoll 文件描述符。</span></li></ul></li><li id="tJSDXzKQUZDmSjfDxGCH9x"><div class="marker"></div><span class="inline-wrap"><b>注册文件描述符</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="4bwAWpscf7r57n7YfVQECf"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用 </span><span class="inline-wrap"><code>epoll_ctl</code></span><span class="inline-wrap"> 系统调用将需要监控的文件描述符添加到 epoll 实例中。可以指定要监控的事件类型，如读、写和异常。</span></li></ul></li><li id="wQH39PDVD7CdLK47QdTXcg"><div class="marker"></div><span class="inline-wrap"><b>等待事件</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="sHsJZnHorojUG2UH5kYQZK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用 </span><span class="inline-wrap"><code>epoll_wait</code></span><span class="inline-wrap"> 系统调用等待事件发生。当有文件描述符就绪时，</span><span class="inline-wrap"><code>epoll_wait</code></span><span class="inline-wrap"> 会返回并填充一个事件列表，应用程序可以根据这个列表进行相应的处理。</span></li></ul></li><li id="akHok46CUSD6kXBrnAZjPJ"><div class="marker"></div><span class="inline-wrap"><b>处理事件</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="b3MdqZA1WXdFN6vYvJVbMW"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">应用程序根据 </span><span class="inline-wrap"><code>epoll_wait</code></span><span class="inline-wrap"> 返回的事件列表，对就绪的文件描述符进行处理，如读取数据、写入数据等。</span></li></ul></li><li id="3VwebGm4tytEf9PkKErFEf"><div class="marker"></div><span class="inline-wrap"><b>修改或删除文件描述符</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="7mCkCt319gVizfkWx6uija"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用 </span><span class="inline-wrap"><code>epoll_ctl</code></span><span class="inline-wrap"> 系统调用可以修改或删除已经注册的文件描述符。</span></li></ul></li></ol><h3 id="i3aX1UEVgabkqPswSuKmtx" class="wolai-block"><span class="wolai-serial-number">21.2</span><span class="inline-wrap">epoll 的优势</span></h3><ul class="wolai-block"><li id="uo61yWs8Vhb64tR4Amc6Pb"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>高效性</b></span><span class="inline-wrap">：epoll 在处理大量并发连接时比传统的 </span><span class="inline-wrap"><code>select</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>poll</code></span><span class="inline-wrap"> 更加高效，因为它避免了每次调用都需要遍历所有文件描述符的开销。</span></li><li id="wRQeU3rQ6piftCEfxTn3Vr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>可扩展性</b></span><span class="inline-wrap">：epoll 支持动态添加和删除文件描述符，适应高并发场景的需求。</span></li><li id="w68RhbKMTzXDSyvDerDrj3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>事件驱动</b></span><span class="inline-wrap">：epoll 采用事件驱动模型，只有在文件描述符状态发生变化时才会通知应用程序，减少了不必要的系统调用。</span></li></ul><h3 id="fJamw8yAB5hrx2TZPvZttA" class="wolai-block"><span class="wolai-serial-number">21.3</span><span class="inline-wrap">Nginx 中的 epoll 应用</span></h3><div id="9WrvbAmKwTVrQbrys2zX4t" class="wolai-block wolai-text"><div><span class="inline-wrap">在 Nginx 中，epoll 被广泛应用于网络事件的处理，特别是在处理大量并发连接时。以下是 Nginx 中使用 epoll 的一些关键点：</span></div></div><ol class="wolai-block"><li id="v66xkqGgMpcX2oZaaEx2vS"><div class="marker"></div><span class="inline-wrap"><b>事件循环</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="vNdrSCAHaXyL97pGuhHyVe"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nginx 使用一个事件循环来管理所有的 I/O 事件。在这个循环中，Nginx 使用 epoll 来监控各种事件，如新连接的到来、数据的读写等。</span></li></ul></li><li id="uh3bEUeXCzwZbbebLiz5jF"><div class="marker"></div><span class="inline-wrap"><b>异步非阻塞 I/O</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="w6uTMp9PzQHg7JDxq2xkjY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nginx 采用异步非阻塞 I/O 模型，通过 epoll 实现高效的事件通知。这使得 Nginx 能够在单线程或少量线程的情况下处理大量的并发请求。</span></li></ul></li><li id="c1BXyA6GANUrtYCh25gugC"><div class="marker"></div><span class="inline-wrap"><b>负载均衡和反向代理</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="ca1TYKJnqBBngVNZV1XeaR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在负载均衡和反向代理的场景中，Nginx 需要同时处理来自客户端的请求和后端服务器的响应。通过 epoll，Nginx 可以高效地管理这些请求和响应，确保高性能和低延迟。</span></li></ul></li></ol><h3 id="dcKJWSJsPf9HZn8yYHMRbv" class="wolai-block"><span class="wolai-serial-number">21.4</span><span class="inline-wrap">示例代码</span></h3><div id="pr66nusS4QGBCMkxc3T6zS" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是一个简化的示例代码，展示了如何在 C 语言中使用 epoll：</span></div></div><code-block id="n1pJMrJmFpdiGZCE3UvgFS" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/epoll.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_EVENTS</span> <span class="token expression"><span class="token number">10</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> epoll_fd <span class="token operator">=</span> <span class="token function">epoll_create1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>epoll_fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"epoll_create1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> event<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> events<span class="token punctuation">[</span>MAX_EVENTS<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> listen_sock <span class="token operator">=</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span> <span class="token comment">// 假设已经创建了一个监听套接字</span>

    event<span class="token punctuation">.</span>events <span class="token operator">=</span> EPOLLIN<span class="token punctuation">;</span>
    event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd <span class="token operator">=</span> listen_sock<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">epoll_ctl</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">,</span> EPOLL_CTL_ADD<span class="token punctuation">,</span> listen_sock<span class="token punctuation">,</span> <span class="token operator">&amp;</span>event<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"epoll_ctl: listen_sock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> nfds <span class="token operator">=</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">,</span> events<span class="token punctuation">,</span> MAX_EVENTS<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nfds <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"epoll_wait"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> nfds<span class="token punctuation">;</span> <span class="token operator">++</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>events<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd <span class="token operator">==</span> listen_sock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 处理新的连接</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 处理已存在的连接的数据读写</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="qBJWaGLpq4R7nVBEmwnBK5" class="wolai-block"><span class="wolai-serial-number">21.5</span><span class="inline-wrap">总结</span></h3><div id="8ShVXgerJUyxbJF7DqoWYW" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx 中的 epoll 机制通过高效的事件通知和处理方式，使得 Nginx 能够在高并发环境下保持高性能和稳定性。epoll 的引入极大地提升了 Nginx 在处理大量并发连接时的效率，是 Nginx 能够成为高性能 Web 服务器的重要原因之一。</span></div></div><div id="qNDZFFYixF2CTz47rrTtRS" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="6qaZTsPAgUPWESWWuMsg7M" class="wolai-block"><span class="wolai-serial-number">22</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中实现动静分离？</span></h1><div id="igqBdq7RdqGwmzYiEZyuUj" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中实现动静分离（将动态内容和静态内容分别处理）是一种常见的优化策略，可以提高服务器的性能和响应速度。以下是实现动静分离的步骤：</span></div></div><h3 id="fUmJkd9ZMhiAdABoq8TmTY" class="wolai-block"><span class="wolai-serial-number">22.1</span><span class="inline-wrap">安装 Nginx</span></h3><div id="prQK2qUGfyjt6bgroig4gX" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，确保你已经安装了 Nginx。如果还没有安装，可以使用以下命令进行安装：</span></div></div><code-block id="mAxXd3CK6GmuQJAcwqVQfh" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nginx</pre></div></code-block><h3 id="oaSyF9aSFdgVvYZKD3AeJd" class="wolai-block"><span class="wolai-serial-number">22.2</span><span class="inline-wrap">配置 Nginx</span></h3><div id="4W4TyqoXs2bb5ZjspU98qc" class="wolai-block wolai-text"><div><span class="inline-wrap">编辑 Nginx 配置文件，通常位于 </span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap"> 或 </span><span class="inline-wrap"><code>/etc/nginx/sites-available/default</code></span><span class="inline-wrap">。</span></div></div><h4 id="o5BaQ1TxyXSoEd9EoG8W3S" class="wolai-block"><span class="wolai-serial-number">22.2.1</span><span class="inline-wrap">示例配置</span></h4><div id="gbQD2eQUq5mzNB5YzqsBRU" class="wolai-block wolai-text"><div><span class="inline-wrap">假设你的静态文件存放在 </span><span class="inline-wrap"><code>/var/www/html/static</code></span><span class="inline-wrap"> 目录，而动态请求由后端应用服务器（如 PHP-FPM、Node.js 等）处理。</span></div></div><code-block id="baFX9BS6M8i3VJJP66FP7H" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> your_domain.com</span><span class="token punctuation">;</span>

    <span class="token comment"># 定义根目录</span>
    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>

    <span class="token comment"># 处理静态文件</span>
    <span class="token directive"><span class="token keyword">location</span> /static/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">alias</span> /var/www/html/static/</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>  <span class="token comment"># 设置缓存时间</span>
        <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>  <span class="token comment"># 关闭访问日志</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 处理动态请求</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend_server</span><span class="token punctuation">;</span>  <span class="token comment"># 将请求转发到后端服务器</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="3a5zfNwyDZNA3uuJUaoNKw" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中：</span></div></div><ul class="wolai-block"><li id="x7Uk7p9obCC6fsBo7JA91u"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location /static/</code></span><span class="inline-wrap"> 用于处理静态文件请求，使用 </span><span class="inline-wrap"><code>alias</code></span><span class="inline-wrap"> 指令将请求映射到实际的文件系统路径。</span></li><li id="p1VsYiQndyESYKFeE91RLQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>expires 30d;</code></span><span class="inline-wrap"> 设置了静态文件的缓存时间为 30 天。</span></li><li id="w4HbZfUwcRkETnjTQDBM53"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>access_log off;</code></span><span class="inline-wrap"> 关闭了对静态文件的访问日志记录。</span></li><li id="iJ7BFEYitD25Eu3AHfhpJu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location /</code></span><span class="inline-wrap"> 用于处理动态请求，通过 </span><span class="inline-wrap"><code>proxy_pass</code></span><span class="inline-wrap"> 指令将请求转发到后端服务器（例如 PHP-FPM、Node.js 等）。</span></li></ul><h3 id="n46qnsi79hxHBBGNYdKdKH" class="wolai-block"><span class="wolai-serial-number">22.3</span><span class="inline-wrap">重启 Nginx</span></h3><div id="favJhnaUb6VfE4wv2uNixi" class="wolai-block wolai-text"><div><span class="inline-wrap">保存配置文件后，重启 Nginx 以使配置生效：</span></div></div><code-block id="qdNzNkeHqcNniCcEhgMTnG" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block><h3 id="n2oKXGmpH9gWvPH3mq8fgq" class="wolai-block"><span class="wolai-serial-number">22.4</span><span class="inline-wrap">验证配置</span></h3><div id="fEDrfk6mmD4xexHyyHkKcD" class="wolai-block wolai-text"><div><span class="inline-wrap">打开浏览器，访问你的域名或 IP 地址，并检查静态资源是否正确加载。同时，确认动态请求是否被正确转发到后端服务器。</span></div></div><h3 id="kTBfAzVdapGG4JWfepRJ9A" class="wolai-block"><span class="wolai-serial-number">22.5</span><span class="inline-wrap">高级配置（可选）</span></h3><div id="rdELYJBzUW7md15pc6p4UG" class="wolai-block wolai-text"><div><span class="inline-wrap">根据需求，你可以进一步优化配置，例如：</span></div></div><ul class="wolai-block"><li id="2FQM3FQa6a3DoMwMMqwevg"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>压缩</b></span><span class="inline-wrap">：启用 Gzip 压缩来减少传输的数据量。</span></li><li id="vkmNLP7oVdfpJNLK4DKaqU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>缓存控制</b></span><span class="inline-wrap">：为静态资源设置更细粒度的缓存控制策略。</span></li><li id="kQrLonnFJPjbovnNnN7pLV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡</b></span><span class="inline-wrap">：如果有多个后端服务器，可以配置负载均衡策略。</span></li></ul><h4 id="dV48qc7HLQmKxwByqnssth" class="wolai-block"><span class="wolai-serial-number">22.5.1</span><span class="inline-wrap">示例：启用 Gzip 压缩</span></h4><code-block id="mFg9qn1AwjtKPm4W8RaLtY" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_types</span> text/plain application/xml text/css application/javascript</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">1000</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 id="61HseyWD2trAcGgzc3MvDW" class="wolai-block"><span class="wolai-serial-number">22.5.2</span><span class="inline-wrap">示例：负载均衡配置</span></h4><code-block id="dmmC2XvT2hpvqUbQ29Ecee" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">upstream</span> backend_servers</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> backend1.example.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend2.example.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend3.example.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> your_domain.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend_servers</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="2FyJ7aLsrWP4Dgukt7Qz6d" class="wolai-block"><span class="wolai-serial-number">22.6</span><span class="inline-wrap">总结</span></h3><div id="22fZ7AGfthX4rTPxS27aoT" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在 Nginx 中实现动静分离，从而提高服务器的性能和响应速度。这种配置方式适用于大多数 Web 应用场景，能够有效地区分静态和动态内容，从而优化资源的管理和利用。</span></div></div><div id="NzWbiP3fndJZrzDgrAt3f" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="bt43MMixpTyfZtRDhcvH4G" class="wolai-block"><span class="wolai-serial-number">23</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>access log<span class="jill"></span>和<span class="jill"></span>error log。</span></h1><div id="pKSUxRQMK5A24D2EeRFzpR" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中，访问日志（access_log）和错误日志（error_log）是两种重要的日志类型，它们分别记录了不同的信息，用于监控、分析和调试<span class="jill"></span>Nginx<span class="jill"></span>服务器的运行情况。</span></div></div><h3 id="htF5Va3cBzGcG9L8FCnviE" class="wolai-block"><span class="wolai-serial-number">23.1</span><span class="inline-wrap">访问日志（access_log）</span></h3><ol class="wolai-block"><li id="t6tbvncK72nBbWok4j1hXv"><div class="marker"></div><span class="inline-wrap"><b>定义</b></span><span class="inline-wrap">：访问日志主要用于记录客户端对<span class="jill"></span>Nginx<span class="jill"></span>服务器的每一次请求。它包含了请求的详细信息，如客户端<span class="jill"></span>IP<span class="jill"></span>地址、请求时间、请求方法、请求<span class="jill"></span>URL、响应状态码、返回的数据大小以及用户代理等信息。</span></li><li id="4WnLHr9q6wfGrKc8kwUquS"><div class="marker"></div><span class="inline-wrap"><b>配置</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="bZLQL7yBTYXaMXDmjYfU2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>路径</b></span><span class="inline-wrap">：可以通过</span><span class="inline-wrap"><code>access_log</code></span><span class="inline-wrap">指令指定访问日志的存放位置。例如，</span><span class="inline-wrap"><code>access_log /var/logs/nginx-access.log</code></span><span class="inline-wrap">表示将访问日志写入到</span><span class="inline-wrap"><code>/var/logs/nginx-access.log</code></span><span class="inline-wrap">文件。</span></li><li id="jdfavAq3L1S1LZZSzhcW4G"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>格式</b></span><span class="inline-wrap">：默认使用预定义的</span><span class="inline-wrap"><code>combined</code></span><span class="inline-wrap">格式，但也可以通过</span><span class="inline-wrap"><code>log_format</code></span><span class="inline-wrap">指令自定义日志格式。</span></li><li id="5Tg5hEoVV8yrRRFvaK3WaX"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>其他参数</b></span><span class="inline-wrap">：如</span><span class="inline-wrap"><code>buffer=size</code></span><span class="inline-wrap">（指定日志写入时的缓存大小）、</span><span class="inline-wrap"><code>gzip=level</code></span><span class="inline-wrap">（日志写入前进行压缩）和</span><span class="inline-wrap"><code>flush=time</code></span><span class="inline-wrap">（设置缓存的有效时间）等。</span></li></ul></li><li id="ibhVx7BD3s4kHocH23j7JV"><div class="marker"></div><span class="inline-wrap"><b>作用</b></span><span class="inline-wrap">：访问日志对于统计、系统服务排错非常有用。通过分析访问日志，可以了解网站的访问量、用户行为、热门内容等，从而优化网站性能和用户体验。</span></li></ol><h3 id="4pHeboKXFwjD8pBvWZf2ui" class="wolai-block"><span class="wolai-serial-number">23.2</span><span class="inline-wrap">错误日志（error_log）</span></h3><ol class="wolai-block"><li id="5g9umRE2nRxcsRhuGKiMLf"><div class="marker"></div><span class="inline-wrap"><b>定义</b></span><span class="inline-wrap">：错误日志记录了<span class="jill"></span>Nginx<span class="jill"></span>服务器在运行过程中产生的错误信息。这些错误可能包括配置文件语法错误、运行时错误、资源不可用等。</span></li><li id="d8Wnozqdi37HL5hWbgDS68"><div class="marker"></div><span class="inline-wrap"><b>配置</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="o72x9y8Av21UmnmDxq6S6V"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>路径</b></span><span class="inline-wrap">：通过</span><span class="inline-wrap"><code>error_log</code></span><span class="inline-wrap">指令指定错误日志的存放位置。例如，</span><span class="inline-wrap"><code>error_log /var/log/nginx/error.log</code></span><span class="inline-wrap">表示将错误日志写入到</span><span class="inline-wrap"><code>/var/log/nginx/error.log</code></span><span class="inline-wrap">文件中。</span></li><li id="dVK3tUhXGZBcDa18EKNshL"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>级别</b></span><span class="inline-wrap">：可以指定日志级别，如</span><span class="inline-wrap"><code>error</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>warn</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>info</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>debug</code></span><span class="inline-wrap">等。级别越高，记录的信息越详细，但也可能包含更多的噪音信息。</span></li></ul></li><li id="mV9xCjDMcT5u5njHwTnUgZ"><div class="marker"></div><span class="inline-wrap"><b>作用</b></span><span class="inline-wrap">：错误日志是调试<span class="jill"></span>Nginx<span class="jill"></span>服务的重要手段。当服务器出现故障或异常时，通过查看错误日志可以快速定位问题原因，并采取相应的解决措施。</span></li></ol><div id="ahBQwpwtYxvmD1g68h9Dw7" class="wolai-block wolai-text"><div><span class="inline-wrap">综上所述，Nginx<span class="jill"></span>中的访问日志和错误日志分别记录了客户端请求和服务器错误信息，对于监控、分析和调试<span class="jill"></span>Nginx<span class="jill"></span>服务器至关重要。在实际应用中，应根据需求合理配置这两种日志的参数和格式，以充分发挥其作用。</span></div></div><div id="3GfPm4nDhMqKbzuXahx6U3" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="a3gYWBuPQmazxnRn4fajxP" class="wolai-block"><span class="wolai-serial-number">24</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>HTTP<span class="jill"></span>基本认证？</span></h1><div id="693AxhqEFBBdUhwoqiRkhh" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>HTTP<span class="jill"></span>基本认证可以通过以下步骤实现：</span></div></div><ol class="wolai-block"><li id="kHyMTScxrjDxfH9h8M5C7N"><div class="marker"></div><span class="inline-wrap"><b>创建密码文件</b></span><span class="inline-wrap">：使用</span><span class="inline-wrap"><code>htpasswd</code></span><span class="inline-wrap">命令创建一个包含用户名和密码的文件。如果没有</span><span class="inline-wrap"><code>htpasswd</code></span><span class="inline-wrap">命令，可以使用</span><span class="inline-wrap"><code>openssl passwd</code></span><span class="inline-wrap">命令代替。例如，创建一个名为</span><span class="inline-wrap"><code>htpasswd</code></span><span class="inline-wrap">的文件，并添加一个用户名为</span><span class="inline-wrap"><code>dongnan</code></span><span class="inline-wrap">，密码为</span><span class="inline-wrap"><code>zongming.net</code></span><span class="inline-wrap">的用户：</span><code-block id="eSHteiYfn7xGAyDKzERyWP" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>htpasswd <span class="token parameter variable">-bdc</span> htpasswd dongnan zongming.net</pre></div></code-block><div id="2BpfxgaWJbnE244xpyJvSn" class="wolai-block wolai-text"><div><span class="inline-wrap">或者使用</span><span class="inline-wrap"><code>openssl</code></span><span class="inline-wrap">命令：</span></div></div><code-block id="agwdAsNh3VYGsxTTXG27qQ" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">'dongnan:'</span> <span class="token operator">>></span> .htpasswd
openssl <span class="token function">passwd</span> <span class="token parameter variable">-apr1</span> zongming.net <span class="token operator">>></span> .htpasswd</pre></div></code-block></li><li id="iYQeF3Yk4cNCFdBfaNXLr2"><div class="marker"></div><span class="inline-wrap"><b>编辑<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：打开你的<span class="jill"></span>Nginx<span class="jill"></span>配置文件，通常位于</span><span class="inline-wrap"><code>/etc/nginx/conf.d/default.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">。在需要启用<span class="jill"></span>HTTP<span class="jill"></span>基本认证的<span class="jill"></span>location<span class="jill"></span>块中，添加以下指令：</span><code-block id="cmuaXZetM8JjxDYpYasxw3" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">auth_basic</span> <span class="token string">"Restricted Area"</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">auth_basic_user_file</span> /path/to/your/htpasswd</span><span class="token punctuation">;</span></pre></div></code-block><div id="uYXKta5CSQ2eZYCY8kA9yN" class="wolai-block wolai-text"><div><span class="inline-wrap">其中，</span><span class="inline-wrap"><code>&quot;Restricted Area&quot;</code></span><span class="inline-wrap">是身份验证提示信息，可以根据需要进行修改；</span><span class="inline-wrap"><code>/path/to/your/htpasswd</code></span><span class="inline-wrap">是密码文件的路径，请确保路径正确。</span></div></div></li><li id="iGfw5MhHiRe4SDhDr78dTv"><div class="marker"></div><span class="inline-wrap"><b>重启<span class="jill"></span>Nginx<span class="jill"></span>服务</b></span><span class="inline-wrap">：保存配置文件后，重启<span class="jill"></span>Nginx<span class="jill"></span>服务以使配置生效：</span><code-block id="s5wztV2zxTW4HyZceAqqA9" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li></ol><div id="5tt1eiqcGmK6a8hqiVE7kA" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你就可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置<span class="jill"></span>HTTP<span class="jill"></span>基本认证。当用户访问受保护的资源时，将会看到一个登录窗口，要求输入用户名和密码。只有输入正确的凭据后，才能访问资源。请注意，HTTP<span class="jill"></span>基本认证的安全性有限，因为它以明文形式传输凭证，建议在生产环境中结合<span class="jill"></span>HTTPS<span class="jill"></span>使用以提高安全性。</span></div></div><div id="htYjTHRgvxeM2gxrefbk4d" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="uZVE5NsyDPrxgVMZr557Ve" class="wolai-block"><span class="wolai-serial-number">25</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>JWT<span class="jill"></span>认证？</span></h1><div id="bNqggJNvhedNFTC4sL6bL5" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>JWT（JSON Web Token）认证通常涉及以下几个步骤：</span></div></div><ol class="wolai-block"><li id="bYVmiyAFSp8YgwTk4ceqwZ"><div class="marker"></div><span class="inline-wrap"><b>安装必要的模块</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="4XkN5S8i6JNQc2xWAb7T7n"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nginx<span class="jill"></span>本身并不直接支持<span class="jill"></span>JWT<span class="jill"></span>认证，因此你需要使用第三方模块，如</span><span class="inline-wrap"><code>ngx_http_auth_request_module</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>nginx-jwt</code></span><span class="inline-wrap">等。这些模块可以通过包管理器或从源代码编译安装。</span></li></ul></li><li id="7UFbfDuaLMZ4VcuPYctWyQ"><div class="marker"></div><span class="inline-wrap"><b>配置<span class="jill"></span>JWT<span class="jill"></span>认证服务</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="eZ5bGU7qXVcDMWgDD4fWJf"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">你需要一个服务来验证<span class="jill"></span>JWT。这可以是一个专门的认证服务器，或者在你的应用服务器中实现<span class="jill"></span>JWT<span class="jill"></span>验证逻辑。这个服务应该能够解析<span class="jill"></span>JWT<span class="jill"></span>并验证其有效性。</span></li></ul></li><li id="qDzK5FXvxQE6iGbQ7kDc6V"><div class="marker"></div><span class="inline-wrap"><b>修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="cRx3dvHTMMgy7H5SdpaXan"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用</span><span class="inline-wrap"><code>auth_jwt</code></span><span class="inline-wrap">指令或其他相关指令来配置<span class="jill"></span>JWT<span class="jill"></span>认证。你需要指定<span class="jill"></span>JWT<span class="jill"></span>密钥、验证服务<span class="jill"></span>URL<span class="jill"></span>以及其他相关参数。</span></li><li id="qBokBVRAyBQY9zBRTow5TN"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">示例配置可能如下：</span><code-block id="pqAK8e5mWeX7in3wCXNoS9" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">auth_jwt</span> <span class="token string">"Your secret key"</span> <span class="token string">"https://auth.example.com/validate"</span></span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span></pre></div></code-block></li><li id="3nSrMeVHCtARRrT9hdK5BZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">请注意，具体的配置语法和参数取决于你使用的<span class="jill"></span>JWT<span class="jill"></span>模块。</span></li></ul></li><li id="wNWCKTgVXmHsCHXtWuyjWY"><div class="marker"></div><span class="inline-wrap"><b>测试配置</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="u4zoFLswgRrUx8sMKEBH9X"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在完成配置后，重新启动<span class="jill"></span>Nginx<span class="jill"></span>服务以使配置生效。然后，尝试访问受保护的资源以测试<span class="jill"></span>JWT<span class="jill"></span>认证是否按预期工作。</span></li></ul></li><li id="3GWxw7Wd7A5CFVGMS3K5Si"><div class="marker"></div><span class="inline-wrap"><b>处理错误和日志</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="osQF4mzCo6394YnvsDpPmn"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">确保你的<span class="jill"></span>Nginx<span class="jill"></span>配置中包含适当的错误处理和日志记录，以便在出现问题时能够进行调试和故障排除。</span></li></ul></li></ol><div id="d2THRL3WUDDdPrybrbptRv" class="wolai-block wolai-text"><div><span class="inline-wrap">请注意，由于<span class="jill"></span>JWT<span class="jill"></span>认证涉及到安全敏感的操作，因此在生产环境中使用时需要格外小心。确保你的<span class="jill"></span>JWT<span class="jill"></span>密钥保密，并且验证服务是安全的。此外，定期审查和更新你的安全策略也是非常重要的。</span></div></div><div id="sCedLtWW8yfMTMKCk3yvNX" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="bb1zB2rdBHpJX8j6ws8MZM" class="wolai-block"><span class="wolai-serial-number">26</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>location<span class="jill"></span>指令及其用法。</span></h1><div id="eYi36qeRUhn28Pdn2VP8Dx" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中，</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">指令是用于匹配请求<span class="jill"></span>URI<span class="jill"></span>并执行相应操作的关键指令。它允许服务器根据请求的<span class="jill"></span>URI<span class="jill"></span>来决定如何处理这个请求，从而为<span class="jill"></span>Web<span class="jill"></span>应用提供强大的<span class="jill"></span>URL<span class="jill"></span>匹配和处理能力。</span></div></div><h3 id="naJ1yBQVtWgSoBxhjeC1Yo" class="wolai-block"><span class="wolai-serial-number">26.1</span><span class="inline-wrap">作用</span></h3><ul class="wolai-block"><li id="2HzhnQABzMTa4JiQk8u9N8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>URL<span class="jill"></span>匹配</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">指令的主要作用是根据用户请求的<span class="jill"></span>URI<span class="jill"></span>来决定如何处理这个请求。它可以将不同的请求映射到文件系统的不同路径，或者将请求转发到其他服务器。</span></li><li id="udRuTraDMCLQ45rTSHyyPz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>灵活路由</b></span><span class="inline-wrap">：通过合理配置</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">，可以实现诸如静态文件服务、反向代理、负载均衡等多种功能。</span></li></ul><h3 id="c2wD5mtNjNAcNR2Ak8JBhD" class="wolai-block"><span class="wolai-serial-number">26.2</span><span class="inline-wrap">用法</span></h3><ul class="wolai-block"><li id="5pugNm2hcCyMrvN3EWPDG9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>基本语法</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>location [修饰符] 匹配模式 { ... }</code></span><span class="inline-wrap">。其中，“修饰符”是可选的，而“匹配模式”则是必须指定的。大括号内包含了当<span class="jill"></span>URL<span class="jill"></span>匹配成功时要执行的指令集。</span></li><li id="hsso2ahvXGKRbiN7GXvG9g"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>常见修饰符</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="q2vUbtqi8jt8uSTCH9mcVv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>=</b></span><span class="inline-wrap">：表示精确匹配。如果找到精确匹配，则立即停止搜索。</span></li><li id="28N3p5iHrVap2XBHU8cNaw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>^~</b></span><span class="inline-wrap">：表示如果该符号后面的字符是最佳匹配，则采用该规则，不再进行后续的正则表达式匹配。</span></li><li id="gp8gAW8GtAi6D5Q9DnXBBV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>~</b></span><span class="inline-wrap">：表示区分大小写的正则匹配。</span></li><li id="eBZrVqhs8q6pUcxfrcfSQp"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>~</b></span><span class="inline-wrap">*：表示不区分大小写的正则匹配。</span></li><li id="3YFMo7SHMLLQWMrbfN5zGY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>（无修饰符）</b></span><span class="inline-wrap">：表示前缀匹配。</span></li></ul></li><li id="8BisH2rgx7sHT3adhdhnwz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>匹配模式</b></span><span class="inline-wrap">：可以是一个字符串，也可以是一个正则表达式。Nginx<span class="jill"></span>会根据请求的<span class="jill"></span>URI<span class="jill"></span>与这个匹配模式进行比较，以决定是否应用该<span class="jill"></span>location<span class="jill"></span>块中的配置。</span></li><li id="kMusWpdQvNBD53gSxxo1C5"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>示例</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="gZFCpy46TKnvoaqLE6GYY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location = / { ... }</code></span><span class="inline-wrap">：使用&quot;=&quot;修饰符，表示精确匹配根路径&quot;/&quot;。</span></li><li id="mhg2s3j6m7rsxtnmXX3Lcr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location ^~ /images/ { ... }</code></span><span class="inline-wrap">：使用了&quot;^~&quot;修饰符，表示如果请求的<span class="jill"></span>URI<span class="jill"></span>以&quot;/images/&quot;开头，就会使用这个<span class="jill"></span>location<span class="jill"></span>块的配置，且不再检查其他正则表达式<span class="jill"></span>location。</span></li><li id="uCsPokvznRmwQC3kqN1ckA"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location ~ \.(gif|jpg|png)$ { ... }</code></span><span class="inline-wrap">：使用了&quot;~&quot;修饰符，表示对<span class="jill"></span>URI<span class="jill"></span>进行区分大小写的正则匹配。它会匹配所有以&quot;.gif&quot;、&quot;.jpg&quot;或&quot;.png&quot;结尾的请求。</span></li><li id="bfdp7r3JHgT4nQHyQNY3DY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location /documents/ { ... }</code></span><span class="inline-wrap">：没有使用修饰符，表示对&quot;/documents/&quot;路径进行前缀匹配。</span></li></ul></li></ul><div id="cq1D9ruYjFyic6XhFhm5bP" class="wolai-block wolai-text"><div><span class="inline-wrap">总之，Nginx<span class="jill"></span>的</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">指令是一个功能强大且灵活的工具，它允许服务器根据请求的<span class="jill"></span>URI<span class="jill"></span>来执行不同的操作。通过合理配置</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">，可以实现复杂的<span class="jill"></span>Web<span class="jill"></span>服务器功能，如静态文件服务、反向代理、负载均衡等。然而，由于其强大的功能也带来了一定的复杂性，因此正确理解和使用</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">指令对于<span class="jill"></span>Nginx<span class="jill"></span>管理员和<span class="jill"></span>Web<span class="jill"></span>开发者来说至关重要。</span></div></div><div id="nPiRN6RbkT9mZiHVhaw6zn" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="wmLvUJYwsWX78WvhgPkHgq" class="wolai-block"><span class="wolai-serial-number">27</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置自定义错误页面？</span></h1><div id="goE5ShRaUhBupbmFVPFftH" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置自定义错误页面，可以通过修改<span class="jill"></span>Nginx<span class="jill"></span>的配置文件来实现。以下是详细的步骤和示例：</span></div></div><ol class="wolai-block"><li id="47uYydbqxu6EiAA9a5ehp"><div class="marker"></div><span class="inline-wrap"><b>准备自定义错误页面</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="3FHxcv16MC5jD88ssipt4G"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">创建或编辑一个<span class="jill"></span>HTML<span class="jill"></span>文件作为错误页面，例如</span><span class="inline-wrap"><code>50x.html</code></span><span class="inline-wrap">，并将其放置在指定的目录中，如</span><span class="inline-wrap"><code>/usr/local/nginx/html/myerror/</code></span><span class="inline-wrap">。</span></li></ul></li><li id="2wFBuBThD55FNpP2p3nC42"><div class="marker"></div><span class="inline-wrap"><b>修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="gh9JJcQVaKFTngn9Dfwm9E"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/usr/local/nginx/conf/nginx.conf</code></span><span class="inline-wrap">）。</span></li><li id="dQzfZefDu52aBMRP7q2ynw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块中，添加或修改</span><span class="inline-wrap"><code>error_page</code></span><span class="inline-wrap">指令来指定自定义错误页面。例如，对于<span class="jill"></span>500、502、503<span class="jill"></span>和<span class="jill"></span>504<span class="jill"></span>错误，可以配置如下：</span><code-block id="evuqRcV4g25WLNdKN4Gmrd" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="hfRR5oJ26xK5w1JziB4qH4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">接着，使用</span><span class="inline-wrap"><code>location =</code></span><span class="inline-wrap">指令来定义当发生这些错误时，Nginx<span class="jill"></span>应该返回哪个文件。例如：</span><code-block id="bwgeXoSZP54jEvg4bETB78" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /usr/local/nginx/html/myerror</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="4czqkucJxsX1bFKrPLy8km"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果需要为其他类型的错误（如<span class="jill"></span>404）也配置自定义页面，可以类似地添加</span><span class="inline-wrap"><code>error_page</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>location =</code></span><span class="inline-wrap">指令。</span></li></ul></li><li id="6n3CifMatpreFdWnhZwoWd"><div class="marker"></div><span class="inline-wrap"><b>重启<span class="jill"></span>Nginx<span class="jill"></span>服务</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="g13scpVras4XakDFy9yTco"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">保存配置文件后，重启<span class="jill"></span>Nginx<span class="jill"></span>服务以使更改生效。可以使用以下命令：</span><code-block id="25XA6yhoQ9bJX9XevP3Hk9" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li><li id="hpsieHoVJRM3YCmZyGdHy"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">或者，如果你使用的是较旧的系统，可能需要使用：</span><code-block id="mFcj4nUAmfnurbtMkCvkjt" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">service</span> nginx restart</pre></div></code-block></li></ul></li><li id="9krT7ENZSgXCsmZUcWp9iH"><div class="marker"></div><span class="inline-wrap"><b>验证配置</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="vyeXcLr2koH9x6Dq3YLUTD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">访问你的网站，并尝试触发一些错误（如访问不存在的页面或资源），以验证自定义错误页面是否按预期显示。</span></li></ul></li></ol><div id="7C47g6TiTcpUaKLiuRtMny" class="wolai-block wolai-text"><div><span class="inline-wrap">需要注意的是，具体的配置路径和命令可能因<span class="jill"></span>Nginx<span class="jill"></span>的安装方式和操作系统的不同而有所差异。此外，如果你在使用反向代理或其他高级功能，还可能需要配置额外的指令来确保错误页面能够正确显示。</span></div></div><div id="bY7wSFdEh8ZHLqopeqrYcq" class="wolai-block wolai-text"><div><span class="inline-wrap">另外，如果你希望对某些特定的<span class="jill"></span>URL<span class="jill"></span>路径应用不同的错误页面，也可以在相应的</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块中单独配置</span><span class="inline-wrap"><code>error_page</code></span><span class="inline-wrap">指令。</span></div></div><div id="4uXTo1Rieitb9gSMGnPCLS" class="wolai-block wolai-text"><div><span class="inline-wrap">最后，建议在进行任何重大更改之前备份原始的<span class="jill"></span>Nginx<span class="jill"></span>配置文件，以防万一出现问题可以快速恢复。</span></div></div><div id="qNLmdWYMK54VP6HGJamT4n" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="qXpDWrepFutTTfPRQympP5" class="wolai-block"><span class="wolai-serial-number">28</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>HTTP<span class="jill"></span>到<span class="jill"></span>HTTPS<span class="jill"></span>的重定向？</span></h1><div id="sTWdGPPW21YZzaSeKGRmDA" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>HTTP<span class="jill"></span>到<span class="jill"></span>HTTPS<span class="jill"></span>的重定向，可以通过修改<span class="jill"></span>Nginx<span class="jill"></span>的配置文件来实现。以下是详细的步骤和示例：</span></div></div><ol class="wolai-block"><li id="fzC5hSyuYQVU7o694FgBcu"><div class="marker"></div><span class="inline-wrap"><b>准备<span class="jill"></span>SSL<span class="jill"></span>证书</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="hjKUcynbNCeKGTkpHBMkaC"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">确保你已经获得了有效的<span class="jill"></span>SSL<span class="jill"></span>证书，并且已经将证书文件（通常是</span><span class="inline-wrap"><code>.crt</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>.pem</code></span><span class="inline-wrap">文件）和私钥文件（通常是</span><span class="inline-wrap"><code>.key</code></span><span class="inline-wrap">文件）放置在服务器上。</span></li></ul></li><li id="oHV7JxY1xTBr7u8goioYhj"><div class="marker"></div><span class="inline-wrap"><b>修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="3xtzG5mgZ3ybrYsu2GnTSs"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/usr/local/nginx/conf/nginx.conf</code></span><span class="inline-wrap">）。</span></li><li id="uRHLmrzpXon48kGbcKevqP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块中，添加一个新的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块来处理<span class="jill"></span>HTTP<span class="jill"></span>请求，并将其重定向到<span class="jill"></span>HTTPS。例如：</span><code-block id="oZdwbHehBVKHUimhD6X3Zo" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="cCneGvhrMKRM9Ud2ruQtRP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">这个配置表示当有<span class="jill"></span>HTTP<span class="jill"></span>请求到达时，Nginx<span class="jill"></span>会返回一个<span class="jill"></span>301<span class="jill"></span>永久重定向响应，将请求重定向到相应的<span class="jill"></span>HTTPS URL。</span></li></ul></li><li id="sLyteFv6GnsFkqbRGAbPar"><div class="marker"></div><span class="inline-wrap"><b>配置<span class="jill"></span>HTTPS<span class="jill"></span>服务器块</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="mtddgM8nnS9V9BnaBZg49X"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在同一个配置文件中，确保你有一个</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块来处理<span class="jill"></span>HTTPS<span class="jill"></span>请求。例如：</span><code-block id="5BVGD5XwLdK1doSJtPn3NE" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /path/to/your/certificate.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /path/to/your/private.key</span><span class="token punctuation">;</span>

    <span class="token comment"># 其他SSL配置...</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /usr/share/nginx/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="x5W14FpangCwMo57FRuHgF"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">这个配置表示当有<span class="jill"></span>HTTPS<span class="jill"></span>请求到达时，Nginx<span class="jill"></span>会使用指定的<span class="jill"></span>SSL<span class="jill"></span>证书和私钥来处理请求。</span></li></ul></li><li id="o7tRTZqAWg2YqXPxUZWgCR"><div class="marker"></div><span class="inline-wrap"><b>重启<span class="jill"></span>Nginx<span class="jill"></span>服务</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="krj3KpQJVSbiqJRZ1gD1jj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">保存配置文件后，重启<span class="jill"></span>Nginx<span class="jill"></span>服务以使更改生效。可以使用以下命令：</span><code-block id="q4uAyNscNMyChZsu8Fccqv" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li><li id="fuMYgVKzyqqYEo4458byx4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">或者，如果你使用的是较旧的系统，可能需要使用：</span><code-block id="rpUxd4AJx6LuMbDgwUWeeC" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">service</span> nginx restart</pre></div></code-block></li></ul></li><li id="avDP6sTqzX4twx5JKNLEua"><div class="marker"></div><span class="inline-wrap"><b>验证配置</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="3p7UY2A6P2cAHfuFQMS7fE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">访问你的网站，并尝试通过<span class="jill"></span>HTTP<span class="jill"></span>访问，以验证是否被正确重定向到<span class="jill"></span>HTTPS。</span></li></ul></li></ol><div id="tRQRcYpo5CQi8JY2v7uKMV" class="wolai-block wolai-text"><div><span class="inline-wrap">需要注意的是，具体的配置路径和命令可能因<span class="jill"></span>Nginx<span class="jill"></span>的安装方式和操作系统的不同而有所差异。此外，如果你在使用反向代理或其他高级功能，还可能需要配置额外的指令来确保重定向能够正确工作。</span></div></div><div id="qcREmJsVWzQ5Q4kk54dRNR" class="wolai-block wolai-text"><div><span class="inline-wrap">另外，建议在进行任何重大更改之前备份原始的<span class="jill"></span>Nginx<span class="jill"></span>配置文件，以防万一出现问题可以快速恢复。</span></div></div><div id="aDyRkf665VmNeYbzyPDYYA" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="keX1MRG4dFQD3PtJdia1ur" class="wolai-block"><span class="wolai-serial-number">29</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置基于域名的路由？</span></h1><div id="5arLDys7uqC1G9HTEWZEfm" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置基于域名的路由，可以通过修改<span class="jill"></span>Nginx<span class="jill"></span>的配置文件来实现。以下是详细的步骤和示例：</span></div></div><ol class="wolai-block"><li id="uKKmWgrYrg4ANGNCxdKbDf"><div class="marker"></div><span class="inline-wrap"><b>准备服务器块</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="d7XUiYDwSg5wWHJ2CzxEqm"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/usr/local/nginx/conf/nginx.conf</code></span><span class="inline-wrap">）。</span></li><li id="n44HMEPYw8Vbxqo9TSreYx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在配置文件中，为每个域名添加一个</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块。例如，如果你有两个域名</span><span class="inline-wrap"><code>example1.com</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>example2.com</code></span><span class="inline-wrap">，你可以这样配置：</span><code-block id="jD1sRHa1HJMXXihmVzjDgf" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example1.com www.example1.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/example1</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example2.com www.example2.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/example2</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="dY6cmbKdeE1TfLWCfMbtfK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在这个配置中，每个</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块监听相同的端口（80），但使用不同的</span><span class="inline-wrap"><code>server_name</code></span><span class="inline-wrap">指令来区分不同的域名。每个</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块中的</span><span class="inline-wrap"><code>location /</code></span><span class="inline-wrap">指令指定了该域名对应的网站根目录。</span></li></ul></li><li id="8tqh1ctLKGUpEXd9sCbLvQ"><div class="marker"></div><span class="inline-wrap"><b>配置<span class="jill"></span>SSL（可选）</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="3uQTrtJyXY1yHWGBroKvu7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果你希望为这些域名启用<span class="jill"></span>HTTPS，可以在相应的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块中添加<span class="jill"></span>SSL<span class="jill"></span>配置。例如：</span><code-block id="2ZiEqwxjL25743YZJghKtr" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example1.com www.example1.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /path/to/your/certificate.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /path/to/your/private.key</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/example1</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="uNyJTRkT87v42BKAzwc2ym"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">确保为每个需要<span class="jill"></span>HTTPS<span class="jill"></span>的域名都配置了相应的<span class="jill"></span>SSL<span class="jill"></span>证书和私钥。</span></li></ul></li><li id="a4YsgYwViRdmnXTYufzLKF"><div class="marker"></div><span class="inline-wrap"><b>重启<span class="jill"></span>Nginx<span class="jill"></span>服务</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="2vYhaZMwbsycTzXZskhqCe"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">保存配置文件后，重启<span class="jill"></span>Nginx<span class="jill"></span>服务以使更改生效。可以使用以下命令：</span><code-block id="sHpVxqCT1LGBykqTDGMtFk" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li><li id="7LaxyCGdfGcX5cEpinmxGo"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">或者，如果你使用的是较旧的系统，可能需要使用：</span><code-block id="uCCubbBw3RiQWwBH4NDT4n" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">service</span> nginx restart</pre></div></code-block></li></ul></li><li id="tVshUQEfVqTmhcN9kRmCSy"><div class="marker"></div><span class="inline-wrap"><b>验证配置</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="zzrKQpfWej1jdj7ut5csc"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">访问你的网站，通过不同的域名来验证是否按预期工作。</span></li></ul></li></ol><div id="g8Rh3XUEh1cpgEEkc9UfhQ" class="wolai-block wolai-text"><div><span class="inline-wrap">需要注意的是，具体的配置路径和命令可能因<span class="jill"></span>Nginx<span class="jill"></span>的安装方式和操作系统的不同而有所差异。此外，如果你在使用反向代理或其他高级功能，还可能需要配置额外的指令来确保路由能够正确工作。</span></div></div><div id="4DvUr3d4VXFGj4mrDXxE6A" class="wolai-block wolai-text"><div><span class="inline-wrap">另外，建议在进行任何重大更改之前备份原始的<span class="jill"></span>Nginx<span class="jill"></span>配置文件，以防万一出现问题可以快速恢复。</span></div></div><div id="rgJKrgScxfCPt95vC9FRU3" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="sQ5bJ5z7w9jDQYx5u45isu" class="wolai-block"><span class="wolai-serial-number">30</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>limit_req<span class="jill"></span>和<span class="jill"></span>limit_conn<span class="jill"></span>模块。</span></h1><div id="9mtKwGDd2xeVwbsVzNDeTg" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中，</span><span class="inline-wrap"><code>limit_req</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>limit_conn</code></span><span class="inline-wrap">模块用于限制客户端请求的速率和连接数，以防止服务器过载或滥用。以下是对这两个模块的详细解释：</span></div></div><h3 id="gRiaDLNqYsZnVNXw516TDZ" class="wolai-block"><span class="wolai-serial-number">30.1</span><span class="inline-wrap">limit_req 模块</span></h3><div id="uNhfxsjfi3711Qh8cZKV6N" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>limit_req</code></span><span class="inline-wrap">模块用于限制客户端的请求速率，即在一定时间内允许的最大请求数。这对于防止<span class="jill"></span>DDoS<span class="jill"></span>攻击、API<span class="jill"></span>滥用等场景非常有用。</span></div></div><h4 id="uNMna9WvH6yPb43qhsGEVT" class="wolai-block"><span class="wolai-serial-number">30.1.1</span><span class="inline-wrap">配置示例：</span></h4><code-block id="dTpawf8VSJuxfeH7mECgqo" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=mylimit:10m rate=1r/s</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">limit_req</span> zone=mylimit burst=5 nodelay</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><ul class="wolai-block"><li id="fTXjVHBcJPRrSYzgoMFyYc"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>limit_req_zone</code></span><span class="inline-wrap">指令定义了一个共享内存区域，用于存储每个<span class="jill"></span>IP<span class="jill"></span>地址的请求计数。参数说明：</span><ul class="wolai-block"><li id="iPAnfdsfKszRBPsFFAFeyW"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>$binary_remote_addr</code></span><span class="inline-wrap">：使用二进制格式的客户端<span class="jill"></span>IP<span class="jill"></span>地址作为键。</span></li><li id="keX8PtqDq146WTYCLXLBhM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>zone=mylimit:10m</code></span><span class="inline-wrap">：定义一个名为</span><span class="inline-wrap"><code>mylimit</code></span><span class="inline-wrap">的区域，大小为<span class="jill"></span>10MB。</span></li><li id="h3BgJdKoJNrH4T2nXGVtgC"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>rate=1r/s</code></span><span class="inline-wrap">：设置请求速率限制为每秒<span class="jill"></span>1<span class="jill"></span>个请求。</span></li></ul></li><li id="2J2hUYUGjX9SYKQjR6mqEK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>limit_req</code></span><span class="inline-wrap">指令应用到特定的</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块，参数说明：</span><ul class="wolai-block"><li id="hysGcrp3nUQoSm5W4sBSTr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>zone=mylimit</code></span><span class="inline-wrap">：指定要使用的共享内存区域。</span></li><li id="o4BX1x3LR9F6ipSWRXtrUJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>burst=5</code></span><span class="inline-wrap">：允许在短时间内超过速率限制的请求数量（突发请求）。</span></li><li id="utAiC4SjLcHsSfeSeBu9zB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>nodelay</code></span><span class="inline-wrap">：如果设置了</span><span class="inline-wrap"><code>nodelay</code></span><span class="inline-wrap">，超出速率限制的请求会立即返回<span class="jill"></span>503<span class="jill"></span>错误，而不是排队等待。</span></li></ul></li></ul><h3 id="fz9QuEERxauNCXG9cAU9XV" class="wolai-block"><span class="wolai-serial-number">30.2</span><span class="inline-wrap">limit_conn 模块</span></h3><div id="b9F54q92C3s4bmUTdit55x" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>limit_conn</code></span><span class="inline-wrap">模块用于限制单个<span class="jill"></span>IP<span class="jill"></span>地址的并发连接数，以防止过多的并发连接导致服务器资源耗尽。</span></div></div><h4 id="rFHDYcMX8eZtATSUSfiydB" class="wolai-block"><span class="wolai-serial-number">30.2.1</span><span class="inline-wrap">配置示例：</span></h4><code-block id="sLwQufiZTN817tvcVLupre" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone=addr:10m</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">limit_conn</span> addr <span class="token number">5</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><ul class="wolai-block"><li id="6oBcXMXzuNnKx8PnRc4R1T"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>limit_conn_zone</code></span><span class="inline-wrap">指令定义了一个共享内存区域，用于存储每个<span class="jill"></span>IP<span class="jill"></span>地址的连接计数。参数说明：</span><ul class="wolai-block"><li id="7AViP2XaWCQjwzbyG3Kejz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>$binary_remote_addr</code></span><span class="inline-wrap">：使用二进制格式的客户端<span class="jill"></span>IP<span class="jill"></span>地址作为键。</span></li><li id="iRTAzeft8JCTZGjYHQTWvG"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>zone=addr:10m</code></span><span class="inline-wrap">：定义一个名为</span><span class="inline-wrap"><code>addr</code></span><span class="inline-wrap">的区域，大小为<span class="jill"></span>10MB。</span></li></ul></li><li id="2pSnYnRqqhsFq7oG1FyhEg"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>limit_conn</code></span><span class="inline-wrap">指令应用到特定的</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块，参数说明：</span><ul class="wolai-block"><li id="f2ZWiAj8R4XkxhrzKy9TS1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>addr</code></span><span class="inline-wrap">：指定要使用的共享内存区域。</span></li><li id="sH4jhcwzBrF9xhS7ahEsMa"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>5</code></span><span class="inline-wrap">：限制每个<span class="jill"></span>IP<span class="jill"></span>地址的最大并发连接数为<span class="jill"></span>5。</span></li></ul></li></ul><h3 id="vnUmBZCPHd96acAnq3ZH4Z" class="wolai-block"><span class="wolai-serial-number">30.3</span><span class="inline-wrap">总结</span></h3><ul class="wolai-block"><li id="isvSp3gkb8uZDboxT73ueQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>limit_req</b></span><span class="inline-wrap">：用于限制请求速率，可以设置速率限制和突发请求数。适用于需要控制请求频率的场景。</span></li><li id="iedeUGzJ6sP1kJge7LU5w7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>limit_conn</b></span><span class="inline-wrap">：用于限制并发连接数，可以防止过多并发连接导致服务器资源耗尽。适用于需要控制并发连接数的场景。</span></li></ul><div id="rzhFQPh7ZV9qGGUhw11isX" class="wolai-block wolai-text"><div><span class="inline-wrap">通过合理配置这两个模块，可以有效保护<span class="jill"></span>Nginx<span class="jill"></span>服务器免受恶意请求的影响，提高服务器的稳定性和安全性。</span></div></div><div id="byc4uzK7iTUxcqcFGiGKN9" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="7Hac82mmqdv1kKfW5eibDB" class="wolai-block"><span class="wolai-serial-number">31</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置跨域资源共享（CORS）？</span></h1><div id="mJrdr573ksbisLfZ6W4jkr" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置跨域资源共享（CORS）可以通过添加适当的<span class="jill"></span>HTTP<span class="jill"></span>头来实现。以下是详细的步骤和示例：</span></div></div><h3 id="oRb6D6VJddZGxqx3WKGRW8" class="wolai-block"><span class="wolai-serial-number">31.1</span><span class="inline-wrap">修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</span></h3><div id="dPtCGcAS7RSfY3ZoMTyehD" class="wolai-block wolai-text"><div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/usr/local/nginx/conf/nginx.conf</code></span><span class="inline-wrap">）。</span></div></div><h3 id="vUr2K3spVJ2wZ1wZka1Sg3" class="wolai-block"><span class="wolai-serial-number">31.2</span><span class="inline-wrap">添加<span class="jill"></span>CORS<span class="jill"></span>相关的<span class="jill"></span>HTTP<span class="jill"></span>头</span></h3><div id="g9W2LzsPAGBg2s3NkQz95F" class="wolai-block wolai-text"><div><span class="inline-wrap">在需要支持<span class="jill"></span>CORS<span class="jill"></span>的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块或</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块中，添加以下配置：</span></div></div><code-block id="4SADNbMDDwnoniFHUQRfVu" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token comment"># 允许所有来源</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span></span><span class="token punctuation">;</span>

        <span class="token comment"># 允许的方法</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET, POST, OPTIONS'</span></span><span class="token punctuation">;</span>

        <span class="token comment"># 允许的请求头</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Headers'</span> <span class="token string">'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range'</span></span><span class="token punctuation">;</span>

        <span class="token comment"># 允许携带凭证</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span></span><span class="token punctuation">;</span>

        <span class="token comment"># 预检请求的缓存时间</span>
        <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Max-Age'</span> <span class="token number">86400</span></span><span class="token punctuation">;</span>

        <span class="token comment"># 处理OPTIONS预检请求</span>
        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_method</span> = <span class="token string">'OPTIONS'</span>)</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET, POST, OPTIONS'</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Headers'</span> <span class="token string">'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range'</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Max-Age'</span> <span class="token number">86400</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">204</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="2dXT4Dv4a6NJ1gt5Zgz3Wd" class="wolai-block"><span class="wolai-serial-number">31.3</span><span class="inline-wrap">解释配置项</span></h3><ul class="wolai-block"><li id="dDd2CcfvtuyqXeX1JrRP95"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;</code></span><span class="inline-wrap">: 允许所有来源。如果只想允许特定来源，可以将</span><span class="inline-wrap"><code>*</code></span><span class="inline-wrap">替换为具体的域名。</span></li><li id="qRyJQkUmxvCZogj1uxE6zK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>add_header &#39;Access-Control-Allow-Methods&#39; &#39;GET, POST, OPTIONS&#39;</code></span><span class="inline-wrap">: 允许的<span class="jill"></span>HTTP<span class="jill"></span>方法。可以根据需要调整。</span></li><li id="6GoWo33nWxiuWn7nLTBvU1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>add_header &#39;Access-Control-Allow-Headers&#39; &#39;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#39;</code></span><span class="inline-wrap">: 允许的请求头。可以根据需要调整。</span></li><li id="3XFhwzCzy3XBRvmwsWf9cH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39;</code></span><span class="inline-wrap">: 是否允许发送<span class="jill"></span>Cookie<span class="jill"></span>等凭证信息。如果不需要，可以设置为</span><span class="inline-wrap"><code>false</code></span><span class="inline-wrap">。</span></li><li id="uRvqzBJXLhiEdZqLy61zdQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>add_header &#39;Access-Control-Max-Age&#39; 86400</code></span><span class="inline-wrap">: 预检请求的缓存时间，单位是秒。在这个例子中，缓存时间为一天（86400<span class="jill"></span>秒）。</span></li><li id="wfPaBFyvhmXeYXmW9WktCF"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>if ($request_method = &#39;OPTIONS&#39;)</code></span><span class="inline-wrap">: 处理<span class="jill"></span>OPTIONS<span class="jill"></span>预检请求，返回相应的<span class="jill"></span>CORS<span class="jill"></span>头并返回<span class="jill"></span>204<span class="jill"></span>状态码。</span></li></ul><h3 id="2AmwTDDPmq5kASJNiERhNg" class="wolai-block"><span class="wolai-serial-number">31.4</span><span class="inline-wrap">重启<span class="jill"></span>Nginx<span class="jill"></span>服务</span></h3><div id="6sbmPQafbPJn2RuFxFdJ6r" class="wolai-block wolai-text"><div><span class="inline-wrap">保存配置文件后，重启<span class="jill"></span>Nginx<span class="jill"></span>服务以使更改生效。可以使用以下命令：</span></div></div><code-block id="cS9iaMmq5EaSooG79dQigZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block><div id="mtt5dkK1WgZpuaD7FnEcsH" class="wolai-block wolai-text"><div><span class="inline-wrap">或者，如果你使用的是较旧的系统，可能需要使用：</span></div></div><code-block id="bXuNx4rZDcVx2rBzkqa5et" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">service</span> nginx restart</pre></div></code-block><h3 id="unzGTZ2jh9kcFSiuinCBw4" class="wolai-block"><span class="wolai-serial-number">31.5</span><span class="inline-wrap">验证配置</span></h3><div id="uzfgpW9CAiVG2s6r51ovyE" class="wolai-block wolai-text"><div><span class="inline-wrap">通过浏览器或工具（如<span class="jill"></span>Postman）发送跨域请求，检查响应头中是否包含正确的<span class="jill"></span>CORS<span class="jill"></span>头信息。</span></div></div><h3 id="tWqXxY1HGACbpABeMVdyS5" class="wolai-block"><span class="wolai-serial-number">31.6</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="nTgVGFdQaSMJuGtgPqKUkf"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：在生产环境中，不建议将</span><span class="inline-wrap"><code>Access-Control-Allow-Origin</code></span><span class="inline-wrap">设置为</span><span class="inline-wrap"><code>*</code></span><span class="inline-wrap">，应指定具体的域名以提高安全性。</span></li><li id="g8PAMwerwQxebakFbYAJBj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>复杂配置</b></span><span class="inline-wrap">：对于更复杂的<span class="jill"></span>CORS<span class="jill"></span>需求，可以考虑使用<span class="jill"></span>Nginx<span class="jill"></span>的第三方模块或<span class="jill"></span>Lua<span class="jill"></span>脚本进行更细粒度的控制。</span></li></ul><div id="sJjqk1Z5rv6h7dLESRGAqb" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置<span class="jill"></span>CORS，从而允许跨域请求访问你的资源。</span></div></div><div id="8nztByy3kVgHA5Td4DhBrw" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="9WVaFeWP2eZPT5JWeCNDED" class="wolai-block"><span class="wolai-serial-number">32</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>WebSocket<span class="jill"></span>支持？</span></h1><div id="esPEMkCuxENmZubY8m37m4" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>WebSocket<span class="jill"></span>支持相对简单，因为<span class="jill"></span>Nginx<span class="jill"></span>原生支持<span class="jill"></span>WebSocket<span class="jill"></span>协议。以下是详细的步骤和示例：</span></div></div><h3 id="qUW4Ts6yexpeXppanQXQNL" class="wolai-block"><span class="wolai-serial-number">32.1</span><span class="inline-wrap">修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</span></h3><div id="vA1sMxKX1WBFBBvgvgb8og" class="wolai-block wolai-text"><div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/usr/local/nginx/conf/nginx.conf</code></span><span class="inline-wrap">）。</span></div></div><h3 id="xqJJW9nrhAWrR58DqWXtS5" class="wolai-block"><span class="wolai-serial-number">32.2</span><span class="inline-wrap">添加<span class="jill"></span>WebSocket<span class="jill"></span>相关的配置</span></h3><div id="qLF9vqPPdUxjwfJNGBbzqD" class="wolai-block wolai-text"><div><span class="inline-wrap">在需要支持<span class="jill"></span>WebSocket<span class="jill"></span>的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块或</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块中，添加以下配置：</span></div></div><code-block id="hdWUyPdnrt5BPU2pLpkqkn" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /ws</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend_server</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">"upgrade"</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="2aYcTitvcFDgMjmkwdEyvj" class="wolai-block"><span class="wolai-serial-number">32.3</span><span class="inline-wrap">解释配置项</span></h3><ul class="wolai-block"><li id="5wwrBKkt1GuGrzckBSAjtK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>listen 80;</code></span><span class="inline-wrap">: 监听<span class="jill"></span>80<span class="jill"></span>端口。如果你使用<span class="jill"></span>HTTPS，可以改为</span><span class="inline-wrap"><code>listen 443 ssl;</code></span><span class="inline-wrap">并配置<span class="jill"></span>SSL<span class="jill"></span>证书。</span></li><li id="qoQoTjLHPTtGHFbnmr3jHs"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>server_name yourdomain.com www.yourdomain.com;</code></span><span class="inline-wrap">: 指定服务器名称。</span></li><li id="2pZ8MfvX9jjDsQpYc7vVjM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location /ws { ... }</code></span><span class="inline-wrap">: 定义处理<span class="jill"></span>WebSocket<span class="jill"></span>请求的位置块。在这个例子中，所有以</span><span class="inline-wrap"><code>/ws</code></span><span class="inline-wrap">开头的请求都会被转发到后端服务器。</span></li><li id="xzxzcKVH3ggcBhsE9d7kr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_pass http://backend_server;</code></span><span class="inline-wrap">: 将请求转发到后端服务器。你需要将</span><span class="inline-wrap"><code>backend_server</code></span><span class="inline-wrap">替换为实际的后端服务器地址。</span></li><li id="uoHWwBuuEi4bhRLgampjR9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_http_version 1.1;</code></span><span class="inline-wrap">: 设置<span class="jill"></span>HTTP<span class="jill"></span>版本为<span class="jill"></span>1.1，这是<span class="jill"></span>WebSocket<span class="jill"></span>所需的最低版本。</span></li><li id="o7gG3Z2doac7Uzy2yz5UUq"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_set_header Upgrade $http_upgrade;</code></span><span class="inline-wrap">: 设置</span><span class="inline-wrap"><code>Upgrade</code></span><span class="inline-wrap">头，用于升级连接。</span></li><li id="sSASfuE953vKJHcADL44md"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_set_header Connection &quot;upgrade&quot;;</code></span><span class="inline-wrap">: 设置</span><span class="inline-wrap"><code>Connection</code></span><span class="inline-wrap">头为</span><span class="inline-wrap"><code>upgrade</code></span><span class="inline-wrap">，表示这是一个升级请求。</span></li><li id="9NFKbTb2BBA5NtYmdRKw9Q"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_set_header Host $host;</code></span><span class="inline-wrap">: 保留原始主机头信息。</span></li></ul><h3 id="dEEKpuPU1Qo1zc6wBy5yMb" class="wolai-block"><span class="wolai-serial-number">32.4</span><span class="inline-wrap">重启<span class="jill"></span>Nginx<span class="jill"></span>服务</span></h3><div id="hSSvXGjeVdPceta3D5PNJx" class="wolai-block wolai-text"><div><span class="inline-wrap">保存配置文件后，重启<span class="jill"></span>Nginx<span class="jill"></span>服务以使更改生效。可以使用以下命令：</span></div></div><code-block id="unNbf17HjhiCmB5gs9svSR" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block><div id="t15fVnqYLztU5VeqzTuEHm" class="wolai-block wolai-text"><div><span class="inline-wrap">或者，如果你使用的是较旧的系统，可能需要使用：</span></div></div><code-block id="5QhoYw4WQz2nENow2PctnB" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">service</span> nginx restart</pre></div></code-block><h3 id="gPVfwon9WuSLfqnuhLS1eE" class="wolai-block"><span class="wolai-serial-number">32.5</span><span class="inline-wrap">验证配置</span></h3><div id="rt57wVkQtnhNpYywfgiXUd" class="wolai-block wolai-text"><div><span class="inline-wrap">通过浏览器或工具（如<span class="jill"></span>Postman）发送<span class="jill"></span>WebSocket<span class="jill"></span>请求，检查是否能够成功建立连接。你可以使用<span class="jill"></span>JavaScript<span class="jill"></span>代码来测试<span class="jill"></span>WebSocket<span class="jill"></span>连接：</span></div></div><code-block id="eKZwf9C2uvQFjBAuQfmhj2" class="wolai-block"><div class="wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre><span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://yourdomain.com/ws'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket is open now.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Received message:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket is closed now.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'WebSocket error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre></div></code-block><h3 id="9mAuLwYYZB8nGGR9vdKoX1" class="wolai-block"><span class="wolai-serial-number">32.6</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="cpRobTc8rqsG8DfbZ41B3R"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：确保你的<span class="jill"></span>WebSocket<span class="jill"></span>连接是安全的，特别是在生产环境中。建议使用<span class="jill"></span>WSS（WebSocket over TLS）而不是<span class="jill"></span>WS。</span></li><li id="xtgxbqjQEW5PNb3SN756X"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡</b></span><span class="inline-wrap">：如果你有多个后端服务器，可以使用<span class="jill"></span>Nginx<span class="jill"></span>的负载均衡功能来分发<span class="jill"></span>WebSocket<span class="jill"></span>连接。</span></li><li id="xsvVJssSLQB7EpN2Z1Hz5k"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>超时设置</b></span><span class="inline-wrap">：根据需要调整超时设置，例如</span><span class="inline-wrap"><code>proxy_read_timeout</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>proxy_send_timeout</code></span><span class="inline-wrap">，以确保连接的稳定性。</span></li></ul><div id="jQP5PX2X7GCJthVrWBhY8Y" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置<span class="jill"></span>WebSocket<span class="jill"></span>支持，从而允许客户端与服务器进行实时通信。</span></div></div><div id="53m1BS4c1GYVnPAuySXVZy" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="2shEgV3mcrguz9UjJKou5W" class="wolai-block"><span class="wolai-serial-number">33</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>sub_filter<span class="jill"></span>模块。</span></h1><div id="2VpTL9vA83ij8CjLueaMAn" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap">模块是<span class="jill"></span>Nginx<span class="jill"></span>的一个第三方模块，用于在响应内容中进行字符串替换。它允许你在将响应发送给客户端之前，对响应内容进行动态修改。这个功能对于某些应用场景非常有用，例如：</span></div></div><ul class="wolai-block"><li id="rgYQRBRaf2Lsbf4M2ZER3K"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">替换广告链接或脚本</span></li><li id="xe5Ex4wXWgNQvNGvgiCoXw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">修改页面中的特定文本</span></li><li id="32r9MiMgE75Y8ow87jXdAE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">添加或删除<span class="jill"></span>HTML<span class="jill"></span>元素</span></li></ul><h3 id="a91NcmybP6mNcmT8REnguH" class="wolai-block"><span class="wolai-serial-number">33.1</span><span class="inline-wrap">安装 </span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap"> 模块</span></h3><div id="hJ1qwsjnr9PViynCK9KwEJ" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，你需要确保你的<span class="jill"></span>Nginx<span class="jill"></span>安装了</span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap">模块。大多数现代的<span class="jill"></span>Nginx<span class="jill"></span>发行版已经包含了这个模块，但如果你使用的是自定义编译的<span class="jill"></span>Nginx，可能需要手动编译该模块。</span></div></div><h3 id="tgJQ7hvxbPZ65q9o9Tkkci" class="wolai-block"><span class="wolai-serial-number">33.2</span><span class="inline-wrap">配置 </span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap"> 模块</span></h3><div id="vxXmzU1XRZua9fruVcx9uH" class="wolai-block wolai-text"><div><span class="inline-wrap">以下是如何在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中使用</span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap">模块的示例：</span></div></div><code-block id="mFyJWQPqGVGXdefwCduQio" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend_server</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>

            <span class="token comment"># 启用 sub_filter 模块</span>
            <span class="token directive"><span class="token keyword">sub_filter</span> <span class="token string">'original_text'</span> <span class="token string">'replacement_text'</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">sub_filter_once</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span> <span class="token comment"># 默认情况下，只替换第一次出现的匹配项。设置为off以替换所有匹配项。</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="eUX5STAfj9PJe7hDXuJeSP" class="wolai-block"><span class="wolai-serial-number">33.3</span><span class="inline-wrap">解释配置项</span></h3><ul class="wolai-block"><li id="kGc5itzK2jk37jbAA3RGps"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_pass http://backend_server;</code></span><span class="inline-wrap">: 将请求转发到后端服务器。你需要将</span><span class="inline-wrap"><code>backend_server</code></span><span class="inline-wrap">替换为实际的后端服务器地址。</span></li><li id="bqeU65mEYDLoSBUX4u8XUL"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_set_header Host $host;</code></span><span class="inline-wrap">: 保留原始主机头信息。</span></li><li id="fuXKVaQiEW4babAF7Wue8P"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_set_header X-Real-IP $remote_addr;</code></span><span class="inline-wrap">: 设置<span class="jill"></span>X-Real-IP<span class="jill"></span>头，以便后端服务器知道客户端的真实<span class="jill"></span>IP<span class="jill"></span>地址。</span></li><li id="uTJA9Xo5JmhfGXWQj6bY3B"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</code></span><span class="inline-wrap">: 设置<span class="jill"></span>X-Forwarded-For<span class="jill"></span>头，以便后端服务器知道客户端的原始<span class="jill"></span>IP<span class="jill"></span>地址和代理服务器的<span class="jill"></span>IP<span class="jill"></span>地址。</span></li><li id="oqnux186oJXpq58kq4aVG6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_set_header X-Forwarded-Proto $scheme;</code></span><span class="inline-wrap">: 设置<span class="jill"></span>X-Forwarded-Proto<span class="jill"></span>头，以便后端服务器知道客户端使用的协议（HTTP<span class="jill"></span>或<span class="jill"></span>HTTPS）。</span></li><li id="3ekbTE1hm4DE6cipsVCUQx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>sub_filter &#39;original_text&#39; &#39;replacement_text&#39;;</code></span><span class="inline-wrap">: 将响应内容中的</span><span class="inline-wrap"><code>original_text</code></span><span class="inline-wrap">替换为</span><span class="inline-wrap"><code>replacement_text</code></span><span class="inline-wrap">。你可以根据需要添加多个</span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap">指令来替换不同的文本。</span></li><li id="rQ8dzdf4C3kuvu3nvVvQEF"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>sub_filter_once off;</code></span><span class="inline-wrap">: 默认情况下，</span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap">只替换第一次出现的匹配项。将</span><span class="inline-wrap"><code>sub_filter_once</code></span><span class="inline-wrap">设置为</span><span class="inline-wrap"><code>off</code></span><span class="inline-wrap">可以替换所有匹配项。</span></li></ul><h3 id="gb9A1YhXjsyEVrDaZ8uWuJ" class="wolai-block"><span class="wolai-serial-number">33.4</span><span class="inline-wrap">使用场景示例</span></h3><div id="tAYjyKpCYtYjvUfE1dRSdG" class="wolai-block wolai-text"><div><span class="inline-wrap">假设你有一个网页，其中包含一个广告链接，你想将其替换为另一个链接。你可以这样配置：</span></div></div><code-block id="fKfmCUNsRTUKnHYTtHtCoH" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend_server</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>

            <span class="token comment"># 替换广告链接</span>
            <span class="token directive"><span class="token keyword">sub_filter</span> <span class="token string">'http://adserver.com/ad123'</span> <span class="token string">'http://newadserver.com/ad456'</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">sub_filter_once</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span> <span class="token comment"># 替换所有匹配项</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="hRUFHYQoVNv6d9kEmf3Zac" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个例子中，所有响应内容中的</span><span class="inline-wrap"><code>http://adserver.com/ad123</code></span><span class="inline-wrap">都会被替换为</span><span class="inline-wrap"><code>http://newadserver.com/ad456</code></span><span class="inline-wrap">。</span></div></div><h3 id="4qpKp3NVaa6BsUFr8yVWjR" class="wolai-block"><span class="wolai-serial-number">33.5</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="drWNoGqFR7smFJPYE3pn28"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>性能影响</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap">模块会对每个响应进行字符串替换操作，可能会对性能产生一定影响，特别是在高流量环境下。因此，建议仅在必要时使用该模块。</span></li><li id="3QjdkCKE1SRRVpG9eW57DM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：确保你替换的内容不会引入安全漏洞，例如跨站脚本攻击（XSS）。</span></li><li id="qaFw3jzip1dxpkBBqMEtGy"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>兼容性</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap">模块在某些情况下可能无法正确处理二进制数据或非文本内容，因此在使用时需要谨慎测试。</span></li></ul><div id="hF2wP4aWed4t4o4h2dNQRs" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置</span><span class="inline-wrap"><code>sub_filter</code></span><span class="inline-wrap">模块，从而动态修改响应内容。</span></div></div><div id="hXxY28ZPWYEAomT7gjNpdc" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="2aHHuUk25WwDwXBN6YxPso" class="wolai-block"><span class="wolai-serial-number">34</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>FastCGI？</span></h1><div id="sT7g9LxPi6hXWTRFcynQt1" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>FastCGI（通常用于处理<span class="jill"></span>PHP<span class="jill"></span>等动态内容）需要一些特定的设置。以下是详细的步骤和示例：</span></div></div><h3 id="q6sVHiLcrfEdNj3E8LhBTb" class="wolai-block"><span class="wolai-serial-number">34.1</span><span class="inline-wrap">安装必要的软件包</span></h3><div id="hPDpSP1k6yVzXv37EJsNYd" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，确保你已经安装了<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>PHP-FPM（FastCGI Process Manager）。你可以使用以下命令来安装它们：</span></div></div><code-block id="eiHKMPWqUNLNoojbXf42Qe" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx php-fpm</pre></div></code-block><h3 id="73RecBpXqnkzCPZtN22RgR" class="wolai-block"><span class="wolai-serial-number">34.2</span><span class="inline-wrap">修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</span></h3><div id="7sAq3gNSvYr9HqAXvpsStj" class="wolai-block wolai-text"><div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/etc/nginx/sites-available/default</code></span><span class="inline-wrap">）。</span></div></div><h3 id="tUzPE4WM7aqntb15N5MnLL" class="wolai-block"><span class="wolai-serial-number">34.3</span><span class="inline-wrap">添加<span class="jill"></span>FastCGI<span class="jill"></span>相关的配置</span></h3><div id="aFPfrNjiC2wPPSSSbC5KUd" class="wolai-block wolai-text"><div><span class="inline-wrap">在需要支持<span class="jill"></span>FastCGI<span class="jill"></span>的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块或</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块中，添加以下配置：</span></div></div><code-block id="4q2FmSdzisBEdmRBNDc8DC" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ =404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">include</span> snippets/fastcgi-php.conf</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">fastcgi_pass</span> unix:/run/php/php7.4-fpm.sock</span><span class="token punctuation">;</span> <span class="token comment"># 根据你的PHP版本调整路径</span>
        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">include</span> fastcgi_params</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ /\.ht</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="kWGV1MuJbm9PyUgXDVDwXm" class="wolai-block"><span class="wolai-serial-number">34.4</span><span class="inline-wrap">解释配置项</span></h3><ul class="wolai-block"><li id="3LgbZ77ydC9XrxRHF84FXQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>listen 80;</code></span><span class="inline-wrap">: 监听<span class="jill"></span>80<span class="jill"></span>端口。</span></li><li id="fYsZZR3nikxHonY3SPTHCM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>server_name yourdomain.com www.yourdomain.com;</code></span><span class="inline-wrap">: 定义服务器名称。</span></li><li id="dZabzFtGj1aJuwvjk89nY8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>root /var/www/html;</code></span><span class="inline-wrap">: 设置网站根目录。</span></li><li id="iyBUij4vr2ScUxbJkRzSdE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>index index.php index.html index.htm;</code></span><span class="inline-wrap">: 定义默认索引文件。</span></li><li id="vuMvL1zKsHcsLwTD3A5wDg"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location / { try_files $uri $uri/ =404; }</code></span><span class="inline-wrap">: 尝试访问请求的文件或目录，如果不存在则返回<span class="jill"></span>404<span class="jill"></span>错误。</span></li><li id="ceFmRX4MJcvHD5RdJ2MYWV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location ~ \.php$ { ... }</code></span><span class="inline-wrap">: 匹配所有以</span><span class="inline-wrap"><code>.php</code></span><span class="inline-wrap">结尾的请求。</span><ul class="wolai-block"><li id="egBz8UFJGQZsYTP3ZXn627"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>include snippets/fastcgi-php.conf;</code></span><span class="inline-wrap">: 包含<span class="jill"></span>FastCGI PHP<span class="jill"></span>配置片段。</span></li><li id="ePVkA73xZX2ezPXnSfdSjv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>fastcgi_pass unix:/run/php/php7.4-fpm.sock;</code></span><span class="inline-wrap">: 指定<span class="jill"></span>FastCGI<span class="jill"></span>进程管理器的<span class="jill"></span>Unix<span class="jill"></span>套接字路径。请根据你的<span class="jill"></span>PHP<span class="jill"></span>版本调整路径。</span></li><li id="8wGkMTqE9Xh9qJss3949i7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</code></span><span class="inline-wrap">: 设置脚本文件名参数。</span></li><li id="9fcH7bG5bD6ZhVLHwDcsik"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>include fastcgi_params;</code></span><span class="inline-wrap">: 包含<span class="jill"></span>FastCGI<span class="jill"></span>参数文件。</span></li></ul></li><li id="oG6j6nAbw5LVwNAf4PDCPU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location ~ /\.ht { deny all; }</code></span><span class="inline-wrap">: 禁止访问以</span><span class="inline-wrap"><code>.ht</code></span><span class="inline-wrap">开头的文件和目录。</span></li></ul><h3 id="qzk4MGKSk9BAco5oj854uN" class="wolai-block"><span class="wolai-serial-number">34.5</span><span class="inline-wrap">重启<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>PHP-FPM<span class="jill"></span>服务</span></h3><div id="iFwNoxayHFHifvt8uKbg2t" class="wolai-block wolai-text"><div><span class="inline-wrap">完成配置后，重启<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>PHP-FPM<span class="jill"></span>服务以应用更改：</span></div></div><code-block id="fxG7DckPdfM8AL811S5haH" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx
<span class="token function">sudo</span> systemctl restart php7.4-fpm <span class="token comment"># 根据你使用的PHP版本调整命令</span></pre></div></code-block><h3 id="2XqR2dUSFn6Ui4v7B8uFFt" class="wolai-block"><span class="wolai-serial-number">34.6</span><span class="inline-wrap">测试配置</span></h3><div id="iihbPyuPhybCJFhXyNnCFZ" class="wolai-block wolai-text"><div><span class="inline-wrap">创建一个<span class="jill"></span>PHP<span class="jill"></span>文件来测试你的配置，例如在</span><span class="inline-wrap"><code>/var/www/html</code></span><span class="inline-wrap">目录下创建一个名为</span><span class="inline-wrap"><code>info.php</code></span><span class="inline-wrap">的文件，内容如下：</span></div></div><code-block id="8S3Dc2g26kEzLosBXTsTnP" class="wolai-block"><div class="wolai-pre"><div data-lang="PHP" class="marker"></div><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></pre></div></code-block><div id="fwYDMvD84JFJa9dNuEc4aX" class="wolai-block wolai-text"><div><span class="inline-wrap">然后在浏览器中访问</span><span class="inline-wrap"><code>http://yourdomain.com/info.php</code></span><span class="inline-wrap">，你应该能够看到<span class="jill"></span>PHP<span class="jill"></span>信息页面，这表明<span class="jill"></span>FastCGI<span class="jill"></span>配置成功。</span></div></div><h3 id="bzSWwrpjZ1BTQ4a9iourfQ" class="wolai-block"><span class="wolai-serial-number">34.7</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="izujxxzEecoEggtvUptfo9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>性能优化</b></span><span class="inline-wrap">：根据需要调整<span class="jill"></span>FastCGI<span class="jill"></span>缓存和其他性能相关设置。</span></li><li id="Bex2PhK1fsqWMV74Rh3QL"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：确保你的<span class="jill"></span>PHP<span class="jill"></span>配置安全，避免暴露敏感信息。</span></li><li id="jaXqLMBrX97KbGktpeGZ1g"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>日志监控</b></span><span class="inline-wrap">：定期检查<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>PHP-FPM<span class="jill"></span>的日志文件，以便及时发现和解决问题。</span></li></ul><div id="qAN3PgcsEi1wSKaAj3gCzL" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置<span class="jill"></span>FastCGI，从而处理<span class="jill"></span>PHP<span class="jill"></span>等动态内容。</span></div></div><div id="LHdpkLLsWki7VYqyi5wBo" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="ptnvF6wTK6GscaQugCchnZ" class="wolai-block"><span class="wolai-serial-number">35</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>PHP-FPM？</span></h1><div id="rNTmgChH8u3qTzaQRf1N6N" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>PHP-FPM（FastCGI Process Manager）是处理<span class="jill"></span>PHP<span class="jill"></span>动态内容的标准方法。以下是详细的步骤和示例：</span></div></div><h3 id="6frvj6mseusfvPyqvwqPgV" class="wolai-block"><span class="wolai-serial-number">35.1</span><span class="inline-wrap">安装必要的软件包</span></h3><div id="ezdUbsKTnchJu92ks4goe3" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，确保你已经安装了<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>PHP-FPM。你可以使用以下命令来安装它们：</span></div></div><code-block id="vT8weUq3kKFr75M3wwzKmy" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx php-fpm</pre></div></code-block><h3 id="e44sBrp3DBJWiUHHb66w9B" class="wolai-block"><span class="wolai-serial-number">35.2</span><span class="inline-wrap">修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</span></h3><div id="gTVdgTMbUeqPJK3xXkPKPL" class="wolai-block wolai-text"><div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/etc/nginx/sites-available/default</code></span><span class="inline-wrap">）。</span></div></div><h3 id="bsztRRUNH8P2iLGT9vu136" class="wolai-block"><span class="wolai-serial-number">35.3</span><span class="inline-wrap">添加<span class="jill"></span>PHP-FPM<span class="jill"></span>相关的配置</span></h3><div id="xo6MZb4HbxuPbMprmR3Q5s" class="wolai-block wolai-text"><div><span class="inline-wrap">在需要支持<span class="jill"></span>PHP-FPM<span class="jill"></span>的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块或</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块中，添加以下配置：</span></div></div><code-block id="tMyD69pSFAshStg6zPSa8s" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span> index.php index.html index.htm</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ =404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">include</span> snippets/fastcgi-php.conf</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">fastcgi_pass</span> unix:/run/php/php7.4-fpm.sock</span><span class="token punctuation">;</span> <span class="token comment"># 根据你的PHP版本调整路径</span>
        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">include</span> fastcgi_params</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ /\.ht</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="3D6n9BtkdGrHNDg7HnPCGq" class="wolai-block"><span class="wolai-serial-number">35.4</span><span class="inline-wrap">解释配置项</span></h3><ul class="wolai-block"><li id="nggAeDtTNnvizw7vsiaB5C"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>listen 80;</code></span><span class="inline-wrap">: 监听<span class="jill"></span>80<span class="jill"></span>端口。</span></li><li id="jgNhfsgkh95gstoyoBy7Gi"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>server_name yourdomain.com www.yourdomain.com;</code></span><span class="inline-wrap">: 定义服务器名称。</span></li><li id="hBsYjSy7WQfkHUTSaszc9B"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>root /var/www/html;</code></span><span class="inline-wrap">: 设置网站根目录。</span></li><li id="h9NA4DuS6dkmdCHWLVn2WD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>index index.php index.html index.htm;</code></span><span class="inline-wrap">: 定义默认索引文件。</span></li><li id="eUJN9wzg6on8yCmu9E6Wzd"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location / { try_files $uri $uri/ =404; }</code></span><span class="inline-wrap">: 尝试访问请求的文件或目录，如果不存在则返回<span class="jill"></span>404<span class="jill"></span>错误。</span></li><li id="b3q6TkohrpjiAWEc4raVga"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location ~ \.php$ { ... }</code></span><span class="inline-wrap">: 匹配所有以</span><span class="inline-wrap"><code>.php</code></span><span class="inline-wrap">结尾的请求。</span><ul class="wolai-block"><li id="eDHHEi3htjpQMrLKfUZJVQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>include snippets/fastcgi-php.conf;</code></span><span class="inline-wrap">: 包含<span class="jill"></span>FastCGI PHP<span class="jill"></span>配置片段。</span></li><li id="dYK6aRheqeBSCrk4WECiHx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>fastcgi_pass unix:/run/php/php7.4-fpm.sock;</code></span><span class="inline-wrap">: 指定<span class="jill"></span>FastCGI<span class="jill"></span>进程管理器的<span class="jill"></span>Unix<span class="jill"></span>套接字路径。请根据你的<span class="jill"></span>PHP<span class="jill"></span>版本调整路径。例如，对于<span class="jill"></span>PHP 7.4，路径通常是</span><span class="inline-wrap"><code>/run/php/php7.4-fpm.sock</code></span><span class="inline-wrap">。</span></li><li id="tJTg9wBUZYurTnMKBXViRk"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</code></span><span class="inline-wrap">: 设置脚本文件名参数。</span></li><li id="js76vPm2roG8CDAfVMBDQR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>include fastcgi_params;</code></span><span class="inline-wrap">: 包含<span class="jill"></span>FastCGI<span class="jill"></span>参数文件。</span></li></ul></li><li id="38ChY4stJgu2ENTaSoSCof"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location ~ /\.ht { deny all; }</code></span><span class="inline-wrap">: 禁止访问以</span><span class="inline-wrap"><code>.ht</code></span><span class="inline-wrap">开头的文件和目录。</span></li></ul><h3 id="kQujgm1zWNgPcHSrECiguU" class="wolai-block"><span class="wolai-serial-number">35.5</span><span class="inline-wrap">重启<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>PHP-FPM<span class="jill"></span>服务</span></h3><div id="3wfmrK1PSb9dsrqF1z4oCh" class="wolai-block wolai-text"><div><span class="inline-wrap">完成配置后，重启<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>PHP-FPM<span class="jill"></span>服务以应用更改：</span></div></div><code-block id="8KAuz2kstkLip5VAMzAQNW" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx
<span class="token function">sudo</span> systemctl restart php7.4-fpm <span class="token comment"># 根据你使用的PHP版本调整命令</span></pre></div></code-block><h3 id="9XpoY5i37fdiSCEqQKyk8i" class="wolai-block"><span class="wolai-serial-number">35.6</span><span class="inline-wrap">测试配置</span></h3><div id="x1K9g5kQqM9JQ8mjF5hfDz" class="wolai-block wolai-text"><div><span class="inline-wrap">创建一个<span class="jill"></span>PHP<span class="jill"></span>文件来测试你的配置，例如在</span><span class="inline-wrap"><code>/var/www/html</code></span><span class="inline-wrap">目录下创建一个名为</span><span class="inline-wrap"><code>info.php</code></span><span class="inline-wrap">的文件，内容如下：</span></div></div><code-block id="52MQT8qu1khjUTStc7MizZ" class="wolai-block"><div class="wolai-pre"><div data-lang="PHP" class="marker"></div><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span></pre></div></code-block><div id="sCvgunbFXwRftjAVPFiXW" class="wolai-block wolai-text"><div><span class="inline-wrap">然后在浏览器中访问</span><span class="inline-wrap"><code>http://yourdomain.com/info.php</code></span><span class="inline-wrap">，你应该能够看到<span class="jill"></span>PHP<span class="jill"></span>信息页面，这表明<span class="jill"></span>PHP-FPM<span class="jill"></span>配置成功。</span></div></div><h3 id="pyfxc5rbrH3Q1uxqRQLT1Y" class="wolai-block"><span class="wolai-serial-number">35.7</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="fcGTznzNNH8oKWsWiDG9T8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>性能优化</b></span><span class="inline-wrap">：根据需要调整<span class="jill"></span>FastCGI<span class="jill"></span>缓存和其他性能相关设置。</span></li><li id="r7jCXjNDSXpDAazST8mkJB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：确保你的<span class="jill"></span>PHP<span class="jill"></span>配置安全，避免暴露敏感信息。</span></li><li id="5Y1JtVaReaQ5YP5yTv6Xo2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>日志监控</b></span><span class="inline-wrap">：定期检查<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>PHP-FPM<span class="jill"></span>的日志文件，以便及时发现和解决问题。</span></li><li id="bGkSfASfnevP2SSyCiDdeG"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>SSL/TLS</b></span><span class="inline-wrap">：如果你的网站需要处理<span class="jill"></span>HTTPS<span class="jill"></span>请求，请确保配置<span class="jill"></span>SSL<span class="jill"></span>证书并启用<span class="jill"></span>HTTPS。</span></li></ul><div id="gE7b3w3L8nzcsNsXv6n8mo" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置<span class="jill"></span>PHP-FPM，从而处理<span class="jill"></span>PHP<span class="jill"></span>等动态内容。</span></div></div><div id="pp6q2fDqoAJSxphXgNd38X" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="3TbfoEpMSS3Nig9fFeSs7s" class="wolai-block"><span class="wolai-serial-number">36</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>uWSGI？</span></h1><div id="sC6JYTueWG73dL3Yorb5NG" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置<span class="jill"></span>uWSGI（Uniform Web Server Gateway Interface）是处理<span class="jill"></span>Python<span class="jill"></span>等动态内容的标准方法。以下是详细的步骤和示例：</span></div></div><h3 id="miPaYAaQeXUAu5cuDFJPNC" class="wolai-block"><span class="wolai-serial-number">36.1</span><span class="inline-wrap">安装必要的软件包</span></h3><div id="5H13eB8kroC5fCHBmAhAxR" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，确保你已经安装了<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>uWSGI。你可以使用以下命令来安装它们：</span></div></div><code-block id="w3kcNcZSGS3Bcaz8rRpFx8" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx uwsgi uwsgi-plugin-python3</pre></div></code-block><h3 id="39xfX1Q8bJ6RSyBVh1aDVo" class="wolai-block"><span class="wolai-serial-number">36.2</span><span class="inline-wrap">创建<span class="jill"></span>uWSGI<span class="jill"></span>配置文件</span></h3><div id="jWEKiiiqfdRTcNnDaHC5dD" class="wolai-block wolai-text"><div><span class="inline-wrap">创建一个<span class="jill"></span>uWSGI<span class="jill"></span>配置文件，例如</span><span class="inline-wrap"><code>/etc/uwsgi/apps-available/yourdomain.ini</code></span><span class="inline-wrap">，内容如下：</span></div></div><code-block id="tFw8fZr88a54U4Tm9Sjyig" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">uwsgi</span><span class="token punctuation">]</span></span>
<span class="token comment"># 指定项目目录</span>
<span class="token key attr-name">chdir</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/www/html/yourproject</span>

<span class="token comment"># 指定项目的入口文件</span>
<span class="token key attr-name">module</span> <span class="token punctuation">=</span> <span class="token value attr-value">wsgi:application</span>

<span class="token comment"># 指定虚拟环境路径（如果有的话）</span>
<span class="token key attr-name">home</span> <span class="token punctuation">=</span> <span class="token value attr-value">/path/to/your/virtualenv</span>

<span class="token comment"># 指定socket文件路径</span>
<span class="token key attr-name">socket</span> <span class="token punctuation">=</span> <span class="token value attr-value">/run/uwsgi/yourdomain.sock</span>

<span class="token comment"># 设置权限</span>
<span class="token key attr-name">chmod-socket</span> <span class="token punctuation">=</span> <span class="token value attr-value">660</span>

<span class="token comment"># 设置进程数和线程数</span>
<span class="token key attr-name">processes</span> <span class="token punctuation">=</span> <span class="token value attr-value">4</span>
<span class="token key attr-name">threads</span> <span class="token punctuation">=</span> <span class="token value attr-value">2</span>

<span class="token comment"># 设置日志文件路径</span>
<span class="token key attr-name">logto</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/log/uwsgi/yourdomain.log</span></pre></div></code-block><h3 id="7A9TUqsrfvuX5JKS4b8fvg" class="wolai-block"><span class="wolai-serial-number">36.3</span><span class="inline-wrap">启用<span class="jill"></span>uWSGI<span class="jill"></span>配置</span></h3><div id="6UgvH6U1LaQkFco8aXkDpg" class="wolai-block wolai-text"><div><span class="inline-wrap">将<span class="jill"></span>uWSGI<span class="jill"></span>配置文件链接到</span><span class="inline-wrap"><code>apps-enabled</code></span><span class="inline-wrap">目录：</span></div></div><code-block id="4m1Harveb2hHACgNzsgVxm" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /etc/uwsgi/apps-available/yourdomain.ini /etc/uwsgi/apps-enabled/</pre></div></code-block><h3 id="kkkS6LLQ1iTfzVHSWAZSo8" class="wolai-block"><span class="wolai-serial-number">36.4</span><span class="inline-wrap">修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</span></h3><div id="cAiEoSD7pZQzgfrvzRjtSe" class="wolai-block wolai-text"><div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/etc/nginx/sites-available/default</code></span><span class="inline-wrap">）。</span></div></div><div id="qdZCa2nWpqnLRpYHEEPQ7b" class="wolai-block wolai-text"><div><span class="inline-wrap">在需要支持<span class="jill"></span>uWSGI<span class="jill"></span>的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块或</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块中，添加以下配置：</span></div></div><code-block id="a6xZtJYHJohVPy6i3J6JmA" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ =404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">include</span> uwsgi_params</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">uwsgi_pass</span> unix:/run/uwsgi/yourdomain.sock</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ /\.ht</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="oiddNTDQnzSErN5N3ShZrN" class="wolai-block"><span class="wolai-serial-number">36.5</span><span class="inline-wrap">解释配置项</span></h3><ul class="wolai-block"><li id="sB8SCGnJmUuyN4hmY6gMAE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>listen 80;</code></span><span class="inline-wrap">: 监听<span class="jill"></span>80<span class="jill"></span>端口。</span></li><li id="6H7mmEbX2p3j3SXsffvrD4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>server_name yourdomain.com www.yourdomain.com;</code></span><span class="inline-wrap">: 定义服务器名称。</span></li><li id="zqb4EQpN4WJ3L1ecVLdEe"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>root /var/www/html;</code></span><span class="inline-wrap">: 设置网站根目录。</span></li><li id="e2hZmdPEjNqmpfQ9mAdK1z"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>index index.html index.htm;</code></span><span class="inline-wrap">: 定义默认索引文件。</span></li><li id="pH6i1Ca8fsV6ucLKbsMav7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location / { try_files $uri $uri/ =404; }</code></span><span class="inline-wrap">: 尝试访问请求的文件或目录，如果不存在则返回<span class="jill"></span>404<span class="jill"></span>错误。</span></li><li id="bcKTYW3buTSq3GwxbDveJW"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location / { ... }</code></span><span class="inline-wrap">: 匹配所有请求。</span><ul class="wolai-block"><li id="3kr9hGQwSJgZ8VzrhsMJxx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>include uwsgi_params;</code></span><span class="inline-wrap">: 包含<span class="jill"></span>uWSGI<span class="jill"></span>参数文件。</span></li><li id="wSK4ChPo2XVuZQe6D44ChC"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>uwsgi_pass unix:/run/uwsgi/yourdomain.sock;</code></span><span class="inline-wrap">: 指定<span class="jill"></span>uWSGI<span class="jill"></span>进程管理器的<span class="jill"></span>Unix<span class="jill"></span>套接字路径。请根据你的<span class="jill"></span>uWSGI<span class="jill"></span>配置调整路径。</span></li></ul></li><li id="dtXEweXStnrQmtc5Z6uzeW"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location ~ /\.ht { deny all; }</code></span><span class="inline-wrap">: 禁止访问以</span><span class="inline-wrap"><code>.ht</code></span><span class="inline-wrap">开头的文件和目录。</span></li></ul><h3 id="jzqwxqmoZTFa3caSTy7soM" class="wolai-block"><span class="wolai-serial-number">36.6</span><span class="inline-wrap">重启<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>uWSGI<span class="jill"></span>服务</span></h3><div id="ny6osRm36hPaUbWhDdukky" class="wolai-block wolai-text"><div><span class="inline-wrap">完成配置后，重启<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>uWSGI<span class="jill"></span>服务以应用更改：</span></div></div><code-block id="xguGk7hgUexm94knm8Quz6" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx
<span class="token function">sudo</span> systemctl restart uwsgi</pre></div></code-block><h3 id="a4ZbRbuYPaxUjY4iYoXuZz" class="wolai-block"><span class="wolai-serial-number">36.7</span><span class="inline-wrap">测试配置</span></h3><div id="t55F51HTSKjH4yvVdepuEP" class="wolai-block wolai-text"><div><span class="inline-wrap">创建一个<span class="jill"></span>Python<span class="jill"></span>文件来测试你的配置，例如在</span><span class="inline-wrap"><code>/var/www/html/yourproject</code></span><span class="inline-wrap">目录下创建一个名为</span><span class="inline-wrap"><code>wsgi.py</code></span><span class="inline-wrap">的文件，内容如下：</span></div></div><code-block id="vPz8QbhFNCFc7Y8bzQkd53" class="wolai-block"><div class="wolai-pre"><div data-lang="Python" class="marker"></div><pre><span class="token keyword">def</span> <span class="token function">application</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    status <span class="token operator">=</span> <span class="token string">'200 OK'</span>
    output <span class="token operator">=</span> <span class="token string">b'Hello World!'</span>

    response_headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    start_response<span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">[</span>output<span class="token punctuation">]</span></pre></div></code-block><div id="mAHsvhssWifdHYEGJicCGt" class="wolai-block wolai-text"><div><span class="inline-wrap">然后在浏览器中访问</span><span class="inline-wrap"><code>http://yourdomain.com</code></span><span class="inline-wrap">，你应该能够看到“Hello World!”页面，这表明<span class="jill"></span>uWSGI<span class="jill"></span>配置成功。</span></div></div><h3 id="esbYWZCCgTJE8dP4w3udMX" class="wolai-block"><span class="wolai-serial-number">36.8</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="pGVF8QYhrmKRSgAwDJ9nrM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>性能优化</b></span><span class="inline-wrap">：根据需要调整<span class="jill"></span>uWSGI<span class="jill"></span>缓存和其他性能相关设置。</span></li><li id="gpUwPsWUy7EyMgtinUZxEe"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：确保你的<span class="jill"></span>uWSGI<span class="jill"></span>配置安全，避免暴露敏感信息。</span></li><li id="66LjLp99AM2LSXtqMC9GSD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>日志监控</b></span><span class="inline-wrap">：定期检查<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>uWSGI<span class="jill"></span>的日志文件，以便及时发现和解决问题。</span></li><li id="x8qXpMMnZ3v212mftaa9U8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>SSL/TLS</b></span><span class="inline-wrap">：如果你的网站需要处理<span class="jill"></span>HTTPS<span class="jill"></span>请求，请确保配置<span class="jill"></span>SSL<span class="jill"></span>证书并启用<span class="jill"></span>HTTPS。</span></li></ul><div id="9Wo2obth9CQZo2UDpkG2wG" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置<span class="jill"></span>uWSGI，从而处理<span class="jill"></span>Python<span class="jill"></span>等动态内容。</span></div></div><div id="nsSK723kHs2wJQa4VT8yQr" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="wXEwUpCNENNZpXWVBgk1w2" class="wolai-block"><span class="wolai-serial-number">37</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>http2<span class="jill"></span>模块。</span></h1><div id="98iJWBTZxMbiyqcoi7e15j" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>中的<span class="jill"></span>HTTP/2<span class="jill"></span>模块允许<span class="jill"></span>Nginx<span class="jill"></span>服务器支持<span class="jill"></span>HTTP/2<span class="jill"></span>协议，这是<span class="jill"></span>HTTP<span class="jill"></span>协议的第二个主要版本，旨在提高网页加载速度和性能。HTTP/2<span class="jill"></span>引入了多项改进，包括多路复用、头部压缩和服务器推送等特性。</span></div></div><h3 id="3LwvJb9NTcmiF6Wf3bRp1f" class="wolai-block"><span class="wolai-serial-number">37.1</span><span class="inline-wrap">HTTP/2<span class="jill"></span>的主要特性</span></h3><ol class="wolai-block"><li id="tBqwuza8SZ3GwHbMbr4HS5"><div class="marker"></div><span class="inline-wrap"><b>多路复用（Multiplexing）</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="iwcRqffY8QFfrW9WT7Ueth"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">在<span class="jill"></span>HTTP/1.x<span class="jill"></span>中，每个请求都需要单独的<span class="jill"></span>TCP<span class="jill"></span>连接，这会导致大量的开销和延迟。HTTP/2<span class="jill"></span>允许多个请求和响应在同一个<span class="jill"></span>TCP<span class="jill"></span>连接上并行进行，从而减少了延迟和提高了效率。</span></li></ul></li><li id="k7BMcAJKZCNCcirdLmMQYA"><div class="marker"></div><span class="inline-wrap"><b>头部压缩（Header Compression）</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="7oPubUWLjjyJCEvKTfvRXa"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">HTTP/2<span class="jill"></span>使用<span class="jill"></span>HPACK<span class="jill"></span>算法对<span class="jill"></span>HTTP<span class="jill"></span>头部进行压缩，从而减少了传输的数据量。这对于包含大量重复头部信息的请求特别有用。</span></li></ul></li><li id="9mrxyNbv6mALDJ6wA6qkGE"><div class="marker"></div><span class="inline-wrap"><b>服务器推送（Server Push）</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="b9gioWECFy1edPP2ow3haJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">服务器可以在客户端请求之前主动发送资源，例如<span class="jill"></span>CSS<span class="jill"></span>文件、JavaScript<span class="jill"></span>文件或图像。这可以减少页面加载时间，因为浏览器不需要等待额外的请求来获取这些资源。</span></li></ul></li><li id="cCJe6PADdgdm6NqA6cPmYP"><div class="marker"></div><span class="inline-wrap"><b>二进制分帧（Binary Framing）</b></span><span class="inline-wrap">：</span><ul class="wolai-block"><li id="8pibB8u6GrKEwb7BSQu7Um"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">HTTP/2<span class="jill"></span>使用二进制格式而不是文本格式，这使得解析更加高效，并且更容易实现多路复用。</span></li></ul></li></ol><h3 id="rEodxxseyWiSGhvm22wjgU" class="wolai-block"><span class="wolai-serial-number">37.2</span><span class="inline-wrap">Nginx<span class="jill"></span>中的<span class="jill"></span>HTTP/2<span class="jill"></span>配置</span></h3><div id="27oEPyUf2shwT6Ktw7SeTE" class="wolai-block wolai-text"><div><span class="inline-wrap">要在<span class="jill"></span>Nginx<span class="jill"></span>中启用<span class="jill"></span>HTTP/2，你需要确保你的<span class="jill"></span>Nginx<span class="jill"></span>版本支持<span class="jill"></span>HTTP/2（Nginx 1.9.5<span class="jill"></span>及以上版本支持）。然后，你可以在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中进行相应的设置。</span></div></div><h4 id="hMowUkUBYUtZjXcrSPNstL" class="wolai-block"><span class="wolai-serial-number">37.2.1</span><span class="inline-wrap">基本配置示例</span></h4><code-block id="r1N5CtkVxifUFpEjP2C58k" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /path/to/your/certificate.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /path/to/your/private.key</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ =404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="jqUzybaTggJxqPTKPgAtde" class="wolai-block"><span class="wolai-serial-number">37.3</span><span class="inline-wrap">解释配置项</span></h3><ul class="wolai-block"><li id="imUcjBFDPAzcxf2xzHPqid"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>listen 443 ssl http2;</code></span><span class="inline-wrap">: 监听<span class="jill"></span>443<span class="jill"></span>端口并启用<span class="jill"></span>SSL<span class="jill"></span>和<span class="jill"></span>HTTP/2。</span></li><li id="gYtszYxL9gTXRaqdPmyudb"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>server_name yourdomain.com www.yourdomain.com;</code></span><span class="inline-wrap">: 定义服务器名称。</span></li><li id="5kVqn4R2bXtsxFah1ci2iD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ssl_certificate /path/to/your/certificate.crt;</code></span><span class="inline-wrap">: 指定<span class="jill"></span>SSL<span class="jill"></span>证书路径。</span></li><li id="pee8NUcTANSFaYg7F83iz7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ssl_certificate_key /path/to/your/private.key;</code></span><span class="inline-wrap">: 指定<span class="jill"></span>SSL<span class="jill"></span>私钥路径。</span></li><li id="8cdD1qSdXNmngxreucGoHE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>root /var/www/html;</code></span><span class="inline-wrap">: 设置网站根目录。</span></li><li id="r47D7n9dwSB9BQYNN37nvj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>index index.html index.htm;</code></span><span class="inline-wrap">: 定义默认索引文件。</span></li><li id="iWNHdCtsVAmJq9gKNmuMge"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>location / { try_files $uri $uri/ =404; }</code></span><span class="inline-wrap">: 尝试访问请求的文件或目录，如果不存在则返回<span class="jill"></span>404<span class="jill"></span>错误。</span></li></ul><h3 id="bpbRt3QoEq38WVYbaguQSQ" class="wolai-block"><span class="wolai-serial-number">37.4</span><span class="inline-wrap">优化<span class="jill"></span>HTTP/2<span class="jill"></span>性能</span></h3><div id="pmWFSkVPwrZ8rVFCZGny5H" class="wolai-block wolai-text"><div><span class="inline-wrap">为了进一步优化<span class="jill"></span>HTTP/2<span class="jill"></span>的性能，你可以调整一些<span class="jill"></span>Nginx<span class="jill"></span>的配置参数：</span></div></div><code-block id="ar7wVK4E5HebMiXxBoJiUn" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 启用HTTP/2</span>
    <span class="token directive"><span class="token keyword">http2</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 设置最大并发流数</span>
    <span class="token directive"><span class="token keyword">http2_max_concurrent_streams</span> <span class="token number">128</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 设置初始窗口大小</span>
    <span class="token directive"><span class="token keyword">http2_initial_window_size</span> <span class="token number">65535</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 设置最大帧大小</span>
    <span class="token directive"><span class="token keyword">http2_max_frame_size</span> <span class="token number">16384</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 设置头部表大小</span>
    <span class="token directive"><span class="token keyword">http2_headers_table_size</span> <span class="token number">4096</span></span><span class="token punctuation">;</span>

    <span class="token comment"># 设置服务器推送的最大数量</span>
    <span class="token directive"><span class="token keyword">http2_push_preload</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="dpDXCuNGe3ojFQcaE36ZVB" class="wolai-block"><span class="wolai-serial-number">37.5</span><span class="inline-wrap">注意事项</span></h3><ol class="wolai-block"><li id="cuGipPYHjqyBgN5USzFkAy"><div class="marker"></div><span class="inline-wrap"><b>SSL<span class="jill"></span>证书</b></span><span class="inline-wrap">：HTTP/2<span class="jill"></span>需要<span class="jill"></span>SSL/TLS<span class="jill"></span>支持，因此你必须配置有效的<span class="jill"></span>SSL<span class="jill"></span>证书。</span></li><li id="vmu4ynCE5yN3hwscRZVmqU"><div class="marker"></div><span class="inline-wrap"><b>兼容性</b></span><span class="inline-wrap">：虽然大多数现代浏览器都支持<span class="jill"></span>HTTP/2，但某些旧版浏览器可能不支持。你可以通过条件语句来处理这种情况。</span></li><li id="8YbiZuzixZYu3bhV6epVur"><div class="marker"></div><span class="inline-wrap"><b>性能监控</b></span><span class="inline-wrap">：启用<span class="jill"></span>HTTP/2<span class="jill"></span>后，建议监控服务器性能，以确保没有出现意外问题。</span></li><li id="cpC6iCUSTZp2voJC77EM9A"><div class="marker"></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：确保你的<span class="jill"></span>Nginx<span class="jill"></span>和<span class="jill"></span>SSL<span class="jill"></span>配置是安全的，避免潜在的安全漏洞。</span></li></ol><div id="8FaGpCFAYo1R2fvh1MnVUk" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功启用和配置<span class="jill"></span>HTTP/2，从而提升你的网站性能和用户体验。</span></div></div><div id="4xET3ndZeNuv5KGqTNKmf7" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="fSoxGasgPTjLMNQFQJZX5S" class="wolai-block"><span class="wolai-serial-number">38</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置服务器端包含（SSI）？</span></h1><div id="gaBhBPYUjEu7HMXC1gZ8cj" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置服务器端包含（SSI，Server Side Include）功能，可以使得网页在发送给客户端之前，通过<span class="jill"></span>SSI<span class="jill"></span>指令将其他文本、图片或代码信息包含到网页中。这对于管理大型网站、减少冗余内容和提高页面更新效率非常有用。以下是详细的配置步骤：</span></div></div><h3 id="7zegtyWmieXf3WxYwt78Ec" class="wolai-block"><span class="wolai-serial-number">38.1</span><span class="inline-wrap">安装必要的软件包</span></h3><div id="cBd3SF4jUjhdpX39kYGwCH" class="wolai-block wolai-text"><div><span class="inline-wrap">确保你已经安装了<span class="jill"></span>Nginx。如果没有安装，可以使用以下命令进行安装：</span></div></div><code-block id="2tFUCpcANrXWDFiiJw31j9" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx-full</pre></div></code-block><h3 id="jdmHJjbTKhLq8PDyVp1mrx" class="wolai-block"><span class="wolai-serial-number">38.2</span><span class="inline-wrap">配置<span class="jill"></span>Nginx<span class="jill"></span>以启用<span class="jill"></span>SSI</span></h3><div id="aPG8Vr463mFfoTF9gHfCAy" class="wolai-block wolai-text"><div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>/etc/nginx/sites-available/default</code></span><span class="inline-wrap">）。在需要使用<span class="jill"></span>SSI<span class="jill"></span>的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块或</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块中添加以下配置：</span></div></div><code-block id="rcDhvpq7kboF21MagbUzRG" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com www.yourdomain.com</span><span class="token punctuation">;</span>

    <span class="token comment"># 开启SSI支持</span>
    <span class="token directive"><span class="token keyword">ssi</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssi_silent_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssi_types</span> text/shtml</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="bpkMF6jKa8eFK5uX2vu3Ci" class="wolai-block wolai-text"><div><span class="inline-wrap">解释配置项：</span></div></div><ul class="wolai-block"><li id="kp3HRPNkx5aPWZVjmCsSD4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ssi on</code></span><span class="inline-wrap">: 开启<span class="jill"></span>SSI<span class="jill"></span>支持。</span></li><li id="66VDX8pQ5cyy1wiBPKKNPv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ssi_silent_errors on</code></span><span class="inline-wrap">: 在处理<span class="jill"></span>SSI<span class="jill"></span>文件出错时不输出错误信息。</span></li><li id="dWiq7h8duQ3vz9Fk32WnN5"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ssi_types text/shtml</code></span><span class="inline-wrap">: 指定需要支持的<span class="jill"></span>SSI<span class="jill"></span>文件类型，默认是</span><span class="inline-wrap"><code>text/html</code></span><span class="inline-wrap">。</span></li></ul><h3 id="dRvyR8tZ1ThFwwwihDY2Fx" class="wolai-block"><span class="wolai-serial-number">38.3</span><span class="inline-wrap">创建测试文件</span></h3><div id="7NB6UNwFgTEG7Q7TdzDZM2" class="wolai-block wolai-text"><div><span class="inline-wrap">为了测试<span class="jill"></span>SSI<span class="jill"></span>功能，创建一个包含<span class="jill"></span>SSI<span class="jill"></span>指令的文件。例如，在</span><span class="inline-wrap"><code>/var/www/html</code></span><span class="inline-wrap">目录下创建一个名为</span><span class="inline-wrap"><code>index.shtml</code></span><span class="inline-wrap">的文件，内容如下：</span></div></div><code-block id="7erApACBtPfR48wqsoXEDd" class="wolai-block"><div class="wolai-pre"><div data-lang="HTML" class="marker"></div><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>SSI Example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>This is an SSI example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!--#include file="/var/www/html/header.html" --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Welcome to the SSI test page.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!--#echo var="DATE_LOCAL" --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></div></code-block><div id="7Vy6MWaStGmjCCszAJFv6a" class="wolai-block wolai-text"><div><span class="inline-wrap">在同一目录下创建一个名为</span><span class="inline-wrap"><code>header.html</code></span><span class="inline-wrap">的文件，内容如下：</span></div></div><code-block id="gjJ8dZwq6NPUVaK3VZYh5t" class="wolai-block"><div class="wolai-pre"><div data-lang="HTML" class="marker"></div><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span></pre></div></code-block><h3 id="jaPHeEyMH6Gg99JGyVonKh" class="wolai-block"><span class="wolai-serial-number">38.4</span><span class="inline-wrap">重启<span class="jill"></span>Nginx<span class="jill"></span>服务</span></h3><div id="gjLqamKpjzHrsQ4Epzo9Yn" class="wolai-block wolai-text"><div><span class="inline-wrap">完成配置后，重启<span class="jill"></span>Nginx<span class="jill"></span>服务以应用更改：</span></div></div><code-block id="gjmeuL1oZRwNy2d9pWZboY" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block><h3 id="mKYu7j44PJbrLhP7HGi1qy" class="wolai-block"><span class="wolai-serial-number">38.5</span><span class="inline-wrap">访问测试页面</span></h3><div id="qNgPWDJ47Dp1fLU9THYNjY" class="wolai-block wolai-text"><div><span class="inline-wrap">在浏览器中访问你的域名或<span class="jill"></span>IP<span class="jill"></span>地址，例如</span><span class="inline-wrap"><code>http://yourdomain.com</code></span><span class="inline-wrap">，你应该能够看到包含</span><span class="inline-wrap"><code>header.html</code></span><span class="inline-wrap">内容的完整页面，并且显示当前日期和时间。</span></div></div><h3 id="eUsfEKrZvFQc7TtE63a9WH" class="wolai-block"><span class="wolai-serial-number">38.6</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="6VwmZi4ZertM3d4DtDbk4n"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>权限</b></span><span class="inline-wrap">：确保<span class="jill"></span>Nginx<span class="jill"></span>对包含<span class="jill"></span>SSI<span class="jill"></span>指令的文件及其包含的文件具有读取权限。</span></li><li id="gys5QAsiv5AtoKBScs12xJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：避免在包含敏感信息的文件中使用<span class="jill"></span>SSI，以防止潜在的安全风险。</span></li><li id="uoF4ud5n5HfLZieVAiWLsh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>调试</b></span><span class="inline-wrap">：如果<span class="jill"></span>SSI<span class="jill"></span>指令没有按预期工作，检查<span class="jill"></span>Nginx<span class="jill"></span>的错误日志（通常位于</span><span class="inline-wrap"><code>/var/log/nginx/error.log</code></span><span class="inline-wrap">）以获取更多信息。</span></li></ul><div id="55f5YcMJFBn5K2udoWFiBi" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中成功配置和使用<span class="jill"></span>SSI<span class="jill"></span>功能，从而简化网页内容的管理和更新。</span></div></div><div id="oChZPj3rC5N2zwZykPXMJL" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="mF4AuQrAmr5qZn41mbo5WD" class="wolai-block"><span class="wolai-serial-number">39</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的第三方模块。</span></h1><div id="9TVZPqKCcRsWeGfME9dbrs" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>中的第三方模块（Third-party Modules）是扩展<span class="jill"></span>Nginx<span class="jill"></span>功能的重要工具。这些模块可以增强<span class="jill"></span>Nginx<span class="jill"></span>的核心功能，使其能够处理更多类型的请求和任务。以下是对<span class="jill"></span>Nginx<span class="jill"></span>中第三方模块的详细解释：</span></div></div><h3 id="eawwNxPqQfbJRk4LDhbZRM" class="wolai-block"><span class="wolai-serial-number">39.1</span><span class="inline-wrap">什么是第三方模块？</span></h3><div id="uVVeQP2ep5YjdRjfuYoFmr" class="wolai-block wolai-text"><div><span class="inline-wrap">第三方模块是由社区开发者或公司开发的，用于扩展<span class="jill"></span>Nginx<span class="jill"></span>功能的插件。它们通常以动态链接库（</span><span class="inline-wrap"><code>.so</code></span><span class="inline-wrap">文件）的形式存在，可以在编译时或运行时加载到<span class="jill"></span>Nginx<span class="jill"></span>中。</span></div></div><h3 id="k6fYw3ktZ9SNm3TVXjM7nZ" class="wolai-block"><span class="wolai-serial-number">39.2</span><span class="inline-wrap">为什么使用第三方模块？</span></h3><ul class="wolai-block"><li id="u5wzLcZF5kcJVTeH2YA1o3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>扩展功能</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>本身是一个高性能的<span class="jill"></span>HTTP<span class="jill"></span>服务器和反向代理服务器，但通过第三方模块，你可以添加更多的功能，如负载均衡、缓存、安全认证等。</span></li><li id="3iVzyMaCgYTUMA55QNiz6e"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>性能优化</b></span><span class="inline-wrap">：一些第三方模块经过优化，可以显著提高<span class="jill"></span>Nginx<span class="jill"></span>的性能和稳定性。</span></li><li id="9Z8wmABacKVyfCeJtqG3Wo"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>简化配置</b></span><span class="inline-wrap">：某些复杂的功能可以通过第三方模块实现，从而简化<span class="jill"></span>Nginx<span class="jill"></span>的配置。</span></li></ul><h3 id="9ZzdZth5vk2jjgzeqYre95" class="wolai-block"><span class="wolai-serial-number">39.3</span><span class="inline-wrap">如何安装和使用第三方模块？</span></h3><h4 id="hpnzgUpvCVX63kFBMVA3nA" class="wolai-block"><span class="wolai-serial-number">39.3.1</span><span class="inline-wrap">安装第三方模块</span></h4><ol class="wolai-block"><li id="ekbzXNj1XUEvE7qeqANLAU"><div class="marker"></div><span class="inline-wrap"><b>下载源码</b></span><span class="inline-wrap">：首先，从官方仓库或第三方网站下载所需的模块源码。例如，可以从<span class="jill"></span>GitHub<span class="jill"></span>上获取开源的<span class="jill"></span>Nginx<span class="jill"></span>模块。</span><code-block id="6MjJN1aCTpYg2Rq8Jw54Rs" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">git</span> clone https://github.com/openresty/headers-more-nginx-module.git</pre></div></code-block></li><li id="jC4PreV7tQfabk4cu2SDUz"><div class="marker"></div><span class="inline-wrap"><b>编译<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在编译<span class="jill"></span>Nginx<span class="jill"></span>时，将第三方模块包含进去。假设你下载了一个名为</span><span class="inline-wrap"><code>headers-more-nginx-module</code></span><span class="inline-wrap">的模块，可以使用以下命令进行编译：</span><code-block id="hvjZEWjW3LBNXMFx5VEa3V" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>./configure --add-module<span class="token operator">=</span>/path/to/headers-more-nginx-module
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></pre></div></code-block></li><li id="sfHPwwGRgcRNt1u87bnTAC"><div class="marker"></div><span class="inline-wrap"><b>加载模块</b></span><span class="inline-wrap">：有些模块需要在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中显式加载。例如，对于<span class="jill"></span>OpenResty<span class="jill"></span>的模块，可能需要在</span><span class="inline-wrap"><code>nginx.conf</code></span><span class="inline-wrap">中添加如下配置：</span><code-block id="i93zhJJsT9paJHvSimis8j" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">load_module</span> modules/ngx_http_headers_more_filter_module.so</span><span class="token punctuation">;</span></pre></div></code-block></li></ol><h4 id="fZzujAx8qskjZ5WTs7dvdj" class="wolai-block"><span class="wolai-serial-number">39.3.2</span><span class="inline-wrap">使用第三方模块</span></h4><div id="pUyN5AxS5Ahd9M6UMBrxei" class="wolai-block wolai-text"><div><span class="inline-wrap">一旦安装并加载了第三方模块，就可以在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中使用该模块提供的功能。例如，使用</span><span class="inline-wrap"><code>headers-more-nginx-module</code></span><span class="inline-wrap">模块来设置响应头：</span></div></div><code-block id="fg6vuaQcQtnDNMYkwiVKdz" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">more_set_headers</span> <span class="token string">'Server: MyCustomServer'</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="cJKwV2tEW6v4azavPS3Q83" class="wolai-block"><span class="wolai-serial-number">39.4</span><span class="inline-wrap">常见的第三方模块</span></h3><ul class="wolai-block"><li id="iBQWvJgZYN1NpxoFVTaB6x"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>OpenResty</b></span><span class="inline-wrap">：一个基于<span class="jill"></span>Nginx<span class="jill"></span>的高性能<span class="jill"></span>Web<span class="jill"></span>平台，集成了许多有用的第三方模块，如<span class="jill"></span>LuaJIT、Redis、Memcached<span class="jill"></span>等。</span></li><li id="gmcQXKNEShbnwzpAUdWf7F"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>ngx_pagespeed</b></span><span class="inline-wrap">：Google<span class="jill"></span>开发的<span class="jill"></span>Nginx<span class="jill"></span>模块，用于自动优化网页内容，包括图像压缩、CSS<span class="jill"></span>和<span class="jill"></span>JavaScript<span class="jill"></span>最小化等。</span></li><li id="pvE3PK3xzESJnDB3VNY1ft"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>ngx_cache_purge</b></span><span class="inline-wrap">：用于清除<span class="jill"></span>Nginx<span class="jill"></span>缓存的模块，常用于<span class="jill"></span>CDN<span class="jill"></span>缓存管理。</span></li><li id="9JvE6V7DUAWhB94Aks2yHn"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>ngx_brotli</b></span><span class="inline-wrap">：用于启用<span class="jill"></span>Brotli<span class="jill"></span>压缩的模块，减少传输数据量，提高加载速度。</span></li><li id="81Hz5GdQP8fUFeb9RdgVAj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>ngx_http_auth_request_module</b></span><span class="inline-wrap">：用于外部认证的模块，可以将认证请求转发给后端服务。</span></li></ul><h3 id="sz7ibmJDKh6Dh2SRbuMvy8" class="wolai-block"><span class="wolai-serial-number">39.5</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="qGz6AZedYxj3f3iVKivFxm"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>兼容性</b></span><span class="inline-wrap">：确保第三方模块与当前使用的<span class="jill"></span>Nginx<span class="jill"></span>版本兼容。</span></li><li id="vWxiJA4DD7ijcSEmjKhRL4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>安全性</b></span><span class="inline-wrap">：选择知名且维护良好的第三方模块，避免使用来源不明的模块，以防止安全漏洞。</span></li><li id="xh7533GgY5waTbw6w45Jph"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>性能影响</b></span><span class="inline-wrap">：第三方模块可能会增加<span class="jill"></span>Nginx<span class="jill"></span>的内存和<span class="jill"></span>CPU<span class="jill"></span>使用率，需要监控其性能表现。</span></li></ul><h3 id="bUyBr3CFUcgxnTQZA7X6wp" class="wolai-block"><span class="wolai-serial-number">39.6</span><span class="inline-wrap">示例：安装和使用<span class="jill"></span>ngx_pagespeed<span class="jill"></span>模块</span></h3><ol class="wolai-block"><li id="sr56nPRD8bnVF2jP5sFR6K"><div class="marker"></div><span class="inline-wrap"><b>下载源码</b></span><span class="inline-wrap">：</span><code-block id="b6bftwF8Hz6RsbKbCWTa3G" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">wget</span> https://dl.google.com/dl/page-speed/psol/1.13.35.2-x64.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> <span class="token number">1.13</span>.35.2-x64.tar.gz</pre></div></code-block></li><li id="9pTuWYhDgAquQWuvXy9qEA"><div class="marker"></div><span class="inline-wrap"><b>编译<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：</span><code-block id="bRLC2yAtAhxbcsFoCvqoHf" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>./configure --add-module<span class="token operator">=</span>/path/to/ngx_pagespeed-release-<span class="token operator">&lt;</span>version<span class="token operator">></span>-beta --with-compression<span class="token operator">=</span>gzip --with-http_ssl_module --with-pcre --with-file-aio --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-threads --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_slice_module --with-mail --with-mail_ssl_module --add-module<span class="token operator">=</span>/path/to/headers-more-nginx-module --add-module<span class="token operator">=</span>/path/to/ngx_brotli --add-module<span class="token operator">=</span>/path/to/ngx_cache_purge --add-module<span class="token operator">=</span>/path/to/ngx_http_auth_request_module --with-ld-opt<span class="token operator">=</span><span class="token string">"-Wl,-rpath,/usr/local/lib"</span> <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/etc/nginx --sbin-path<span class="token operator">=</span>/usr/sbin/nginx --conf-path<span class="token operator">=</span>/etc/nginx/nginx.conf --error-log-path<span class="token operator">=</span>/var/log/nginx/error.log --http-log-path<span class="token operator">=</span>/var/log/nginx/access.log --pid-path<span class="token operator">=</span>/var/run/nginx.pid --lock-path<span class="token operator">=</span>/var/run/nginx.lock --http-client-body-temp-path<span class="token operator">=</span>/var/cache/nginx/client_temp --http-proxy-temp-path<span class="token operator">=</span>/var/cache/nginx/proxy_temp --http-fastcgi-temp-path<span class="token operator">=</span>/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path<span class="token operator">=</span>/var/cache/nginx/uwsgi_temp --http-scgi-temp-path<span class="token operator">=</span>/var/cache/nginx/scgi_temp <span class="token parameter variable">--user</span><span class="token operator">=</span>www-data <span class="token parameter variable">--group</span><span class="token operator">=</span>www-data --with-debug --with-pcre-jit --with-file-aio --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-threads --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_slice_module --with-mail --with-mail_ssl_module --with-cc-opt<span class="token operator">=</span><span class="token string">'-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic'</span> --with-ld-opt<span class="token operator">=</span><span class="token string">'-Wl,-rpath,/usr/local/lib -L/usr/local/lib'</span>
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></pre></div></code-block></li><li id="vgjBS1ZHde45iZmjLCyMa9"><div class="marker"></div><span class="inline-wrap"><b>配置<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：</span><code-block id="sZTkpBSUugT3Spd1aMJpDE" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">pagespeed</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">pagespeed</span> FileCachePath /var/ngx_pagespeed_cache</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">pagespeed</span> RewriteLevel CoreFilters</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">pagespeed</span> EnableFilters combine_css,extend_cache,collapse_whitespace</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span> /usr/share/nginx/html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li></ol><div id="9uF4LW1g8KSJHrnmDwGo3i" class="wolai-block wolai-text"><div><span class="inline-wrap">总结来说，Nginx<span class="jill"></span>中的第三方模块极大地扩展了<span class="jill"></span>Nginx<span class="jill"></span>的功能，使其能够处理更复杂和多样化的任务。通过合理地选择和使用这些模块，可以显著提升<span class="jill"></span>Nginx<span class="jill"></span>的性能和灵活性。</span></div></div><div id="p6D3QZpCyXvSAAH7WW2Cmm" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="3mNxr5TETRK79hjQ6gNU8o" class="wolai-block"><span class="wolai-serial-number">40</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置图片和视频的自动优化？</span></h1><div id="odESCZr5d5VX3MRJoviQ4j" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置图片和视频的自动优化，可以通过多种方法实现。以下是一些关键步骤和建议：</span></div></div><h3 id="nMvLRN7C5WVftP7R3yYF7s" class="wolai-block"><span class="wolai-serial-number">40.1</span><span class="inline-wrap">理解<span class="jill"></span>Nginx<span class="jill"></span>与图片处理的基础</span></h3><div id="4gj9QCTFpG8njPCtdtDTKx" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>是一个高性能的<span class="jill"></span>Web<span class="jill"></span>服务器和反向代理服务器，负责指挥和管理网络请求的流量。当用户请求访问包含图片或视频的网页时，Nginx<span class="jill"></span>接收并决定如何快速、高效地将资源传递给用户。</span></div></div><h3 id="xcqtDLEyLpTaUkSrcx1mPy" class="wolai-block"><span class="wolai-serial-number">40.2</span><span class="inline-wrap">优化服务器硬件和网络环境</span></h3><ol class="wolai-block"><li id="2uz86U3UDGFWSPJuD6yGdh"><div class="marker"></div><span class="inline-wrap"><b>升级服务器硬件</b></span><span class="inline-wrap">：确保服务器具有足够的<span class="jill"></span>CPU<span class="jill"></span>核心和内存，以应对多个并发的图片请求。</span></li><li id="t4J61NnHsZF5F8qvovuT8U"><div class="marker"></div><span class="inline-wrap"><b>优化网络带宽</b></span><span class="inline-wrap">：拥有高带宽的网络连接，可以加速图片和视频的传输。</span></li></ol><h3 id="iHDxhotCeojiDHkaU5u5C3" class="wolai-block"><span class="wolai-serial-number">40.3</span><span class="inline-wrap">Nginx<span class="jill"></span>配置优化</span></h3><ol class="wolai-block"><li id="cwA4QhZjZ3ism5CS4FGqya"><div class="marker"></div><span class="inline-wrap"><b>启用<span class="jill"></span>HTTP/2<span class="jill"></span>协议</b></span><span class="inline-wrap">：HTTP/2<span class="jill"></span>相较于<span class="jill"></span>HTTP/1.1<span class="jill"></span>具有多路复用、头部压缩等特性，可以显著提高图片加载效率。在<span class="jill"></span>Nginx<span class="jill"></span>配置中添加</span><span class="inline-wrap"><code>listen 443 ssl http2;</code></span><span class="inline-wrap">即可启用<span class="jill"></span>HTTP/2。</span></li><li id="4cR7KYJpxB5Wae1SdPFk23"><div class="marker"></div><span class="inline-wrap"><b>调整缓冲区大小</b></span><span class="inline-wrap">：适当增大缓冲区大小，可以减少与客户端的交互次数，提高传输效率。例如，设置</span><span class="inline-wrap"><code>client_header_buffer_size</code></span><span class="inline-wrap">为<span class="jill"></span>1k，</span><span class="inline-wrap"><code>large_client_header_buffers</code></span><span class="inline-wrap">为<span class="jill"></span>4<span class="jill"></span>个<span class="jill"></span>8k，</span><span class="inline-wrap"><code>proxy_buffer_size</code></span><span class="inline-wrap">为<span class="jill"></span>128k，</span><span class="inline-wrap"><code>proxy_buffers</code></span><span class="inline-wrap">为<span class="jill"></span>4<span class="jill"></span>个<span class="jill"></span>256k，</span><span class="inline-wrap"><code>proxy_busy_buffers_size</code></span><span class="inline-wrap">为<span class="jill"></span>256k。</span></li><li id="nPC8BPdmryCHEwMsYxgxzK"><div class="marker"></div><span class="inline-wrap"><b>开启<span class="jill"></span>Gzip<span class="jill"></span>压缩</b></span><span class="inline-wrap">：虽然<span class="jill"></span>Gzip<span class="jill"></span>压缩对于图片本身效果有限（因为图片通常已经过压缩），但对于文本类型的元数据（如<span class="jill"></span>HTML、CSS、JavaScript）仍然有效。在<span class="jill"></span>Nginx<span class="jill"></span>配置中添加</span><span class="inline-wrap"><code>gzip on;</code></span><span class="inline-wrap">以及相应的</span><span class="inline-wrap"><code>gzip_types</code></span><span class="inline-wrap">。</span></li></ol><h3 id="7Z81RuEiwLPBwThcrzPgNZ" class="wolai-block"><span class="wolai-serial-number">40.4</span><span class="inline-wrap">图片缓存策略</span></h3><ol class="wolai-block"><li id="uo6aEkSoWcmHjSiwPH5XUX"><div class="marker"></div><span class="inline-wrap"><b>浏览器缓存</b></span><span class="inline-wrap">：通过设置正确的<span class="jill"></span>HTTP<span class="jill"></span>头信息，让浏览器缓存图片资源。当用户再次访问相同的页面时，如果图片没有更新，浏览器将直接使用本地缓存的图片。例如，设置图片的缓存有效期为<span class="jill"></span>30<span class="jill"></span>天，并指示浏览器可以缓存。</span></li><li id="mbwe2cuYiT97Kox25qXhiH"><div class="marker"></div><span class="inline-wrap"><b>Nginx<span class="jill"></span>本地缓存</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>自身也可以设置缓存，将经常访问的图片资源暂存在内存中，提高响应速度。创建缓存空间并设置不同状态码的缓存有效期。</span></li></ol><h3 id="8tR8SjT5cKdzdK2AwVYRE2" class="wolai-block"><span class="wolai-serial-number">40.5</span><span class="inline-wrap">图片压缩与格式转换</span></h3><ol class="wolai-block"><li id="bmR95xySMLdkBw3bxnb5id"><div class="marker"></div><span class="inline-wrap"><b>图片压缩</b></span><span class="inline-wrap">：使用专业的图片压缩工具，在不明显影响图片质量的前提下，减小图片的文件大小。</span></li><li id="ntqaRzczpCGjx5xMCavrZh"><div class="marker"></div><span class="inline-wrap"><b>格式转换</b></span><span class="inline-wrap">：根据图片的特点和使用场景，选择合适的图片格式。例如，对于色彩简单的图片，使用<span class="jill"></span>PNG<span class="jill"></span>格式可能更节省空间；对于有大量连续色调的图片，JPEG<span class="jill"></span>可能是更好的选择。</span></li></ol><h3 id="d78fwbM651cChWKDL8LyqH" class="wolai-block"><span class="wolai-serial-number">40.6</span><span class="inline-wrap">负载均衡与集群部署</span></h3><div id="gBpWJJAmwkqbcYRXnSc7ZB" class="wolai-block wolai-text"><div><span class="inline-wrap">当流量巨大时，单台<span class="jill"></span>Nginx<span class="jill"></span>服务器可能不堪重负，这时需要多台服务器协同工作。通过<span class="jill"></span>Nginx<span class="jill"></span>实现负载均衡，将请求分发到多台后端服务器上。</span></div></div><h3 id="hD8bRSVMsRr5LBpvK6kfyw" class="wolai-block"><span class="wolai-serial-number">40.7</span><span class="inline-wrap">实际案例分析</span></h3><div id="99yx2Pi4LQauC2LAMf9VCb" class="wolai-block wolai-text"><div><span class="inline-wrap">在实际应用中，可以根据具体需求调整上述配置。例如，对于大型网站，可能需要结合<span class="jill"></span>CDN（内容分发网络）来加速图片和视频的分发。同时，定期监控服务器的性能和资源使用情况，确保配置调整是有效的。</span></div></div><div id="op1gG2KFX3mTZ3KXfACrCz" class="wolai-block wolai-text"><div><span class="inline-wrap">综上所述，通过合理配置<span class="jill"></span>Nginx<span class="jill"></span>服务器、优化硬件和网络环境、采用合适的缓存策略和图片压缩技术，可以显著提升图片和视频在<span class="jill"></span>Nginx<span class="jill"></span>中的加载速度和用户体验。</span></div></div><div id="pLiw3hvNmRk1L5qHUVaExQ" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="iSgYUAJs7m1fCitytze3BM" class="wolai-block"><span class="wolai-serial-number">41</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的切片模块（slice）。</span></h1><div id="gtgGsYfgphh8CwgLN3zsDT" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>中的切片模块（slice）是一个</span><span class="inline-wrap"><b>用于处理大文件和并发请求的模块</b></span><span class="inline-wrap">。下面详细解释其功能、背景、配置指令以及运行流程：</span></div></div><ol class="wolai-block"><li id="k1MEpuAKmVDVvcz4gdGaYT"><div class="marker"></div><span class="inline-wrap"><b>基本解读</b></span><ul class="wolai-block"><li id="bcKcBdjkyNLRyd1sWGskGB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>引入时间</b></span><span class="inline-wrap">：nginx<span class="jill"></span>在<span class="jill"></span>2015<span class="jill"></span>年的<span class="jill"></span>1.9.8<span class="jill"></span>版本中引入了<span class="jill"></span>ngx_http_slice_module<span class="jill"></span>模块。</span></li><li id="dyxh3ux4jUszToEGwUCNv2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>编译选项</b></span><span class="inline-wrap">：默认情况下，slice<span class="jill"></span>模块没有编译进<span class="jill"></span>nginx，需要在编译时使用</span><span class="inline-wrap"><code>--with-http_slice_module</code></span><span class="inline-wrap">参数来启用。</span></li><li id="gSpU51pxZdexVkPGq8rELY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>核心功能</b></span><span class="inline-wrap">：slice<span class="jill"></span>模块通过支持<span class="jill"></span>Range<span class="jill"></span>回源请求，将大响应分解为多个小片段，从而提高服务性能，特别是在处理大文件并发请求时。</span></li></ul></li><li id="n97t4nPccJdx2wJ1PM942i"><div class="marker"></div><span class="inline-wrap"><b>背景介绍</b></span><ul class="wolai-block"><li id="5qv3QWtzREiTULXYiba836"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>大文件处理问题</b></span><span class="inline-wrap">：当上游响应的文件特别大时，nginx<span class="jill"></span>处理效率较低，特别是多个请求同时并发请求一个大文件时，性能成为瓶颈。</span></li><li id="x15fpigK6oNx3Vmgm1URaw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>缓存策略问题</b></span><span class="inline-wrap">：大文件不利于<span class="jill"></span>CDN<span class="jill"></span>缓存，因为<span class="jill"></span>CDN<span class="jill"></span>服务器通常需要等文件下载完全后才能缓存，如果用户下载一半或与上游服务器连接中断，会导致文件不能完整被缓存，引起反复下载，降低命中率。</span></li><li id="8J2netbgpKPvzFWyvmEedX"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡问题</b></span><span class="inline-wrap">：大文件在<span class="jill"></span>CDN<span class="jill"></span>架构中不容易平衡<span class="jill"></span>cache<span class="jill"></span>节点的负载，可能导致负载不平衡而影响用户体验。</span></li></ul></li><li id="5iYkst3ZQVs3uZswHWyTNs"><div class="marker"></div><span class="inline-wrap"><b>配置指令</b></span><ul class="wolai-block"><li id="gNLhRqBPLdVhBkfQwXKu7U"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>基本语法</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>slice size;</code></span><span class="inline-wrap">，其中<span class="jill"></span>size<span class="jill"></span>是切片的大小，单位可以是<span class="jill"></span>K(千字节)、M(兆字节)、G(吉字节)。</span></li><li id="4tRANm6PhLcVcJ3jf9iEuE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>配置位置</b></span><span class="inline-wrap">：可以在<span class="jill"></span>http、server、location<span class="jill"></span>块中定义。</span></li><li id="o3rXNsf6utbF6tGC3goty6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>启用条件</b></span><span class="inline-wrap">：要真正启用<span class="jill"></span>slice<span class="jill"></span>功能，还需要设置以下两条指令：</span><ul class="wolai-block"><li id="fRGEGVjYJvasd6U5UMhFfJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_cache_key $uri$is_args$args$slice_range;</code></span><span class="inline-wrap">：表示如果使用<span class="jill"></span>nginx<span class="jill"></span>的自带缓存功能，那么<span class="jill"></span>nginx<span class="jill"></span>会以切片为单位进行缓存，需要对同一个文件的不同分片进行区分。</span></li><li id="s3dEhUAnZncGk4q1oJfV3C"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>proxy_set_header Range $slice_range;</code></span><span class="inline-wrap">：表示如果向上游服务器进行请求时，需要增加<span class="jill"></span>HTTP Range<span class="jill"></span>头，该头的内容就是<span class="jill"></span>$slice_range<span class="jill"></span>变量的值。</span></li></ul></li></ul></li><li id="qKtUWFg7MKWVs1Tchhrtys"><div class="marker"></div><span class="inline-wrap"><b>运行流程</b></span><ul class="wolai-block"><li id="iAdMF4JYPAfBgcgAZ4B9ZB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>客户端请求</b></span><span class="inline-wrap">：假定客户端发送一个<span class="jill"></span>GET<span class="jill"></span>请求，不携带<span class="jill"></span>Range<span class="jill"></span>头，默认读取所有内容。</span></li><li id="eW5spy9Zf1M1iQ6NM23iTb"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>子请求生成</b></span><span class="inline-wrap">：nginx<span class="jill"></span>会根据配置的<span class="jill"></span>slice<span class="jill"></span>大小（例如<span class="jill"></span>2M），先发起一个<span class="jill"></span>2M<span class="jill"></span>的<span class="jill"></span>range<span class="jill"></span>请求，这个请求返回的<span class="jill"></span>Content-Range<span class="jill"></span>响应头会给出文件总长度，这样<span class="jill"></span>nginx<span class="jill"></span>就知道一共需要发几个<span class="jill"></span>range<span class="jill"></span>请求来取完所有内容。</span></li><li id="3nCup6tqY9ABZzRhz3stgE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>范围请求</b></span><span class="inline-wrap">：nginx<span class="jill"></span>会构造多个<span class="jill"></span>range<span class="jill"></span>请求（例如<span class="jill"></span>0-2M, 2-4M, 4-6M），每个请求都会返回一定范围的响应。</span></li><li id="2R6g1cnCGry2kYw5ZFXm5t"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>数据整合</b></span><span class="inline-wrap">：nginx<span class="jill"></span>接收到多个片段后，会重新整合出原始客户需要的<span class="jill"></span>Range<span class="jill"></span>请求头的内容发送给客户端。</span></li></ul></li></ol><div id="2XrA8JbgyvEwr8hV8h88XL" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，Nginx<span class="jill"></span>的<span class="jill"></span>slice<span class="jill"></span>模块通过将大文件分解为多个小片段来提高处理效率和缓存命中率，解决了大文件在<span class="jill"></span>CDN<span class="jill"></span>架构中的缓存和负载均衡问题。</span></div></div><div id="t9Ka5xtmoPgPtovcnYMKeq" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="cvDWjbiHqayJFu8t4QgDny" class="wolai-block"><span class="wolai-serial-number">42</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置文件下载限速？</span></h1><div id="49YRFRL4g329X6s8t5CWWv" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置文件下载限速可以通过设置带宽限制来实现。这有助于控制服务器的带宽使用，防止某些用户或应用程序占用过多的带宽资源。以下是详细的步骤和示例：</span></div></div><h3 id="qX1YQHybNeYSzqVHTM7SkF" class="wolai-block"><span class="wolai-serial-number">42.1</span><span class="inline-wrap">理解带宽限制的基本概念</span></h3><ol class="wolai-block"><li id="4TwykJFotmoUTBhMyCdqTR"><div class="marker"></div><span class="inline-wrap"><b>带宽限制</b></span><span class="inline-wrap">：通过限制每个连接的最大传输速率来控制带宽使用。例如，可以设置每个连接的最大传输速率为<span class="jill"></span>10KB/s。</span></li><li id="cSbz8Nz3TzSNEdd3ACcPqm"><div class="marker"></div><span class="inline-wrap"><b>应用场景</b></span><span class="inline-wrap">：适用于需要控制带宽使用的场景，如视频流媒体服务、文件下载服务等。</span></li><li id="97gfzUR88h129D2ApsGmSe"><div class="marker"></div><span class="inline-wrap"><b>实现方式</b></span><span class="inline-wrap">：通过<span class="jill"></span>Nginx<span class="jill"></span>的</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">指令来实现带宽限制。</span></li></ol><h3 id="hCJaNMLQTtJcWGZBoNBTis" class="wolai-block"><span class="wolai-serial-number">42.2</span><span class="inline-wrap">配置带宽限制的步骤</span></h3><ol class="wolai-block"><li id="uqdVy1PPUdJquDZjbXzwqR"><div class="marker"></div><span class="inline-wrap"><b>打开<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：通常位于/etc/nginx/nginx.conf<span class="jill"></span>或/usr/local/nginx/conf/nginx.conf。</span></li><li id="gHj9RJSUiVYMEV3P5e2n5J"><div class="marker"></div><span class="inline-wrap"><b>定位到需要限制带宽的<span class="jill"></span>server<span class="jill"></span>块或<span class="jill"></span>location<span class="jill"></span>块</b></span><span class="inline-wrap">：根据实际需求，选择在全局、虚拟主机或特定路径下进行配置。</span></li><li id="6mYBvkAXGAFBi8qZGQT2mQ"><div class="marker"></div><span class="inline-wrap"><b>添加<span class="jill"></span>limit_rate<span class="jill"></span>指令</b></span><span class="inline-wrap">：在相应的块中添加</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">指令，并指定带宽限制值。</span></li></ol><h3 id="iuuffTYHNAEbj7hdTRiQoA" class="wolai-block"><span class="wolai-serial-number">42.3</span><span class="inline-wrap">具体配置示例</span></h3><h4 id="oPKsBz68ATnoT2xqHgkdud" class="wolai-block"><span class="wolai-serial-number">42.3.1</span><span class="inline-wrap">全局配置</span></h4><code-block id="fmZgxq6BYQj5yHVs3P9Hvn" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    ...
    <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">10k</span></span><span class="token punctuation">;</span>  <span class="token comment"># 设置全局带宽限制为10KB/s</span>
    ...
<span class="token punctuation">}</span></pre></div></code-block><h4 id="aABHFC1WQEPMCtCKJH2jDo" class="wolai-block"><span class="wolai-serial-number">42.3.2</span><span class="inline-wrap">虚拟主机配置</span></h4><code-block id="3Qv2rw8EJgHUbymsZwxPt3" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
    ...
    <span class="token directive"><span class="token keyword">location</span> /downloads/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">50k</span></span><span class="token punctuation">;</span>  <span class="token comment"># 设置/downloads/路径下的带宽限制为50KB/s</span>
        ...
    <span class="token punctuation">}</span>
    ...
<span class="token punctuation">}</span></pre></div></code-block><h4 id="7ZkLsHviwMnYGXCin2DyTH" class="wolai-block"><span class="wolai-serial-number">42.3.3</span><span class="inline-wrap">特定路径配置</span></h4><code-block id="njtZ2k34fX6FLZeKCWYzp" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
    ...
    <span class="token directive"><span class="token keyword">location</span> /largefile</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">1m</span></span><span class="token punctuation">;</span>  <span class="token comment"># 设置/largefile路径下的带宽限制为1MB/s</span>
        ...
    <span class="token punctuation">}</span>
    ...
<span class="token punctuation">}</span></pre></div></code-block><h3 id="rbk95h1dN3Hg4CmGQVBSDk" class="wolai-block"><span class="wolai-serial-number">42.4</span><span class="inline-wrap">验证配置</span></h3><ol class="wolai-block"><li id="iLEEXknwRiTvkHxW84qMjs"><div class="marker"></div><span class="inline-wrap"><b>测试配置文件</b></span><span class="inline-wrap">：在修改完配置文件后，使用以下命令测试配置文件是否正确：</span><code-block id="xciqkoXiz2NGNdBSPbfBur" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block><div id="rv96hYiqsZV5n7HbUZgUFi" class="wolai-block wolai-text"><div><span class="inline-wrap">如果输出显示“syntax is ok”和“test is successful”，则表示配置文件无误。</span></div></div></li><li id="eGYu1GCyeHu2EnsNWLQo4e"><div class="marker"></div><span class="inline-wrap"><b>重新加载<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在确认配置文件无误后，使用以下命令重新加载<span class="jill"></span>Nginx：</span><code-block id="5Ws1fGm2iPKFrTV3DW2955" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl reload nginx</pre></div></code-block><div id="8Rj6ebWfCykoMXSWu88JPE" class="wolai-block wolai-text"><div><span class="inline-wrap">或者</span></div></div><code-block id="53JuV3ah5FQxoRqSWn3ocU" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">service</span> nginx reload</pre></div></code-block></li><li id="482z3rP3cj2HLkQTn7Hq6U"><div class="marker"></div><span class="inline-wrap"><b>验证效果</b></span><span class="inline-wrap">：通过浏览器或其他工具访问被限制的路径，观察下载速度是否符合预期。</span></li></ol><h3 id="4X4oVQdBRLqtFrQaPXmeTC" class="wolai-block"><span class="wolai-serial-number">42.5</span><span class="inline-wrap">注意事项</span></h3><ol class="wolai-block"><li id="exCtXtVPzDRakaFHGsFpgB"><div class="marker"></div><span class="inline-wrap"><b>单位</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">指令支持多种单位，包括<span class="jill"></span>k（千字节）、m（兆字节）等。</span></li><li id="bfXdPTj3CypUNRtP33wHU3"><div class="marker"></div><span class="inline-wrap"><b>优先级</b></span><span class="inline-wrap">：如果同时在全局和局部设置了</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">，局部设置会覆盖全局设置。</span></li><li id="eB1amwMEKWVZt4bdPgeoHY"><div class="marker"></div><span class="inline-wrap"><b>性能影响</b></span><span class="inline-wrap">：虽然带宽限制可以有效控制带宽使用，但过高的限制可能会影响用户体验，因此需要根据实际情况进行调整。</span></li></ol><div id="8Qzx8friDw6UHFZswQKLZu" class="wolai-block wolai-text"><div><span class="inline-wrap">综上所述，通过合理配置<span class="jill"></span>Nginx<span class="jill"></span>的</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">指令，可以有效地控制文件下载的带宽使用，确保服务器资源的合理分配。</span></div></div><div id="kPPU6hcfVn5vnexG7Pwf3Q" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置文件下载限速可以通过设置带宽限制来实现。这有助于控制服务器的带宽使用，防止某些用户或应用程序占用过多的带宽资源。以下是详细的步骤和示例：</span></div></div><h3 id="opb5Uq1cfyHU2qxPiubKg1" class="wolai-block"><span class="wolai-serial-number">42.6</span><span class="inline-wrap">一、理解带宽限制的基本概念</span></h3><ol class="wolai-block"><li id="gRcWsqHhEyQZHostMKn2M3"><div class="marker"></div><span class="inline-wrap"><b>带宽限制</b></span><span class="inline-wrap">：通过限制每个连接的最大传输速率来控制带宽使用。例如，可以设置每个连接的最大传输速率为<span class="jill"></span>10KB/s。</span></li><li id="dcNJU7maz2ZwxAcGuk3Wag"><div class="marker"></div><span class="inline-wrap"><b>应用场景</b></span><span class="inline-wrap">：适用于需要控制带宽使用的场景，如视频流媒体服务、文件下载服务等。</span></li><li id="urQRzLnmdemBKbgPXonxDH"><div class="marker"></div><span class="inline-wrap"><b>实现方式</b></span><span class="inline-wrap">：通过<span class="jill"></span>Nginx<span class="jill"></span>的</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">指令来实现带宽限制。</span></li></ol><h3 id="vCNYfvQvsQaBAMiX9teRUE" class="wolai-block"><span class="wolai-serial-number">42.7</span><span class="inline-wrap">二、配置带宽限制的步骤</span></h3><ol class="wolai-block"><li id="4Z787vxAvfPAdDmgeKrQGf"><div class="marker"></div><span class="inline-wrap"><b>打开<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：通常位于/etc/nginx/nginx.conf<span class="jill"></span>或/usr/local/nginx/conf/nginx.conf。</span></li><li id="3C5TeAVAdC98WYwhhmMrLU"><div class="marker"></div><span class="inline-wrap"><b>定位到需要限制带宽的<span class="jill"></span>server<span class="jill"></span>块或<span class="jill"></span>location<span class="jill"></span>块</b></span><span class="inline-wrap">：根据实际需求，选择在全局、虚拟主机或特定路径下进行配置。</span></li><li id="pz6tTkbBcbKKckWgPeWqEs"><div class="marker"></div><span class="inline-wrap"><b>添加<span class="jill"></span>limit_rate<span class="jill"></span>指令</b></span><span class="inline-wrap">：在相应的块中添加</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">指令，并指定带宽限制值。</span></li></ol><h3 id="pt4fpcE5AJvzSHmCVRfeP" class="wolai-block"><span class="wolai-serial-number">42.8</span><span class="inline-wrap">三、具体配置示例</span></h3><h4 id="ad83Yhc95DS8GstBdRcMh3" class="wolai-block"><span class="wolai-serial-number">42.8.1</span><span class="inline-wrap">1. 全局配置</span></h4><code-block id="24913no1hqVKmCYupLrsd9" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    ...
    <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">10k</span></span><span class="token punctuation">;</span>  <span class="token comment"># 设置全局带宽限制为10KB/s</span>
    ...
<span class="token punctuation">}</span></pre></div></code-block><h4 id="gtw9z9HH4qL4o9nJBhDtUX" class="wolai-block"><span class="wolai-serial-number">42.8.2</span><span class="inline-wrap">2. 虚拟主机配置</span></h4><code-block id="ubYWtHsiEo7oWzgP4mKVtR" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
    ...
    <span class="token directive"><span class="token keyword">location</span> /downloads/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">50k</span></span><span class="token punctuation">;</span>  <span class="token comment"># 设置/downloads/路径下的带宽限制为50KB/s</span>
        ...
    <span class="token punctuation">}</span>
    ...
<span class="token punctuation">}</span></pre></div></code-block><h4 id="nySCEHen8NeKLswLmBc9pC" class="wolai-block"><span class="wolai-serial-number">42.8.3</span><span class="inline-wrap">3. 特定路径配置</span></h4><code-block id="3kosFLbaeEG1JwkewDg9g9" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
    ...
    <span class="token directive"><span class="token keyword">location</span> /largefile</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">1m</span></span><span class="token punctuation">;</span>  <span class="token comment"># 设置/largefile路径下的带宽限制为1MB/s</span>
        ...
    <span class="token punctuation">}</span>
    ...
<span class="token punctuation">}</span></pre></div></code-block><h3 id="v4ttNQb7qtJQqnPiogF5zG" class="wolai-block"><span class="wolai-serial-number">42.9</span><span class="inline-wrap">四、验证配置</span></h3><ol class="wolai-block"><li id="5TbYVzp8kpJ7vRKdoR2Xgx"><div class="marker"></div><span class="inline-wrap"><b>测试配置文件</b></span><span class="inline-wrap">：在修改完配置文件后，使用以下命令测试配置文件是否正确：</span><code-block id="d27SFkbxd2QTBevwfMsGV" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block><div id="2tq6QXpoMFJSheho5x1TCw" class="wolai-block wolai-text"><div><span class="inline-wrap">如果输出显示“syntax is ok”和“test is successful”，则表示配置文件无误。</span></div></div></li><li id="wV9D7jMckKGhkjFxxmH1NN"><div class="marker"></div><span class="inline-wrap"><b>重新加载<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在确认配置文件无误后，使用以下命令重新加载<span class="jill"></span>Nginx：</span><code-block id="azo9gqYvDkUvco8VrFf3k3" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl reload nginx</pre></div></code-block><div id="gb3QEUVm7WMnFX8e7z9an5" class="wolai-block wolai-text"><div><span class="inline-wrap">或者</span></div></div><code-block id="cf9MK4eJE86FNa8kGvBnNa" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">service</span> nginx reload</pre></div></code-block></li><li id="sjHkj9nnr9VW7k1ziuK7nj"><div class="marker"></div><span class="inline-wrap"><b>验证效果</b></span><span class="inline-wrap">：通过浏览器或其他工具访问被限制的路径，观察下载速度是否符合预期。</span></li></ol><h3 id="ai5SC8y5bgCQSJMZLSnKHT" class="wolai-block"><span class="wolai-serial-number">42.10</span><span class="inline-wrap">五、注意事项</span></h3><ol class="wolai-block"><li id="6WUmm1nVyw3dXxp6sw3jmz"><div class="marker"></div><span class="inline-wrap"><b>单位</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">指令支持多种单位，包括<span class="jill"></span>k（千字节）、m（兆字节）等。</span></li><li id="bWLNV58AdawCoTwJogmdxs"><div class="marker"></div><span class="inline-wrap"><b>优先级</b></span><span class="inline-wrap">：如果同时在全局和局部设置了</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">，局部设置会覆盖全局设置。</span></li><li id="6eFeLXViReXE9V63omuodK"><div class="marker"></div><span class="inline-wrap"><b>性能影响</b></span><span class="inline-wrap">：虽然带宽限制可以有效控制带宽使用，但过高的限制可能会影响用户体验，因此需要根据实际情况进行调整。</span></li></ol><div id="2Z4fJF8JBMkoSUd5UaAe4K" class="wolai-block wolai-text"><div><span class="inline-wrap">综上所述，通过合理配置<span class="jill"></span>Nginx<span class="jill"></span>的</span><span class="inline-wrap"><code>limit_rate</code></span><span class="inline-wrap">指令，可以有效地控制文件下载的带宽使用，确保服务器资源的合理分配。</span></div></div><div id="6vnq2SzyAaUdTuXp8cUx6n" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="ueW8nYdFvKsZY2Fyezv6jT" class="wolai-block"><span class="wolai-serial-number">43</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置防火墙规则？</span></h1><div id="iFbkZEbW5XKQESNtFs4ef9" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置防火墙规则，通常涉及到使用</span><span class="inline-wrap"><b>Nginx<span class="jill"></span>的访问控制模块和第三方模块</b></span><span class="inline-wrap">，如<span class="jill"></span>ModSecurity。这些规则可以帮助你限制特定<span class="jill"></span>IP<span class="jill"></span>地址的访问、防止某些类型的攻击等。以下是如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置防火墙规则的具体步骤：</span></div></div><ol class="wolai-block"><li id="u6wNgo6R7mhcbseDEy6q7T"><div class="marker"></div><span class="inline-wrap"><b>安装<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：确保你已经安装了<span class="jill"></span>Nginx<span class="jill"></span>服务器。如果尚未安装，可以通过以下命令进行安装：</span><code-block id="hpRLoMVhmhxt1HER9RJGJH" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx</pre></div></code-block></li><li id="hZ8DkECtrQe8NQgKw6WuE6"><div class="marker"></div><span class="inline-wrap"><b>创建黑名单或白名单配置文件</b></span><span class="inline-wrap">：在<span class="jill"></span>Nginx<span class="jill"></span>的<span class="jill"></span>conf<span class="jill"></span>目录（通常是/etc/nginx）下创建一个名为<span class="jill"></span>blockip.conf<span class="jill"></span>的文件。在这个文件中，你可以定义要屏蔽或允许的<span class="jill"></span>IP<span class="jill"></span>地址或<span class="jill"></span>IP<span class="jill"></span>段。例如：</span><code-block id="8LWx8n1kJmf2Dpqwv4zfWh" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>deny 195.91.122.67;
allow 192.168.0.0/24;</pre></div></code-block></li><li id="aNoTq2NMYDZCGP8ikQJBTo"><div class="marker"></div><span class="inline-wrap"><b>修改<span class="jill"></span>Nginx<span class="jill"></span>主配置文件</b></span><span class="inline-wrap">：打开<span class="jill"></span>Nginx<span class="jill"></span>的主配置文件（通常是/etc/nginx/nginx.conf），并在适当的位置（如<span class="jill"></span>http<span class="jill"></span>块、server<span class="jill"></span>块或<span class="jill"></span>location<span class="jill"></span>块）添加以下配置以包含<span class="jill"></span>blockip.conf<span class="jill"></span>文件：</span><code-block id="9mpprKiXVQUcE4EX4AcB7Q" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>include /etc/nginx/blockip.conf;</pre></div></code-block></li><li id="pw67dt2xiaq5RWTeNxCNLF"><div class="marker"></div><span class="inline-wrap"><b>测试并重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在修改完配置文件后，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置文件是否正确：</span><code-block id="sogFmYPHqw3QVBHsRnYy5H" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block><div id="aKJyD1fU7A1Xm967po6dKr" class="wolai-block wolai-text"><div><span class="inline-wrap">如果测试通过，则重启<span class="jill"></span>Nginx<span class="jill"></span>以使配置生效：</span></div></div><code-block id="eM21ckk5jpMtovd2u3uGyK" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li><li id="2Q4tuyK9bZaFNQqTHdp6Jg"><div class="marker"></div><span class="inline-wrap"><b>高级配置</b></span><span class="inline-wrap">：除了基本的黑白名单功能外，你还可以使用<span class="jill"></span>Nginx<span class="jill"></span>的其他模块和第三方模块来实现更复杂的防火墙规则。例如，使用<span class="jill"></span>ngx_http_limit_req<span class="jill"></span>模块来限制每个<span class="jill"></span>IP<span class="jill"></span>的请求频率，或者使用<span class="jill"></span>ModSecurity<span class="jill"></span>来增强<span class="jill"></span>Web<span class="jill"></span>应用的安全性。</span></li></ol><div id="GckVKXhvjGGXG7Ps23Dq" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中配置基本的防火墙规则来保护你的网站免受恶意攻击。然而，对于更复杂的安全需求，建议结合使用其他安全工具和最佳实践来构建一个多层次的安全防护体系。</span></div></div><div id="qr3RtaPvXNTWmnuAXGoeaF" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="vPmi6pDR59u4MQ88YxxBWX" class="wolai-block"><span class="wolai-serial-number">44</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>stream<span class="jill"></span>模块。</span></h1><div id="fuPnTEwTpTesDkrzmNL9dk" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>Nginx<span class="jill"></span>中的<span class="jill"></span>stream<span class="jill"></span>模块用于处理四层协议（如<span class="jill"></span>TCP<span class="jill"></span>和<span class="jill"></span>UDP）的流量转发、代理以及负载均衡</b></span><span class="inline-wrap">。以下是对<span class="jill"></span>stream<span class="jill"></span>模块的详细解释：</span></div></div><ol class="wolai-block"><li id="jieWTMrcRcARJsSRsoZHjz"><div class="marker"></div><span class="inline-wrap"><b>基本功能</b></span><ul class="wolai-block"><li id="vp9YyYG1y4rccoyUmc7VnE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>流量转发与代理</b></span><span class="inline-wrap">：stream<span class="jill"></span>模块能够代理和转发<span class="jill"></span>TCP<span class="jill"></span>或<span class="jill"></span>UDP<span class="jill"></span>流量，使得只有特定<span class="jill"></span>IP<span class="jill"></span>地址能访问的服务可以通过<span class="jill"></span>Nginx<span class="jill"></span>进行中转，从而允许其他<span class="jill"></span>IP<span class="jill"></span>地址的客户端访问这些服务。</span></li><li id="j2FtASqvuSXnNA3WgxZH82"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡</b></span><span class="inline-wrap">：对于多个<span class="jill"></span>TCP<span class="jill"></span>或<span class="jill"></span>UDP<span class="jill"></span>端口服务，stream<span class="jill"></span>模块支持多种负载均衡算法（如轮询、最小连接数、ip_hash<span class="jill"></span>等），以实现数据流的负载均衡，提高系统的可用性和性能。</span></li></ul></li><li id="w69NyKJfRUbyypYaacEtD7"><div class="marker"></div><span class="inline-wrap"><b>工作原理</b></span><ul class="wolai-block"><li id="4b16bbJonZXubJpZosLaAE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>监听与接收请求</b></span><span class="inline-wrap">：stream<span class="jill"></span>模块通过监听指定的<span class="jill"></span>TCP<span class="jill"></span>或<span class="jill"></span>UDP<span class="jill"></span>端口来接收客户端的请求。</span></li><li id="juDGDYgNAtaHfybhfvJg6c"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>选择上游服务器并建立连接</b></span><span class="inline-wrap">：当请求到来时，stream<span class="jill"></span>模块会根据配置选择一个合适的上游服务器，并与其建立<span class="jill"></span>socket<span class="jill"></span>连接。</span></li><li id="qNUPAHyatyW76XENNDju61"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>数据转发</b></span><span class="inline-wrap">：stream<span class="jill"></span>模块将客户端的数据转发给选定的上游服务器，并将上游服务器的响应数据转发回客户端，从而实现了数据的代理转发。</span></li></ul></li><li id="oWeaDSgcX3a9DcK61KrLgV"><div class="marker"></div><span class="inline-wrap"><b>配置示例</b></span><ul class="wolai-block"><li id="bh5Cb7ZY3MWMjeofSJ4WAg"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">以下是一个使用<span class="jill"></span>Nginx stream<span class="jill"></span>模块实现<span class="jill"></span>TCP<span class="jill"></span>流量代理转发和负载均衡的简单配置示例：</span><code-block id="v3v2oRegfGPSBFxvdUwTA3" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">stream</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">server</span> 192.168.1.100:3306</span><span class="token punctuation">;</span> <span class="token comment"># 上游服务器1</span>
        <span class="token directive"><span class="token keyword">server</span> 192.168.1.101:3306</span><span class="token punctuation">;</span> <span class="token comment"># 上游服务器2</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">3306</span></span><span class="token punctuation">;</span> <span class="token comment"># 监听本地3306端口</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> backend</span><span class="token punctuation">;</span> <span class="token comment"># 将请求转发给upstream定义的上游服务器组</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="eZ2RdrhyoGidm1jAWXrbc8" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，Nginx<span class="jill"></span>的<span class="jill"></span>stream<span class="jill"></span>模块监听了本地的<span class="jill"></span>3306<span class="jill"></span>端口，并将接收到的<span class="jill"></span>TCP<span class="jill"></span>请求转发给名为</span><span class="inline-wrap"><code>backend</code></span><span class="inline-wrap">的上游服务器组。上游服务器组包含两个<span class="jill"></span>MySQL<span class="jill"></span>服务器（192.168.1.100:3306<span class="jill"></span>和<span class="jill"></span>192.168.1.101:3306），Nginx<span class="jill"></span>会根据负载均衡算法（默认是轮询）选择一个服务器来处理请求。</span></div></div></li></ul></li></ol><div id="5qsnMHNY7ME6t8T4rvWV6g" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，Nginx<span class="jill"></span>的<span class="jill"></span>stream<span class="jill"></span>模块是一个功能强大的工具，适用于需要处理四层协议流量的场景。通过合理配置和使用<span class="jill"></span>stream<span class="jill"></span>模块，可以实现高效的流量转发、代理和负载均衡功能。</span></div></div><div id="v97K2QASH6FyB6E2YCwocu" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="f9B9M8xyPn8ZNkrMsrY6S8" class="wolai-block"><span class="wolai-serial-number">45</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置邮件代理（mail proxy）？</span></h1><div id="9eEveH18UYdKfdf1bdrGyR" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置邮件代理（mail proxy）可以通过使用第三方模块如</span><span class="inline-wrap"><code>nginx-mail-module</code></span><span class="inline-wrap">来实现。以下是详细的步骤和示例：</span></div></div><h3 id="hZeQXtxGDpPkSvckq6fe6" class="wolai-block"><span class="wolai-serial-number">45.1</span><span class="inline-wrap">安装必要的软件包</span></h3><ol class="wolai-block"><li id="we57fkUY6Y2a8Asbtax1Wf"><div class="marker"></div><span class="inline-wrap"><b>安装<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：确保你已经安装了<span class="jill"></span>Nginx<span class="jill"></span>服务器。如果尚未安装，可以通过以下命令进行安装：</span><code-block id="7ebtK67dk9N3BDhsNDV58Y" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx</pre></div></code-block></li><li id="5mDm63sCnyXFQYVzTU76VS"><div class="marker"></div><span class="inline-wrap"><b>安装第三方邮件代理模块</b></span><span class="inline-wrap">：目前，Nginx<span class="jill"></span>官方并不直接支持邮件代理功能，但有一些第三方模块可以实现这一功能。例如，可以使用</span><span class="inline-wrap"><code>nginx-mail-module</code></span><span class="inline-wrap">。</span></li></ol><h3 id="4W3v69LRbcX3cQmWius4fa" class="wolai-block"><span class="wolai-serial-number">45.2</span><span class="inline-wrap">配置邮件代理</span></h3><ol class="wolai-block"><li id="rsJYTifysxQ17BTdQn6H1z"><div class="marker"></div><span class="inline-wrap"><b>下载并编译<span class="jill"></span>nginx-mail-module</b></span><span class="inline-wrap">：首先，你需要下载并编译</span><span class="inline-wrap"><code>nginx-mail-module</code></span><span class="inline-wrap">。可以从<span class="jill"></span>GitHub<span class="jill"></span>上获取源码并进行编译安装。</span><code-block id="rYB9uxZeniVbAStMLzJADj" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">git</span> clone https://github.com/vozlt/nginx-module-mail.git
<span class="token builtin class-name">cd</span> nginx-module-mail
./configure --add-module<span class="token operator">=</span>/path/to/nginx-module-mail
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></pre></div></code-block></li><li id="mokxgXKChnP2ieTA9qibUa"><div class="marker"></div><span class="inline-wrap"><b>修改<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：打开<span class="jill"></span>Nginx<span class="jill"></span>的主配置文件（通常是</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">），并在适当的位置添加邮件代理的配置。以下是一个基本的邮件代理配置示例：</span><code-block id="8LyaCiMG5MXQM1Bb4KTTPt" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>mail {
    server_name mail.example.com;
    auth_http localhost:9000/auth;
    proxy_pass_error_message on;

    smtp_capabilities "PIPELINING" "8BITMIME";
    smtp_auth login plain cram-md5;

    server {
        listen 143 ssl;
        protocol imap;
        imap_capabilities IMAP4rev1;
        imap_client_buffer 16K;
        imap_login_attempts 5;
        imap_timeout 300s;
        imap_auth = login plain;
        imap_user = user@domain.com;
        imap_pass = password;
    }

    server {
        listen 587 ssl;
        protocol smtp;
        smtp_auth login plain cram-md5;
        smtp_capabilities "PIPELINING" "8BITMIME";
        smtp_timeout 300s;
        smtp_user = user@domain.com;
        smtp_pass = password;
    }
}</pre></div></code-block></li><li id="7X9ZXER9M4RGCr84d3V9pF"><div class="marker"></div><span class="inline-wrap"><b>测试并重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在修改完配置文件后，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置文件是否正确：</span><code-block id="72DaYTNYh6bJFxzZ6aT7YJ" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block><div id="mh7g72YHM1cgJhkAHZKSp3" class="wolai-block wolai-text"><div><span class="inline-wrap">如果测试通过，则重启<span class="jill"></span>Nginx<span class="jill"></span>以使配置生效：</span></div></div><code-block id="ue3NkBaJhUe1Ah1gTT8RNy" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li></ol><h3 id="uyFowzo2uoVJqcw3pbYqBT" class="wolai-block"><span class="wolai-serial-number">45.3</span><span class="inline-wrap">验证配置</span></h3><ol class="wolai-block"><li id="4vF5doxf3CzsXmKp3so11Z"><div class="marker"></div><span class="inline-wrap"><b>发送和接收邮件</b></span><span class="inline-wrap">：配置完成后，你可以尝试使用邮件客户端（如<span class="jill"></span>Outlook、Thunderbird<span class="jill"></span>等）连接到你的<span class="jill"></span>Nginx<span class="jill"></span>邮件代理服务器，并发送和接收邮件以验证配置是否成功。</span></li><li id="4AtW6J43LwWM5zCsydsWnh"><div class="marker"></div><span class="inline-wrap"><b>检查日志</b></span><span class="inline-wrap">：如果遇到问题，可以查看<span class="jill"></span>Nginx<span class="jill"></span>的错误日志（通常位于</span><span class="inline-wrap"><code>/var/log/nginx/error.log</code></span><span class="inline-wrap">）以获取更多调试信息。</span></li></ol><div id="gKkthWEY2rhekYjijuBuSe" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中配置邮件代理功能。需要注意的是，邮件代理的配置可能会因具体需求而有所不同，因此建议根据实际情况进行调整和优化。</span></div></div><div id="i1z5pWacTQz3p5MwwmWAtc" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="x5d9kYXkuG42PXFJD1L3gf" class="wolai-block"><span class="wolai-serial-number">46</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置缓存控制头（Cache-Control）？</span></h1><div id="51hrKQ327RvPsvfojV6eZo" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置缓存控制头（Cache-Control）可以通过使用</span><span class="inline-wrap"><code>add_header</code></span><span class="inline-wrap">指令来实现。以下是详细的步骤和示例：</span></div></div><h3 id="aTHQg2uuzRpxxB6st4CJQi" class="wolai-block"><span class="wolai-serial-number">46.1</span><span class="inline-wrap">基本配置</span></h3><ol class="wolai-block"><li id="54XKgFKBAXNKmwjqpbqpYc"><div class="marker"></div><span class="inline-wrap"><b>打开<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：通常，Nginx<span class="jill"></span>的主配置文件位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">。你可以使用文本编辑器打开这个文件，例如：</span><code-block id="tzCH5wBSZ6UMDkycMcjTf8" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">nano</span> /etc/nginx/nginx.conf</pre></div></code-block></li><li id="n8HCj6QcZSzn4h4kWXXLtN"><div class="marker"></div><span class="inline-wrap"><b>添加缓存控制头</b></span><span class="inline-wrap">：在适当的位置（如<span class="jill"></span>http<span class="jill"></span>块、server<span class="jill"></span>块或<span class="jill"></span>location<span class="jill"></span>块）添加</span><span class="inline-wrap"><code>add_header</code></span><span class="inline-wrap">指令来设置<span class="jill"></span>Cache-Control<span class="jill"></span>头。以下是一个基本的示例：</span><code-block id="azfBZmCLn6YQosPRu36TVJ" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>http {
    ...
    server {
        listen 80;
        server_name example.com;

        location / {
            root /var/www/html;
            index index.html index.htm;

            # 添加Cache-Control头
            add_header Cache-Control "public, max-age=3600";
        }
    }
}</pre></div></code-block></li></ol><h3 id="ezqkBEZrGh9GFMUrQ7LA5p" class="wolai-block"><span class="wolai-serial-number">46.2</span><span class="inline-wrap">高级配置</span></h3><ol class="wolai-block"><li id="5SHP993HmuPGNGjyMXQMs8"><div class="marker"></div><span class="inline-wrap"><b>根据条件设置<span class="jill"></span>Cache-Control<span class="jill"></span>头</b></span><span class="inline-wrap">：你可以根据请求的<span class="jill"></span>URL<span class="jill"></span>或其他条件来动态设置<span class="jill"></span>Cache-Control<span class="jill"></span>头。例如，对于静态资源可以设置较长的缓存时间，而对于动态内容则设置较短的缓存时间。</span><code-block id="n6Vpm92Bs1XQPdJdeUTLeu" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>server {
    listen 80;
    server_name example.com;

    location /static/ {
        root /var/www/html;
        add_header Cache-Control "public, max-age=31536000"; # 静态资源缓存一年
    }

    location /dynamic/ {
        proxy_pass http://backend;
        add_header Cache-Control "no-cache, no-store, must-revalidate"; # 动态内容不缓存
    }
}</pre></div></code-block></li><li id="pfaMag5Hc3z2o1uAHxFNV5"><div class="marker"></div><span class="inline-wrap"><b>使用变量设置<span class="jill"></span>Cache-Control<span class="jill"></span>头</b></span><span class="inline-wrap">：你还可以使用<span class="jill"></span>Nginx<span class="jill"></span>内置的变量来动态设置<span class="jill"></span>Cache-Control<span class="jill"></span>头。例如，根据请求的文件类型设置不同的缓存策略：</span><code-block id="qZrqHAsQeJC3hxTXLEu5KL" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>server {
    listen 80;
    server_name example.com;

    location / {
        root /var/www/html;
        index index.html index.htm;

        # 根据文件扩展名设置Cache-Control头
        if ($request_uri ~* \.(jpg|jpeg|png|gif|ico|css|js)$) {
            add_header Cache-Control "public, max-age=31536000"; # 图片和静态资源缓存一年
        }

        if ($request_uri ~* \.(html|htm)$) {
            add_header Cache-Control "no-cache, no-store, must-revalidate"; # HTML页面不缓存
        }
    }
}</pre></div></code-block></li></ol><h3 id="vCt4PjQht5896dg4Ruoooz" class="wolai-block"><span class="wolai-serial-number">46.3</span><span class="inline-wrap">测试和验证</span></h3><ol class="wolai-block"><li id="rXmTd45DtQMNq2NPdeDzph"><div class="marker"></div><span class="inline-wrap"><b>重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在修改完配置文件后，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置文件是否正确，并重启<span class="jill"></span>Nginx<span class="jill"></span>以使配置生效：</span><code-block id="69k9BHJ6YVAtADrwXzNK6e" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span>
<span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li><li id="2j4QcSYeGKtSy2YUenbMc6"><div class="marker"></div><span class="inline-wrap"><b>检查响应头</b></span><span class="inline-wrap">：使用浏览器开发者工具或<span class="jill"></span>curl<span class="jill"></span>命令检查<span class="jill"></span>HTTP<span class="jill"></span>响应头，确认<span class="jill"></span>Cache-Control<span class="jill"></span>头是否按预期设置。例如，使用<span class="jill"></span>curl<span class="jill"></span>命令：</span><code-block id="jdBFjAXZQgfoyyL13v62x9" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">curl</span> <span class="token parameter variable">-I</span> http://example.com/static/image.jpg</pre></div></code-block><div id="88JN1Vni4LDr3nEq7SGvyA" class="wolai-block wolai-text"><div><span class="inline-wrap">你应该能看到类似以下的输出：</span></div></div><code-block id="aNzGRdUWECqcjYh3RAKUMF" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>HTTP/1.1 200 OK
Server: nginx/1.18.0 (Ubuntu)
Date: Wed, 14 Oct 2021 12:00:00 GMT
Content-Type: image/jpeg
Content-Length: 12345
Connection: keep-alive
Cache-Control: public, max-age=31536000</pre></div></code-block></li></ol><div id="kJEgcNDCLiedaFCJraeZ54" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中配置缓存控制头（Cache-Control）。这些配置可以帮助你更好地控制客户端缓存行为，提高网站性能和用户体验。</span></div></div><div id="dX95CWEtcQKuECfbNJEd6R" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="3f31JA8s2Gysjczhzh8tTV" class="wolai-block"><span class="wolai-serial-number">47</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的变量系统。</span></h1><div id="4gwVJ8HBJm5ZbZnZHLUHSP" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>中的变量系统是其配置灵活性和功能性的重要组成部分。以下是对<span class="jill"></span>Nginx<span class="jill"></span>变量系统的详细解释：</span></div></div><h3 id="rRixpFoMS9BPKfpqTvyBnY" class="wolai-block"><span class="wolai-serial-number">47.1</span><span class="inline-wrap">变量定义与表示</span></h3><ul class="wolai-block"><li id="rDpMS8FmYK91BSWFabmaAV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>变量前缀</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>使用“</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>”符号作为变量的前缀，如</mtext><mi mathvariant="normal">‘</mi></mrow><annotation encoding="application/x-tex">”符号作为变量的前缀，如`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">”</span><span class="mord cjk_fallback">符号作为变量的前缀，如</span><span class="mord">‘</span></span></span></span></span><span class="inline-wrap">variable_name`。</span></li><li id="reyu8xMGf1VDLfhAeo9nf5"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>变量名</b></span><span class="inline-wrap">：变量名由字母、数字、下划线组成，且必须以字母或下划线开头，不能包含特殊字符（如空格、连字符等）。</span></li><li id="qhuKSZhVNXZiEfSPj9MzUB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>变量值</b></span><span class="inline-wrap">：变量的值可以是字符串类型，并且可以通过配置文件进行动态设置和获取。</span></li></ul><h3 id="bFZSoQdqdaqXprWJYZagt4" class="wolai-block"><span class="wolai-serial-number">47.2</span><span class="inline-wrap">变量种类</span></h3><ul class="wolai-block"><li id="uKTZExU1QCQuPhyCL91Tw3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>内置变量</b></span><span class="inline-wrap">：这些变量在<span class="jill"></span>Nginx<span class="jill"></span>启动时就已经被预设好了，不需要用户在配置文件中显式声明。它们通常代表客户端请求或响应的某些部分，如请求头、响应头、客户端地址等。例如，</span><span class="inline-wrap"><code>$http_user_agent</code></span><span class="inline-wrap">代表<span class="jill"></span>HTTP<span class="jill"></span>请求头中的<span class="jill"></span>User-Agent<span class="jill"></span>字段，</span><span class="inline-wrap"><code>$remote_addr</code></span><span class="inline-wrap">代表客户端的<span class="jill"></span>IP<span class="jill"></span>地址。</span></li><li id="nkNoQ1P3Rk5Vj2Qu5XFyFd"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>自定义变量</b></span><span class="inline-wrap">：用户可以在配置文件中使用</span><span class="inline-wrap"><code>set</code></span><span class="inline-wrap">指令来声明和初始化自定义变量。这些变量可以在后续的配置指令中引用。例如，</span><span class="inline-wrap"><code>set $my_var &quot;some_value&quot;;</code></span><span class="inline-wrap">定义了一个名为</span><span class="inline-wrap"><code>$my_var</code></span><span class="inline-wrap">的自定义变量，并将其值设置为&quot;some_value&quot;。</span></li></ul><h3 id="nM6ePeZcPaGSaSxQZTC2m5" class="wolai-block"><span class="wolai-serial-number">47.3</span><span class="inline-wrap">变量作用域</span></h3><ul class="wolai-block"><li id="d9oACQ54p6E42VLm87LZUk"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nginx<span class="jill"></span>变量的作用域可以是全局的，也可以是局部的。全局变量在整个配置文件中都可以访问，而局部变量只在声明它的上下文块（如</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">、</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">等）中可见。</span></li></ul><h3 id="3KrEkvJdQnF6ehDhFAcvBx" class="wolai-block"><span class="wolai-serial-number">47.4</span><span class="inline-wrap">变量解析与插值</span></h3><ul class="wolai-block"><li id="8CamCSTSdm6hWzW5Wokrz9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">当<span class="jill"></span>Nginx<span class="jill"></span>处理请求时，它会解析并替换配置文件中的变量为实际的值。这种替换过程称为变量插值或变量解析。</span></li><li id="b8AWy446Lu4NkFvkUsrS7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">变量插值可以发生在多个地方，包括日志记录、重定向、代理传递等场景。</span></li></ul><h3 id="2gusgeZE6cL73xitdqpjSn" class="wolai-block"><span class="wolai-serial-number">47.5</span><span class="inline-wrap">变量缓存</span></h3><ul class="wolai-block"><li id="tCQ6ZXZGybhfZLj9nMroFY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">为了提高性能，Nginx<span class="jill"></span>会对某些变量进行缓存。这意味着一旦变量被解析过一次，其结果就会被存储起来，以便后续请求快速访问。然而，这也可能导致在某些情况下变量值无法实时更新的问题。</span></li></ul><h3 id="bPNm94rd6s5tYbUuj5vneF" class="wolai-block"><span class="wolai-serial-number">47.6</span><span class="inline-wrap">变量使用示例</span></h3><ul class="wolai-block"><li id="xbDb6NNQGxdKeMhst7vL2S"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>重定向</b></span><span class="inline-wrap">：使用变量可以实现基于<span class="jill"></span>URL<span class="jill"></span>参数或其他条件的动态重定向。</span></li><li id="xv9AbLtGvMGotsbyVTU7Nk"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>负载均衡</b></span><span class="inline-wrap">：通过变量可以动态选择不同的上游服务器。</span></li><li id="9S9KSWEKYQsXfu7tJHnABh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>条件判断</b></span><span class="inline-wrap">：结合</span><span class="inline-wrap"><code>if</code></span><span class="inline-wrap">指令和变量，可以实现复杂的条件逻辑。</span></li><li id="5uHFw6HrUP3ZnmPSNm6n2u"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>日志记录</b></span><span class="inline-wrap">：使用变量可以定制日志格式，记录更多有用的信息。</span></li></ul><div id="agHuejr3EtHbL4eh398DHV" class="wolai-block wolai-text"><div><span class="inline-wrap">综上所述，Nginx<span class="jill"></span>的变量系统为其提供了强大的配置灵活性和功能性。通过合理使用内置变量和自定义变量，用户可以构建出满足各种需求的<span class="jill"></span>Web<span class="jill"></span>服务器配置。然而，在使用变量时也需要注意其作用域、解析时机以及可能的缓存问题。</span></div></div><div id="hocQP1Kyv2g1zt3VArgrEM" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="2h7S47A9a2FPoUFSwGQpDT" class="wolai-block"><span class="wolai-serial-number">48</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置多视图（multi-view）支持？</span></h1><div id="2oPp74u1z84xPses67WSuH" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置多视图（即多页面）支持，主要是通过配置多个</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块来实现的。以下是详细的步骤和示例：</span></div></div><ol class="wolai-block"><li id="5KLvuXLYHTQ66yAtbf3mSN"><div class="marker"></div><span class="inline-wrap"><b>安装<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：确保已安装<span class="jill"></span>Nginx。如果尚未安装，可以使用以下命令进行安装（以<span class="jill"></span>Ubuntu<span class="jill"></span>为例）：</span><code-block id="giPJ3xsJb9oiEk6c4dgnN2" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx</pre></div></code-block></li><li id="gjGn3wRaqgMkY9kQJ5sXhD"><div class="marker"></div><span class="inline-wrap"><b>配置<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：打开<span class="jill"></span>Nginx<span class="jill"></span>的主配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">），并在其中添加或修改相应的配置。</span></li><li id="wCe7Rt8XuUL6LCLkBR1VCG"><div class="marker"></div><span class="inline-wrap"><b>定义服务器块</b></span><span class="inline-wrap">：在</span><span class="inline-wrap"><code>nginx.conf</code></span><span class="inline-wrap">文件中，使用</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块来定义一个虚拟服务器。在这个块内，可以定义多个</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块来处理不同的<span class="jill"></span>URL<span class="jill"></span>路径。</span></li><li id="9eHLbFsNzKHNzjZx7TtDNr"><div class="marker"></div><span class="inline-wrap"><b>配置多视图</b></span><span class="inline-wrap">：对于多页面应用，每个页面（或视图）都可以对应一个</span><span class="inline-wrap"><code>location</code></span><span class="inline-wrap">块。例如，假设有一个项目包含两个页面：</span><span class="inline-wrap"><code>index.html</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>project.html</code></span><span class="inline-wrap">，它们分别位于</span><span class="inline-wrap"><code>/root/libs/landing-page/html</code></span><span class="inline-wrap">目录下。可以按照以下方式配置：</span><code-block id="3yqmXc3ayyJTmzzweyNZ8D" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> your_domain.com</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /root/libs/landing-page</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> index.html project.html</span><span class="token punctuation">;</span> <span class="token comment"># 设置默认文档</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> /project</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /root/libs/landing-page</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">index</span> project.html</span><span class="token punctuation">;</span> <span class="token comment"># 当访问/project时，返回project.html</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="58Z3JiuWELMVxto4UNqWeD" class="wolai-block wolai-text"><div><span class="inline-wrap">在这个配置中，当用户访问</span><span class="inline-wrap"><code>http://your_domain.com/</code></span><span class="inline-wrap">时，将返回</span><span class="inline-wrap"><code>index.html</code></span><span class="inline-wrap">；当用户访问</span><span class="inline-wrap"><code>http://your_domain.com/project</code></span><span class="inline-wrap">时，将返回</span><span class="inline-wrap"><code>project.html</code></span><span class="inline-wrap">。</span></div></div></li><li id="kpPgvj1yT1T5XxSiBRWYsP"><div class="marker"></div><span class="inline-wrap"><b>测试并重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：保存配置文件后，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置是否正确：</span><code-block id="jkVgxCQqWM8rmvNxRZzGgA" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block><div id="kqs56pZNsTBQuFhmvhMGE5" class="wolai-block wolai-text"><div><span class="inline-wrap">如果配置正确，将显示“syntax is ok”和“test is successful”。然后，重启<span class="jill"></span>Nginx<span class="jill"></span>以使配置生效：</span></div></div><code-block id="4QXjYjswnh9vh8LovFvkWm" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li><li id="dG3KKL7P7zRHKL8WmuDnVX"><div class="marker"></div><span class="inline-wrap"><b>访问多视图</b></span><span class="inline-wrap">：现在，您应该能够通过浏览器访问配置的多视图了。例如，访问</span><span class="inline-wrap"><code>http://your_domain.com/</code></span><span class="inline-wrap">将显示</span><span class="inline-wrap"><code>index.html</code></span><span class="inline-wrap">的内容，而访问</span><span class="inline-wrap"><code>http://your_domain.com/project</code></span><span class="inline-wrap">将显示</span><span class="inline-wrap"><code>project.html</code></span><span class="inline-wrap">的内容。</span></li></ol><div id="2opyMwmkfFMkpF2un3BeVC" class="wolai-block wolai-text"><div><span class="inline-wrap">需要注意的是，以上配置是一个基本的示例。在实际项目中，可能需要根据具体需求进行调整。例如，您可能需要为每个视图配置不同的访问权限、缓存策略等。此外，如果您使用的是反向代理或负载均衡等高级功能，还需要进行相应的配置。</span></div></div><div id="iPb8D4xwzYQiXS1CTdK1Zn" class="wolai-block wolai-text"><div><span class="inline-wrap">最后，建议在生产环境中使用前充分测试<span class="jill"></span>Nginx<span class="jill"></span>配置，以确保其稳定性和安全性。</span></div></div><div id="soZscsewFxqhPGNX1xh7KV" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="wztpkyNLnGNZ9zU3RxjYrK" class="wolai-block"><span class="wolai-serial-number">49</span><span class="inline-wrap">解释<span class="jill"></span>Nginx<span class="jill"></span>中的<span class="jill"></span>X-Accelerator<span class="jill"></span>模块。</span></h1><div id="21MHgPi76GeKDiM66Qfsx2" class="wolai-block wolai-text"><div><span class="inline-wrap">Nginx<span class="jill"></span>中的<span class="jill"></span>X-Accelerator<span class="jill"></span>模块是一个功能模块，它允许由后台（如<span class="jill"></span>Apache、Tomcat、FastCGI<span class="jill"></span>等）通过返回的头来决定投递静态文件。这一机制在处理需要登录认证、权限核查、积分扣除或增加等细粒度控制的场景时非常有用。以下是对<span class="jill"></span>X-Accelerator<span class="jill"></span>模块的详细解释：</span></div></div><h3 id="fUe1B6XjNrRRJrz6bdMUAB" class="wolai-block"><span class="wolai-serial-number">49.1</span><span class="inline-wrap">工作原理</span></h3><ol class="wolai-block"><li id="jiGAiqmGiQxkRoaSrFzTmx"><div class="marker"></div><span class="inline-wrap"><b>客户端请求</b></span><span class="inline-wrap">：用户通过浏览器向<span class="jill"></span>Nginx<span class="jill"></span>发送一个请求，这个请求可能是下载某个资源。</span></li><li id="4cAJHkssaS8cbQneRqiVNW"><div class="marker"></div><span class="inline-wrap"><b>Nginx<span class="jill"></span>转发请求</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>作为反向代理服务器，将这个请求转发给后台服务器（如<span class="jill"></span>Apache、Tomcat<span class="jill"></span>等）。</span></li><li id="i34ATzTNEFfY9QGbx1793b"><div class="marker"></div><span class="inline-wrap"><b>后台服务器处理</b></span><span class="inline-wrap">：后台服务器接收到请求后，进行必要的验证和处理（如登录认证、权限核查等）。如果条件满足，后台服务器会设置一个特殊的<span class="jill"></span>HTTP<span class="jill"></span>头（如</span><span class="inline-wrap"><code>X-Accel-Redirect</code></span><span class="inline-wrap">），并将这个头返回给<span class="jill"></span>Nginx。</span></li><li id="taKTuiNznn42MnqcvcXqnT"><div class="marker"></div><span class="inline-wrap"><b>Nginx<span class="jill"></span>接管下载任务</b></span><span class="inline-wrap">：Nginx<span class="jill"></span>收到带有</span><span class="inline-wrap"><code>X-Accel-Redirect</code></span><span class="inline-wrap">头的响应后，会根据该头中指定的<span class="jill"></span>URI<span class="jill"></span>进行<span class="jill"></span>location<span class="jill"></span>匹配，然后是请求文件的匹配。最终，Nginx<span class="jill"></span>会从匹配到的位置提供文件下载服务给终端用户。</span></li></ol><h3 id="vVZ5v2DGf1fsvycy81KhZT" class="wolai-block"><span class="wolai-serial-number">49.2</span><span class="inline-wrap">配置示例</span></h3><div id="8F2Rf5a3M5tCfLKD3gYJwx" class="wolai-block wolai-text"><div><span class="inline-wrap">假设有一个文件下载的场景，其中/dd/filename<span class="jill"></span>是客户端请求的路径，而实际的文件位于/var/www/files<span class="jill"></span>目录下。可以在<span class="jill"></span>Nginx<span class="jill"></span>配置文件中添加以下内容来实现<span class="jill"></span>X-Accelerator<span class="jill"></span>模块的功能：</span></div></div><code-block id="3JYVBPxqF7zRg9ivQPFVxD" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token comment"># 定义受保护的文件位置</span>
<span class="token directive"><span class="token keyword">location</span> /protected_files</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">alias</span> /var/www/files</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 客户端请求的路径</span>
<span class="token directive"><span class="token keyword">location</span> /dd/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend_server</span><span class="token punctuation">;</span> <span class="token comment"># 这里的backend_server是后台服务器的地址</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="vCiMNsWGvhrNeyGnu4BS5p" class="wolai-block wolai-text"><div><span class="inline-wrap">在后台服务器（如<span class="jill"></span>PHP<span class="jill"></span>程序）中，可以这样设置<span class="jill"></span>X-Accel-Redirect<span class="jill"></span>头来指定下载的文件：</span></div></div><code-block id="7qdfdcn9zYr1i15tNWNv3w" class="wolai-block"><div class="wolai-pre"><div data-lang="PHP" class="marker"></div><pre><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"X-Accel-Redirect: /protected_files/"</span><span class="token operator">.</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h3 id="vCPJCXkUsQeDJsmr4rM7cY" class="wolai-block"><span class="wolai-serial-number">49.3</span><span class="inline-wrap">功能特点</span></h3><ul class="wolai-block"><li id="rK26nA2CPwWdv9CgegWPF2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>减轻后端服务器压力</b></span><span class="inline-wrap">：由于<span class="jill"></span>Nginx<span class="jill"></span>在打开静态文件时使用了<span class="jill"></span>sendfile(2)，其<span class="jill"></span>IO<span class="jill"></span>效率非常高，因此将静态资源的下载任务交给<span class="jill"></span>Nginx<span class="jill"></span>可以大大减轻后端服务器的压力。</span></li><li id="w87SXv6Vt2JDxe8n1k3Znj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>灵活性高</b></span><span class="inline-wrap">：X-Accelerator<span class="jill"></span>模块允许在后端服务器上进行各种验证和处理，然后由<span class="jill"></span>Nginx<span class="jill"></span>负责提供高效的文件下载服务，这种分工合作的方式提高了系统的整体性能和可扩展性。</span></li></ul><h3 id="hrVDHZSzyH9MVHcRkKk6vD" class="wolai-block"><span class="wolai-serial-number">49.4</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="inbSE2984t9P8NeXeLqbuE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Nginx<span class="jill"></span>服务器只认识从后端服务器发来的<span class="jill"></span>X-Accel-Redirect<span class="jill"></span>头，而从客户端发来的这种头，Nginx<span class="jill"></span>并不会理睬。</span></li><li id="mPxTGuGTM5vBW2A4h75b1R"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用<span class="jill"></span>X-Accelerator<span class="jill"></span>模块时，必须确保<span class="jill"></span>Nginx<span class="jill"></span>作为后端服务的代理，并且访问的是<span class="jill"></span>Nginx<span class="jill"></span>的代理地址，直接访问后端服务<span class="jill"></span>Nginx<span class="jill"></span>会报<span class="jill"></span>404。</span></li></ul><div id="dxAZGp5i6Kbm4GNoo5y4ZV" class="wolai-block wolai-text"><div><span class="inline-wrap">综上所述，Nginx<span class="jill"></span>中的<span class="jill"></span>X-Accelerator<span class="jill"></span>模块是一个强大的工具，它在处理需要细粒度控制的静态文件下载场景时非常有用。通过合理配置和使用这一模块，可以提高系统的性能和可扩展性。</span></div></div><div id="9wwxrBxGq5nNHtRmmFtqEY" class="bg-fluorescent_green wolai-block wolai-text"><div><span class="inline-wrap"> </span><br/></div></div><h1 id="cMrSX2T9rNwMipeg3mek8X" class="wolai-block"><span class="wolai-serial-number">50</span><span class="inline-wrap">如何在<span class="jill"></span>Nginx<span class="jill"></span>中配置安全头部（Security Headers）？</span></h1><div id="xseof9SCSqXUUrR7aAwX8y" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置安全头部（Security Headers）是增强<span class="jill"></span>Web<span class="jill"></span>应用安全性的重要步骤。这些头部可以帮助防止各种类型的攻击，如跨站脚本攻击（XSS）、点击劫持、内容类型嗅探等。以下是详细的步骤和示例：</span></div></div><h3 id="tLT9DkSsrqFb5qCHpSW2gE" class="wolai-block"><span class="wolai-serial-number">50.1</span><span class="inline-wrap">安装<span class="jill"></span>Nginx</span></h3><div id="nWKv9P1hHCihXJkRRi7hGn" class="wolai-block wolai-text"><div><span class="inline-wrap">确保已安装<span class="jill"></span>Nginx。如果尚未安装，可以使用以下命令进行安装（以<span class="jill"></span>Ubuntu<span class="jill"></span>为例）：</span></div></div><code-block id="8WSv5gsecyM1w29r4u812Y" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx</pre></div></code-block><h3 id="hHGXDV5ik94i2Es4dwTiUb" class="wolai-block"><span class="wolai-serial-number">50.2</span><span class="inline-wrap">配置<span class="jill"></span>Nginx</span></h3><div id="eTf35xtUn8k15RYWkCgyCY" class="wolai-block wolai-text"><div><span class="inline-wrap">打开<span class="jill"></span>Nginx<span class="jill"></span>的主配置文件（通常位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">），并在其中添加或修改相应的配置。</span></div></div><h3 id="i2pFNvneC542oYHntgUMka" class="wolai-block"><span class="wolai-serial-number">50.3</span><span class="inline-wrap">添加安全头部</span></h3><div id="nHubLbYsJtZCsgQDt8Btco" class="wolai-block wolai-text"><div><span class="inline-wrap">在</span><span class="inline-wrap"><code>http</code></span><span class="inline-wrap">块或特定的</span><span class="inline-wrap"><code>server</code></span><span class="inline-wrap">块中添加安全头部配置。以下是一些常见的安全头部及其配置示例：</span></div></div><h4 id="h7TqrQq8YHZnYFdd64wYUD" class="wolai-block"><span class="wolai-serial-number">50.3.1</span><span class="inline-wrap">基本安全头部</span></h4><code-block id="rxqcD5RE2iZpLqJKpsJKj1" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 其他配置...</span>

    <span class="token directive"><span class="token keyword">add_header</span> X-Content-Type-Options nosniff</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">add_header</span> X-Frame-Options DENY</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">add_header</span> X-XSS-Protection <span class="token string">"1; mode=block"</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">add_header</span> Referrer-Policy no-referrer-when-downgrade</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">add_header</span> Content-Security-Policy <span class="token string">"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 id="v8FUNX76jqaiTAgWcgk9UX" class="wolai-block"><span class="wolai-serial-number">50.3.2</span><span class="inline-wrap">HSTS（HTTP Strict Transport Security）</span></h4><div id="nEsoDKbXcRCcosLKRgih4f" class="wolai-block wolai-text"><div><span class="inline-wrap">HSTS<span class="jill"></span>可以强制客户端使用<span class="jill"></span>HTTPS<span class="jill"></span>连接，从而防止中间人攻击。</span></div></div><code-block id="2asa4VVk2iLRtds2Lb11hZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 其他配置...</span>

    <span class="token directive"><span class="token keyword">add_header</span> Strict-Transport-Security <span class="token string">"max-age=31536000; includeSubDomains"</span> always</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h4 id="6F8KH7PVQtQX6D6L4T4dku" class="wolai-block"><span class="wolai-serial-number">50.3.3</span><span class="inline-wrap">Feature-Policy（功能策略）</span></h4><div id="5zqihUZNA2wFJ3tYAfYcp8" class="wolai-block wolai-text"><div><span class="inline-wrap">Feature-Policy<span class="jill"></span>头用于控制浏览器中某些功能的启用情况。</span></div></div><code-block id="r6Nwj6yu3fKqDXP49j6Qtr" class="wolai-block"><div class="wolai-pre"><div data-lang="Nginx" class="marker"></div><pre><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># 其他配置...</span>

    <span class="token directive"><span class="token keyword">add_header</span> Feature-Policy <span class="token string">"geolocation 'none'; midi 'none'; notifications 'none'; push 'none'; sync-xhr 'none'; microphone 'none'; camera 'none'; magnetometer 'none'; gyroscope 'none'; speaker 'none'; vibrate 'none'; fullscreen 'none'; payment 'none'"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><h3 id="qa54xtPqwTGHfKxzT4fGJ4" class="wolai-block"><span class="wolai-serial-number">50.4</span><span class="inline-wrap">测试并重启<span class="jill"></span>Nginx</span></h3><div id="5jMXVjuhfwF7bkQs5Nyhna" class="wolai-block wolai-text"><div><span class="inline-wrap">保存配置文件后，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置是否正确：</span></div></div><code-block id="2jZsjUi4qsmompWqRDAfiD" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span></pre></div></code-block><div id="q4qBrXKf3DFtoZoLrGJYqp" class="wolai-block wolai-text"><div><span class="inline-wrap">如果配置正确，将显示“syntax is ok”和“test is successful”。然后，重启<span class="jill"></span>Nginx<span class="jill"></span>以使配置生效：</span></div></div><code-block id="2w7C37ZSaTuCyTLHKFp1MG" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block><h3 id="jrjbhKCuTSjSopaJbQZtjC" class="wolai-block"><span class="wolai-serial-number">50.5</span><span class="inline-wrap">验证安全头部</span></h3><div id="5FsKAPww61Thrd714ffqMV" class="wolai-block wolai-text"><div><span class="inline-wrap">可以使用浏览器的开发者工具或在线工具（</span><span class="inline-wrap"><a href="http://xn--SecurityHeaders-qv11a.io"><span>如<span class="jill"></span>SecurityHeaders.io</span></a></span><span class="inline-wrap">）来检查响应头是否包含预期的安全头部。</span></div></div><h3 id="4kRiJLgrfTVEpwyz1MAL2B" class="wolai-block"><span class="wolai-serial-number">50.6</span><span class="inline-wrap">注意事项</span></h3><ul class="wolai-block"><li id="4RejYN6dvvCrKgMCWsHFk2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>逐步实施</b></span><span class="inline-wrap">：在生产环境中逐步实施这些安全头部，以确保不会对现有功能造成影响。</span></li><li id="9ejGqiF5e1ewVUZQQkWxJU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>定期更新</b></span><span class="inline-wrap">：随着新的安全威胁的出现，应定期审查和更新安全头部配置。</span></li><li id="795Nh5sF9GyfF2JoKRbPgR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>结合其他安全措施</b></span><span class="inline-wrap">：仅靠安全头部是不够的，还应结合其他安全措施，如输入验证、输出编码、使用<span class="jill"></span>HTTPS<span class="jill"></span>等。</span></li></ul><div id="q2berVZSS4582mHpsH2W2M" class="wolai-block wolai-text"><div><span class="inline-wrap">通过以上步骤，您可以在<span class="jill"></span>Nginx<span class="jill"></span>中配置安全头部，从而提高<span class="jill"></span>Web<span class="jill"></span>应用的安全性。</span></div></div><div id="aKbiLRkvg1ysbcAD32HqU1" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Nginx<span class="jill"></span>中配置缓存控制头（Cache-Control）可以通过使用</span><span class="inline-wrap"><code>add_header</code></span><span class="inline-wrap">指令来实现。以下是详细的步骤和示例：</span></div></div><h3 id="nKHVSb2g8jNfeJ7FJXC5tR" class="wolai-block"><span class="wolai-serial-number">50.7</span><span class="inline-wrap">一、基本配置</span></h3><ol class="wolai-block"><li id="gnSRQWPbe1ytdWmoLKwuvi"><div class="marker"></div><span class="inline-wrap"><b>打开<span class="jill"></span>Nginx<span class="jill"></span>配置文件</b></span><span class="inline-wrap">：通常，Nginx<span class="jill"></span>的主配置文件位于</span><span class="inline-wrap"><code>/etc/nginx/nginx.conf</code></span><span class="inline-wrap">。你可以使用文本编辑器打开这个文件，例如：</span><code-block id="7kh5VXobTfbMU2mjm7s8nr" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> <span class="token function">nano</span> /etc/nginx/nginx.conf</pre></div></code-block></li><li id="iJGFdWQ9CykzfBjyyBGcq8"><div class="marker"></div><span class="inline-wrap"><b>添加缓存控制头</b></span><span class="inline-wrap">：在适当的位置（如<span class="jill"></span>http<span class="jill"></span>块、server<span class="jill"></span>块或<span class="jill"></span>location<span class="jill"></span>块）添加</span><span class="inline-wrap"><code>add_header</code></span><span class="inline-wrap">指令来设置<span class="jill"></span>Cache-Control<span class="jill"></span>头。以下是一个基本的示例：</span><code-block id="tFoHPciYc7PymaTV8UYHRE" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>http {
    ...
    server {
        listen 80;
        server_name example.com;

        location / {
            root /var/www/html;
            index index.html index.htm;

            # 添加Cache-Control头
            add_header Cache-Control "public, max-age=3600";
        }
    }
}</pre></div></code-block></li></ol><h3 id="wjEPzMbxzN3NJCiZZ9Komt" class="wolai-block"><span class="wolai-serial-number">50.8</span><span class="inline-wrap">二、高级配置</span></h3><ol class="wolai-block"><li id="krukoGo3Bqk6rm6a8R2pCL"><div class="marker"></div><span class="inline-wrap"><b>根据条件设置<span class="jill"></span>Cache-Control<span class="jill"></span>头</b></span><span class="inline-wrap">：你可以根据请求的<span class="jill"></span>URL<span class="jill"></span>或其他条件来动态设置<span class="jill"></span>Cache-Control<span class="jill"></span>头。例如，对于静态资源可以设置较长的缓存时间，而对于动态内容则设置较短的缓存时间。</span><code-block id="sPDMRNyvExBnmg5kpyb4tX" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>server {
    listen 80;
    server_name example.com;

    location /static/ {
        root /var/www/html;
        add_header Cache-Control "public, max-age=31536000"; # 静态资源缓存一年
    }

    location /dynamic/ {
        proxy_pass http://backend;
        add_header Cache-Control "no-cache, no-store, must-revalidate"; # 动态内容不缓存
    }
}</pre></div></code-block></li><li id="aYjiF9EizcWTaZHctu616z"><div class="marker"></div><span class="inline-wrap"><b>使用变量设置<span class="jill"></span>Cache-Control<span class="jill"></span>头</b></span><span class="inline-wrap">：你还可以使用<span class="jill"></span>Nginx<span class="jill"></span>内置的变量来动态设置<span class="jill"></span>Cache-Control<span class="jill"></span>头。例如，根据请求的文件类型设置不同的缓存策略：</span><code-block id="rvHm3hRppndNh3tvXY7cWW" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>server {
    listen 80;
    server_name example.com;

    location / {
        root /var/www/html;
        index index.html index.htm;

        # 根据文件扩展名设置Cache-Control头
        if ($request_uri ~* \.(jpg|jpeg|png|gif|ico|css|js)$) {
            add_header Cache-Control "public, max-age=31536000"; # 图片和静态资源缓存一年
        }

        if ($request_uri ~* \.(html|htm)$) {
            add_header Cache-Control "no-cache, no-store, must-revalidate"; # HTML页面不缓存
        }
    }
}</pre></div></code-block></li></ol><h3 id="eteS7GUFuHWgQK9yWtGuaK" class="wolai-block"><span class="wolai-serial-number">50.9</span><span class="inline-wrap">三、测试和验证</span></h3><ol class="wolai-block"><li id="eLM2UHcaCjZYKAaEMPdFu9"><div class="marker"></div><span class="inline-wrap"><b>重启<span class="jill"></span>Nginx</b></span><span class="inline-wrap">：在修改完配置文件后，使用以下命令测试<span class="jill"></span>Nginx<span class="jill"></span>配置文件是否正确，并重启<span class="jill"></span>Nginx<span class="jill"></span>以使配置生效：</span><code-block id="7g3d92smxPN53HEAcM49M6" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span>
<span class="token function">sudo</span> systemctl restart nginx</pre></div></code-block></li><li id="m25MmVcAXqmM8c5jkZsZgy"><div class="marker"></div><span class="inline-wrap"><b>检查响应头</b></span><span class="inline-wrap">：使用浏览器开发者工具或<span class="jill"></span>curl<span class="jill"></span>命令检查<span class="jill"></span>HTTP<span class="jill"></span>响应头，确认<span class="jill"></span>Cache-Control<span class="jill"></span>头是否按预期设置。例如，使用<span class="jill"></span>curl<span class="jill"></span>命令：</span><code-block id="wQv2uzKZjfdb9DYdfQkyvn" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">curl</span> <span class="token parameter variable">-I</span> http://example.com/static/image.jpg</pre></div></code-block><div id="kNFs5kcF4xJvwGbFBMa8qz" class="wolai-block wolai-text"><div><span class="inline-wrap">你应该能看到类似以下的输出：</span></div></div><code-block id="fftS8nfoa5Fm7LknVvFLn4" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>HTTP/1.1 200 OK
Server: nginx/1.18.0 (Ubuntu)
Date: Wed, 14 Oct 2021 12:00:00 GMT
Content-Type: image/jpeg
Content-Length: 12345
Connection: keep-alive
Cache-Control: public, max-age=31536000</pre></div></code-block></li></ol><div id="gc6c4czbYDvfrzDCmD8Vy8" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，通过上述步骤，你可以在<span class="jill"></span>Nginx<span class="jill"></span>中配置缓存控制头（Cache-Control）。这些配置可以帮助你更好地控制客户端缓存行为，提高网站性能和用户体验。</span></div></div></article><footer></footer></body></html>